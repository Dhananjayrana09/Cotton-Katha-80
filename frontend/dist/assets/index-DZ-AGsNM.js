import{r as b,b as Hl,u as Ci,L as Ht,g as Gl,c as at,d as Jt,e as Mn,a as pe,f as Ai,h as Kl,i as we,N as Jl,B as Zl}from"./vendor-CbSn3Nox.js";import{a as Ql,u as ba,Q as Yl,b as Xl}from"./utils-DthyryG-.js";import{X as eo,M as to,C as so,L as ro,H as no,a as nt,b as xt,F as ve,B as rr,S as Tr,U as As,E as ao,c as Rs,A as Le,d as io,e as lo,f as oo,g as va,h as cs,i as co,j as Ae,I as uo,k as on,l as pt,m as Ps,n as Or,o as ho,p as mo,q as cn,r as ja,s as jn,P as wa,t as fo,u as nr,v as Js,T as xo,w as po}from"./ui--6GbmI6w.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();var Ti={exports:{}},Mr={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var go=b,yo=Symbol.for("react.element"),bo=Symbol.for("react.fragment"),vo=Object.prototype.hasOwnProperty,jo=go.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wo={key:!0,ref:!0,__self:!0,__source:!0};function Oi(r,t,s){var n,a={},i=null,l=null;s!==void 0&&(i=""+s),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(l=t.ref);for(n in t)vo.call(t,n)&&!wo.hasOwnProperty(n)&&(a[n]=t[n]);if(r&&r.defaultProps)for(n in t=r.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:yo,type:r,key:i,ref:l,props:a,_owner:jo.current}}Mr.Fragment=bo;Mr.jsx=Oi;Mr.jsxs=Oi;Ti.exports=Mr;var e=Ti.exports,wn={},_a=Hl;wn.createRoot=_a.createRoot,wn.hydrateRoot=_a.hydrateRoot;let _o={data:""},No=r=>typeof window=="object"?((r?r.querySelector("#_goober"):window._goober)||Object.assign((r||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:r||_o,So=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,ko=/\/\*[^]*?\*\/|  +/g,Na=/\n+/g,Vt=(r,t)=>{let s="",n="",a="";for(let i in r){let l=r[i];i[0]=="@"?i[1]=="i"?s=i+" "+l+";":n+=i[1]=="f"?Vt(l,i):i+"{"+Vt(l,i[1]=="k"?"":t)+"}":typeof l=="object"?n+=Vt(l,t?t.replace(/([^,])+/g,o=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,o):o?o+" "+c:c)):i):l!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=Vt.p?Vt.p(i,l):i+":"+l+";")}return s+(t&&a?t+"{"+a+"}":a)+n},Ot={},Pi=r=>{if(typeof r=="object"){let t="";for(let s in r)t+=s+Pi(r[s]);return t}return r},Eo=(r,t,s,n,a)=>{let i=Pi(r),l=Ot[i]||(Ot[i]=(c=>{let d=0,u=11;for(;d<c.length;)u=101*u+c.charCodeAt(d++)>>>0;return"go"+u})(i));if(!Ot[l]){let c=i!==r?r:(d=>{let u,h,g=[{}];for(;u=So.exec(d.replace(ko,""));)u[4]?g.shift():u[3]?(h=u[3].replace(Na," ").trim(),g.unshift(g[0][h]=g[0][h]||{})):g[0][u[1]]=u[2].replace(Na," ").trim();return g[0]})(r);Ot[l]=Vt(a?{["@keyframes "+l]:c}:c,s?"":"."+l)}let o=s&&Ot.g?Ot.g:null;return s&&(Ot.g=Ot[l]),((c,d,u,h)=>{h?d.data=d.data.replace(h,c):d.data.indexOf(c)===-1&&(d.data=u?c+d.data:d.data+c)})(Ot[l],t,n,o),l},Co=(r,t,s)=>r.reduce((n,a,i)=>{let l=t[i];if(l&&l.call){let o=l(s),c=o&&o.props&&o.props.className||/^go/.test(o)&&o;l=c?"."+c:o&&typeof o=="object"?o.props?"":Vt(o,""):o===!1?"":o}return n+a+(l??"")},"");function zr(r){let t=this||{},s=r.call?r(t.p):r;return Eo(s.unshift?s.raw?Co(s,[].slice.call(arguments,1),t.p):s.reduce((n,a)=>Object.assign(n,a&&a.call?a(t.p):a),{}):s,No(t.target),t.g,t.o,t.k)}let $i,_n,Nn;zr.bind({g:1});let Ft=zr.bind({k:1});function Ao(r,t,s,n){Vt.p=t,$i=r,_n=s,Nn=n}function Zt(r,t){let s=this||{};return function(){let n=arguments;function a(i,l){let o=Object.assign({},i),c=o.className||a.className;s.p=Object.assign({theme:_n&&_n()},o),s.o=/ *go\d+/.test(c),o.className=zr.apply(s,n)+(c?" "+c:"");let d=r;return r[0]&&(d=o.as||r,delete o.as),Nn&&d[0]&&Nn(o),$i(d,o)}return a}}var To=r=>typeof r=="function",Pr=(r,t)=>To(r)?r(t):r,Oo=(()=>{let r=0;return()=>(++r).toString()})(),Di=(()=>{let r;return()=>{if(r===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");r=!t||t.matches}return r}})(),Po=20,Li=(r,t)=>{switch(t.type){case 0:return{...r,toasts:[t.toast,...r.toasts].slice(0,Po)};case 1:return{...r,toasts:r.toasts.map(i=>i.id===t.toast.id?{...i,...t.toast}:i)};case 2:let{toast:s}=t;return Li(r,{type:r.toasts.find(i=>i.id===s.id)?1:0,toast:s});case 3:let{toastId:n}=t;return{...r,toasts:r.toasts.map(i=>i.id===n||n===void 0?{...i,dismissed:!0,visible:!1}:i)};case 4:return t.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(i=>i.id!==t.toastId)};case 5:return{...r,pausedAt:t.time};case 6:let a=t.time-(r.pausedAt||0);return{...r,pausedAt:void 0,toasts:r.toasts.map(i=>({...i,pauseDuration:i.pauseDuration+a}))}}},kr=[],as={toasts:[],pausedAt:void 0},hs=r=>{as=Li(as,r),kr.forEach(t=>{t(as)})},$o={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Do=(r={})=>{let[t,s]=b.useState(as),n=b.useRef(as);b.useEffect(()=>(n.current!==as&&s(as),kr.push(s),()=>{let i=kr.indexOf(s);i>-1&&kr.splice(i,1)}),[]);let a=t.toasts.map(i=>{var l,o,c;return{...r,...r[i.type],...i,removeDelay:i.removeDelay||((l=r[i.type])==null?void 0:l.removeDelay)||(r==null?void 0:r.removeDelay),duration:i.duration||((o=r[i.type])==null?void 0:o.duration)||(r==null?void 0:r.duration)||$o[i.type],style:{...r.style,...(c=r[i.type])==null?void 0:c.style,...i.style}}});return{...t,toasts:a}},Lo=(r,t="blank",s)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:r,pauseDuration:0,...s,id:(s==null?void 0:s.id)||Oo()}),or=r=>(t,s)=>{let n=Lo(t,r,s);return hs({type:2,toast:n}),n.id},Ve=(r,t)=>or("blank")(r,t);Ve.error=or("error");Ve.success=or("success");Ve.loading=or("loading");Ve.custom=or("custom");Ve.dismiss=r=>{hs({type:3,toastId:r})};Ve.remove=r=>hs({type:4,toastId:r});Ve.promise=(r,t,s)=>{let n=Ve.loading(t.loading,{...s,...s==null?void 0:s.loading});return typeof r=="function"&&(r=r()),r.then(a=>{let i=t.success?Pr(t.success,a):void 0;return i?Ve.success(i,{id:n,...s,...s==null?void 0:s.success}):Ve.dismiss(n),a}).catch(a=>{let i=t.error?Pr(t.error,a):void 0;i?Ve.error(i,{id:n,...s,...s==null?void 0:s.error}):Ve.dismiss(n)}),r};var Ro=(r,t)=>{hs({type:1,toast:{id:r,height:t}})},Fo=()=>{hs({type:5,time:Date.now()})},Zs=new Map,Io=1e3,Uo=(r,t=Io)=>{if(Zs.has(r))return;let s=setTimeout(()=>{Zs.delete(r),hs({type:4,toastId:r})},t);Zs.set(r,s)},Bo=r=>{let{toasts:t,pausedAt:s}=Do(r);b.useEffect(()=>{if(s)return;let i=Date.now(),l=t.map(o=>{if(o.duration===1/0)return;let c=(o.duration||0)+o.pauseDuration-(i-o.createdAt);if(c<0){o.visible&&Ve.dismiss(o.id);return}return setTimeout(()=>Ve.dismiss(o.id),c)});return()=>{l.forEach(o=>o&&clearTimeout(o))}},[t,s]);let n=b.useCallback(()=>{s&&hs({type:6,time:Date.now()})},[s]),a=b.useCallback((i,l)=>{let{reverseOrder:o=!1,gutter:c=8,defaultPosition:d}=l||{},u=t.filter(m=>(m.position||d)===(i.position||d)&&m.height),h=u.findIndex(m=>m.id===i.id),g=u.filter((m,v)=>v<h&&m.visible).length;return u.filter(m=>m.visible).slice(...o?[g+1]:[0,g]).reduce((m,v)=>m+(v.height||0)+c,0)},[t]);return b.useEffect(()=>{t.forEach(i=>{if(i.dismissed)Uo(i.id,i.removeDelay);else{let l=Zs.get(i.id);l&&(clearTimeout(l),Zs.delete(i.id))}})},[t]),{toasts:t,handlers:{updateHeight:Ro,startPause:Fo,endPause:n,calculateOffset:a}}},qo=Ft`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Vo=Ft`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Mo=Ft`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,zo=Zt("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${qo} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Vo} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${r=>r.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Mo} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Wo=Ft`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ho=Zt("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${r=>r.secondary||"#e0e0e0"};
  border-right-color: ${r=>r.primary||"#616161"};
  animation: ${Wo} 1s linear infinite;
`,Go=Ft`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Ko=Ft`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Jo=Zt("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${r=>r.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Go} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Ko} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${r=>r.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Zo=Zt("div")`
  position: absolute;
`,Qo=Zt("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Yo=Ft`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Xo=Zt("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Yo} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,ec=({toast:r})=>{let{icon:t,type:s,iconTheme:n}=r;return t!==void 0?typeof t=="string"?b.createElement(Xo,null,t):t:s==="blank"?null:b.createElement(Qo,null,b.createElement(Ho,{...n}),s!=="loading"&&b.createElement(Zo,null,s==="error"?b.createElement(zo,{...n}):b.createElement(Jo,{...n})))},tc=r=>`
0% {transform: translate3d(0,${r*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,sc=r=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${r*-150}%,-1px) scale(.6); opacity:0;}
`,rc="0%{opacity:0;} 100%{opacity:1;}",nc="0%{opacity:1;} 100%{opacity:0;}",ac=Zt("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,ic=Zt("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,lc=(r,t)=>{let s=r.includes("top")?1:-1,[n,a]=Di()?[rc,nc]:[tc(s),sc(s)];return{animation:t?`${Ft(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Ft(a)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},oc=b.memo(({toast:r,position:t,style:s,children:n})=>{let a=r.height?lc(r.position||t||"top-center",r.visible):{opacity:0},i=b.createElement(ec,{toast:r}),l=b.createElement(ic,{...r.ariaProps},Pr(r.message,r));return b.createElement(ac,{className:r.className,style:{...a,...s,...r.style}},typeof n=="function"?n({icon:i,message:l}):b.createElement(b.Fragment,null,i,l))});Ao(b.createElement);var cc=({id:r,className:t,style:s,onHeightUpdate:n,children:a})=>{let i=b.useCallback(l=>{if(l){let o=()=>{let c=l.getBoundingClientRect().height;n(r,c)};o(),new MutationObserver(o).observe(l,{subtree:!0,childList:!0,characterData:!0})}},[r,n]);return b.createElement("div",{ref:i,className:t,style:s},a)},dc=(r,t)=>{let s=r.includes("top"),n=s?{top:0}:{bottom:0},a=r.includes("center")?{justifyContent:"center"}:r.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Di()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(s?1:-1)}px)`,...n,...a}},uc=zr`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,gr=16,hc=({reverseOrder:r,position:t="top-center",toastOptions:s,gutter:n,children:a,containerStyle:i,containerClassName:l})=>{let{toasts:o,handlers:c}=Bo(s);return b.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:gr,left:gr,right:gr,bottom:gr,pointerEvents:"none",...i},className:l,onMouseEnter:c.startPause,onMouseLeave:c.endPause},o.map(d=>{let u=d.position||t,h=c.calculateOffset(d,{reverseOrder:r,gutter:n,defaultPosition:t}),g=dc(u,h);return b.createElement(cc,{id:d.id,key:d.id,onHeightUpdate:c.updateHeight,className:d.visible?uc:"",style:g},d.type==="custom"?Pr(d.message,d):a?a(d):b.createElement(oc,{toast:d,position:u}))}))},L=Ve;/*! js-cookie v3.0.5 | MIT */function yr(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)r[n]=s[n]}return r}var mc={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Sn(r,t){function s(a,i,l){if(!(typeof document>"u")){l=yr({},t,l),typeof l.expires=="number"&&(l.expires=new Date(Date.now()+l.expires*864e5)),l.expires&&(l.expires=l.expires.toUTCString()),a=encodeURIComponent(a).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var c in l)l[c]&&(o+="; "+c,l[c]!==!0&&(o+="="+l[c].split(";")[0]));return document.cookie=a+"="+r.write(i,a)+o}}function n(a){if(!(typeof document>"u"||arguments.length&&!a)){for(var i=document.cookie?document.cookie.split("; "):[],l={},o=0;o<i.length;o++){var c=i[o].split("="),d=c.slice(1).join("=");try{var u=decodeURIComponent(c[0]);if(l[u]=r.read(d,u),a===u)break}catch{}}return a?l[a]:l}}return Object.create({set:s,get:n,remove:function(a,i){s(a,"",yr({},i,{expires:-1}))},withAttributes:function(a){return Sn(this.converter,yr({},this.attributes,a))},withConverter:function(a){return Sn(yr({},this.converter,a),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(r)}})}var rs=Sn(mc,{path:"/"});const ee=Ql.create({baseURL:"http://localhost:3001/api",timeout:"30000",headers:{"Content-Type":"application/json"}});ee.interceptors.request.use(r=>{const t=rs.get("cotton_trading_token");return t&&(r.headers.Authorization=`Bearer ${t}`),r},r=>Promise.reject(r));ee.interceptors.response.use(r=>r,r=>{const{response:t}=r;return(t==null?void 0:t.status)===401?(rs.remove("cotton_trading_token"),window.location.href="/login",L.error("Session expired. Please log in again.")):(t==null?void 0:t.status)===403?L.error("You do not have permission to perform this action"):(t==null?void 0:t.status)===404?L.error("Resource not found"):(t==null?void 0:t.status)>=500?L.error("Server error. Please try again later."):r.code==="ECONNABORTED"?L.error("Request timeout. Please try again."):t||L.error("Network error. Please check your connection."),Promise.reject(r)});const Ms={login:async(r,t)=>ee.post("/auth/login",{email:r,password:t}),register:async r=>ee.post("/auth/register",r),logout:async()=>ee.post("/auth/logout"),getProfile:async()=>ee.get("/auth/me"),updateProfile:async r=>ee.put("/auth/profile",r)},Ri=b.createContext({}),$e=()=>{const r=b.useContext(Ri);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r},fc=({children:r})=>{const[t,s]=b.useState(null),[n,a]=b.useState(!0);b.useEffect(()=>{(async()=>{try{if(rs.get("cotton_trading_token")){const f=await Ms.getProfile();s(f.data.data.user)}}catch(x){console.error("Auth initialization error:",x),rs.remove("cotton_trading_token")}finally{a(!1)}})()},[]);const i=async(v,x)=>{var f,y,w,j;try{a(!0);const k=await Ms.login(v,x);if(console.log("login response",k),k.data.data.token)return rs.set("cotton_trading_token",k.data.data.token,{expires:7}),s(k.data.data.user),L.success("Login successful!"),{success:!0};throw new Error("No token received")}catch(k){let C=((y=(f=k.response)==null?void 0:f.data)==null?void 0:y.message)||"Login failed";return(j=(w=k.response)==null?void 0:w.data)!=null&&j.errors&&(C+=`
`+k.response.data.errors.map(A=>A.message).join(`
`)),L.error(C),{success:!1,message:C}}finally{a(!1)}},l=async v=>{var x,f,y,w;try{a(!0);const j=await Ms.register(v);if(j.data.data.token)return rs.set("cotton_trading_token",j.data.data.token,{expires:7}),s(j.data.data.user),L.success("Registration successful!"),{success:!0};throw new Error("No token received")}catch(j){let k=((f=(x=j.response)==null?void 0:x.data)==null?void 0:f.message)||"Registration failed";return(w=(y=j.response)==null?void 0:y.data)!=null&&w.errors&&(k+=`
`+j.response.data.errors.map(C=>C.message).join(`
`)),L.error(k),{success:!1,message:k}}finally{a(!1)}},o=async()=>{try{await Ms.logout()}catch(v){console.error("Logout error:",v)}finally{rs.remove("cotton_trading_token"),s(null),L.success("Logged out successfully")}},c=async v=>{var x,f,y,w;try{const j=await Ms.updateProfile(v);return s(j.data.data.user),L.success("Profile updated successfully!"),{success:!0}}catch(j){let k=((f=(x=j.response)==null?void 0:x.data)==null?void 0:f.message)||"Profile update failed";return(w=(y=j.response)==null?void 0:y.data)!=null&&w.errors&&(k+=`
`+j.response.data.errors.map(C=>C.message).join(`
`)),L.error(k),{success:!1,message:k}}},d=v=>t?Array.isArray(v)?v.includes(t.role):t.role===v:!1,m={user:t,loading:n,login:i,register:l,logout:o,updateProfile:c,hasRole:d,isAdmin:()=>d("admin"),isTrader:()=>d("trader"),isCustomer:()=>d("customer")};return e.jsx(Ri.Provider,{value:m,children:r})},xc=({children:r})=>{var v,x;const{user:t,logout:s,isAdmin:n,isTrader:a,isCustomer:i}=$e(),l=Ci(),[o,c]=b.useState(!1),[d,u]=b.useState(!1),g=(()=>{const f=[{name:"Dashboard",href:"/dashboard",icon:no,roles:["admin","trader","customer"]}];return(n()||a())&&f.push({name:"Allocations",href:"/allocations",icon:nt,roles:["admin","trader"]},{name:"Payments",href:"/payments/verified",icon:xt,roles:["admin","trader"]},{name:"Contracts",href:"/contract/search",icon:ve,roles:["admin","trader"]},{name:"Sampling",href:"/sampling-entry",icon:rr,roles:["admin","trader"]},{name:"Sales",href:"/sales-processing",icon:Tr,roles:["admin","trader"]},{name:"DO Specifications",href:"/do-specifications",icon:ve,roles:["admin","trader"]},{name:"DO Specifications History",href:"/do-specifications/history",icon:nt,roles:["admin","trader"]}),n()&&f.push({name:"Pending UTRs",href:"/utr/pending",icon:xt,roles:["admin"]},{name:"Admin Contracts",href:"/admin/contracts",icon:ve,roles:["admin"]},{name:"Lot Override",href:"/admin/lot-override",icon:As,roles:["admin"]}),i()&&f.push({name:"My Lots",href:"/customer/my-lots",icon:As,roles:["customer"]}),f.filter(y=>y.roles.includes(t==null?void 0:t.role))})(),m=async()=>{await s()};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:`fixed inset-0 z-50 lg:hidden ${o?"block":"hidden"}`,children:[e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>c(!1)}),e.jsxs("div",{className:"fixed inset-y-0 left-0 flex w-64 flex-col bg-white shadow-xl",children:[e.jsxs("div",{className:"flex h-16 items-center justify-between px-4",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Cotton Trading"}),e.jsx("button",{onClick:()=>c(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(eo,{className:"h-6 w-6"})})]}),e.jsx("nav",{className:"flex-1 px-4 py-4",children:e.jsx("ul",{className:"space-y-2",children:g.map(f=>e.jsx("li",{children:e.jsxs(Ht,{to:f.href,className:`flex items-center px-4 py-2 text-sm font-medium rounded-md ${l.pathname===f.href?"bg-blue-50 text-blue-700":"text-gray-700 hover:text-gray-900 hover:bg-gray-50"}`,onClick:()=>c(!1),children:[e.jsx(f.icon,{className:"mr-3 h-5 w-5"}),f.name]})},f.name))})})]})]}),e.jsx("div",{className:"hidden lg:fixed lg:inset-y-0 lg:z-50 lg:flex lg:w-64 lg:flex-col",children:e.jsxs("div",{className:"flex grow flex-col gap-y-5 overflow-y-auto border-r border-gray-200 bg-white px-6",children:[e.jsx("div",{className:"flex h-16 shrink-0 items-center",children:e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Cotton Trading"})}),e.jsx("nav",{className:"flex flex-1 flex-col",children:e.jsx("ul",{className:"flex flex-1 flex-col gap-y-7",children:e.jsx("li",{children:e.jsx("ul",{className:"-mx-2 space-y-1",children:g.map(f=>e.jsx("li",{children:e.jsxs(Ht,{to:f.href,className:`group flex gap-x-3 rounded-md p-2 text-sm leading-6 font-semibold ${l.pathname===f.href?"bg-blue-50 text-blue-700":"text-gray-700 hover:text-blue-700 hover:bg-gray-50"}`,children:[e.jsx(f.icon,{className:"h-6 w-6 shrink-0"}),f.name]})},f.name))})})})})]})}),e.jsxs("div",{className:"lg:pl-64",children:[e.jsxs("div",{className:"sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8",children:[e.jsx("button",{type:"button",className:"-m-2.5 p-2.5 text-gray-700 lg:hidden",onClick:()=>c(!0),children:e.jsx(to,{className:"h-6 w-6"})}),e.jsxs("div",{className:"flex flex-1 gap-x-4 self-stretch lg:gap-x-6",children:[e.jsx("div",{className:"flex flex-1"}),e.jsx("div",{className:"flex items-center gap-x-4 lg:gap-x-6",children:e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",className:"flex items-center gap-x-1 text-sm font-semibold leading-6 text-gray-900",onClick:()=>u(!d),children:[e.jsx("span",{className:"sr-only",children:"Open user menu"}),e.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-600 flex items-center justify-center",children:e.jsxs("span",{className:"text-white text-sm font-medium",children:[(v=t==null?void 0:t.first_name)==null?void 0:v[0],(x=t==null?void 0:t.last_name)==null?void 0:x[0]]})}),e.jsxs("span",{className:"hidden lg:flex lg:items-center",children:[e.jsxs("span",{className:"ml-4 text-sm font-semibold leading-6 text-gray-900",children:[t==null?void 0:t.first_name," ",t==null?void 0:t.last_name]}),e.jsx(so,{className:"ml-2 h-5 w-5 text-gray-400"})]})]}),d&&e.jsx("div",{className:"absolute right-0 z-10 mt-2.5 w-32 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-gray-900/5",children:e.jsxs("button",{onClick:m,className:"flex w-full items-center px-3 py-1 text-sm leading-6 text-gray-900 hover:bg-gray-50",children:[e.jsx(ro,{className:"mr-2 h-4 w-4"}),"Sign out"]})})]})})]})]}),e.jsx("main",{className:"py-10",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:r})})]})]})},oe=({size:r="md",className:t=""})=>{const s={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12",xl:"h-16 w-16"};return e.jsx("div",{className:`flex items-center justify-center ${t}`,children:e.jsx("div",{className:`animate-spin rounded-full border-b-2 border-blue-600 ${s[r]}`,role:"status","aria-label":"Loading",children:e.jsx("span",{className:"sr-only",children:"Loading..."})})})},pc=()=>{const{login:r,register:t,loading:s}=$e(),[n,a]=b.useState(!1),[i,l]=b.useState(!1),[o,c]=b.useState({email:"",password:"",first_name:"",last_name:"",role:"trader"}),d=g=>{const{name:m,value:v}=g.target;c(x=>({...x,[m]:v}))},u=async g=>{g.preventDefault(),n?await t(o):await r(o.email,o.password)},h=()=>{a(!n),c({email:"",password:"",first_name:"",last_name:"",role:"trader"})};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:n?"Create your account":"Sign in to your account"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Cotton Trading Management System"})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:u,children:[e.jsxs("div",{className:"space-y-4",children:[n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"first_name",className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("input",{id:"first_name",name:"first_name",type:"text",required:!0,value:o.first_name,onChange:d,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"First Name"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"last_name",className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("input",{id:"last_name",name:"last_name",type:"text",required:!0,value:o.last_name,onChange:d,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Last Name"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:"Role"}),e.jsxs("select",{id:"role",name:"role",value:o.role,onChange:d,className:"mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",children:[e.jsx("option",{value:"trader",children:"Trader"}),e.jsx("option",{value:"customer",children:"Customer"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:o.email,onChange:d,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Email address"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("input",{id:"password",name:"password",type:i?"text":"password",autoComplete:n?"new-password":"current-password",required:!0,value:o.password,onChange:d,className:"appearance-none relative block w-full px-3 py-2 pr-10 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Password"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>l(!i),children:i?e.jsx(ao,{className:"h-5 w-5 text-gray-400"}):e.jsx(Rs,{className:"h-5 w-5 text-gray-400"})})]})]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:s,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:s?e.jsx(oe,{size:"sm"}):n?"Create Account":"Sign In"})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:h,className:"text-blue-600 hover:text-blue-500 text-sm font-medium",children:n?"Already have an account? Sign in":"Don't have an account? Sign up"})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-100 rounded-md",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Demo Credentials:"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Admin:"})," admin@cottontrading.com / password123"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Trader:"})," trader@cottontrading.com / password123"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Customer:"})," customer@cottontrading.com / password123"]})]})]})]})})},Sa=()=>{var h,g,m,v,x,f;const{user:r,isAdmin:t}=$e(),{data:s,isLoading:n}=ba("dashboard-overview",()=>ee.get("/dashboard/overview"),{enabled:t(),refetchInterval:3e4}),{data:a,isLoading:i}=ba("dashboard-alerts",()=>ee.get("/dashboard/alerts"),{enabled:t(),refetchInterval:6e4}),l=((g=(h=s==null?void 0:s.data)==null?void 0:h.data)==null?void 0:g.overview)||{},o=((v=(m=a==null?void 0:a.data)==null?void 0:m.data)==null?void 0:v.alerts)||[],c=b.useRef(null);b.useEffect(()=>{if(t()&&o.length>0){const y=o[0];y&&y.id!==c.current&&(c.current=y.id,L(w=>e.jsxs("span",{children:[e.jsx(Le,{className:"inline h-5 w-5 text-yellow-500 mr-2"}),e.jsx("b",{children:"System Alert:"})," ",y.message,y.action_url&&e.jsxs(e.Fragment,{children:[" ",e.jsx(Ht,{to:y.action_url,className:"underline text-blue-600 ml-2",onClick:()=>L.dismiss(w.id),children:"View"})]})]}),{icon:!1,duration:8e3}))}},[o,t]);const u=(()=>{const y=[];return t()?y.push({name:"View Allocations",href:"/allocations",icon:nt,color:"bg-blue-500"},{name:"Pending UTRs",href:"/utr/pending",icon:xt,color:"bg-yellow-500"},{name:"Admin Contracts",href:"/admin/contracts",icon:ve,color:"bg-green-500"},{name:"Lot Override",href:"/admin/lot-override",icon:As,color:"bg-purple-500"}):(r==null?void 0:r.role)==="trader"?y.push({name:"My Allocations",href:"/allocations",icon:nt,color:"bg-blue-500"},{name:"Upload Contract",href:"/contract/search",icon:ve,color:"bg-green-500"},{name:"Sampling Entry",href:"/sampling-entry",icon:rr,color:"bg-orange-500"},{name:"Sales Processing",href:"/sales-processing",icon:Tr,color:"bg-indigo-500"}):(r==null?void 0:r.role)==="customer"&&y.push({name:"My Lot Assignments",href:"/customer/my-lots",icon:As,color:"bg-purple-500"}),y})();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Welcome back, ",r==null?void 0:r.first_name,"!"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Here's what's happening with your cotton trading operations today."})]}),t()&&o.length>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Le,{className:"h-5 w-5 text-yellow-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-yellow-800",children:["System Alerts (",o.length,")"]}),e.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:o.slice(0,3).map((y,w)=>e.jsx("li",{children:e.jsx(Ht,{to:y.action_url,className:"hover:underline font-medium",children:y.message})},w))})})]})]})}),t()&&e.jsx("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:n?e.jsx("div",{className:"col-span-full flex justify-center py-8",children:e.jsx(oe,{size:"lg"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(nt,{className:"h-6 w-6 text-gray-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Allocations"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:l.total_allocations||0})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(xt,{className:"h-6 w-6 text-gray-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Payments"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:l.total_payments||0})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(rr,{className:"h-6 w-6 text-gray-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Inventory Lots"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:l.total_inventory||0})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(As,{className:"h-6 w-6 text-gray-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Customers"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:l.total_customers||0})]})})]})})})]})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:u.map(y=>e.jsxs(Ht,{to:y.href,className:"relative group bg-white p-6 focus-within:ring-2 focus-within:ring-inset focus-within:ring-blue-500 rounded-lg shadow hover:shadow-md transition-shadow",children:[e.jsx("div",{children:e.jsx("span",{className:`rounded-lg inline-flex p-3 ${y.color} text-white`,children:e.jsx(y.icon,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:[e.jsx("span",{className:"absolute inset-0"}),y.name]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-500",children:["Access ",y.name.toLowerCase()," functionality"]})]})]},y.name))})]}),t()&&((f=(x=s==null?void 0:s.data)==null?void 0:x.data)==null?void 0:f.recent_activities)&&e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Recent Activity"}),e.jsx("div",{className:"space-y-3",children:s.data.data.recent_activities.slice(0,5).map((y,w)=>{var j,k;return e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:[(j=y.users)==null?void 0:j.first_name," ",(k=y.users)==null?void 0:k.last_name]}),e.jsx("span",{className:"text-gray-500 ml-2",children:y.action.replace(/_/g," ").toLowerCase()})]}),e.jsx("div",{className:"text-gray-400 text-xs",children:new Date(y.created_at).toLocaleDateString()})]},w)})})]})})]})},gc="modulepreload",yc=function(r){return"/"+r},ka={},cr=function(t,s,n){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),o=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(s.map(c=>{if(c=yc(c),c in ka)return;ka[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":gc,d||(h.as="script"),h.crossOrigin="",h.href=c,o&&h.setAttribute("nonce",o),document.head.appendChild(h),d)return new Promise((g,m)=>{h.addEventListener("load",g),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return a.then(l=>{for(const o of l||[])o.status==="rejected"&&i(o.reason);return t().catch(i)})},bc=r=>{let t;return r?t=r:typeof fetch>"u"?t=(...s)=>cr(async()=>{const{default:n}=await Promise.resolve().then(()=>Fs);return{default:n}},void 0).then(({default:n})=>n(...s)):t=fetch,(...s)=>t(...s)};class zn extends Error{constructor(t,s="FunctionsError",n){super(t),this.name=s,this.context=n}}class vc extends zn{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Ea extends zn{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Ca extends zn{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var kn;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(kn||(kn={}));var jc=function(r,t,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(h){l(h)}}function c(u){try{d(n.throw(u))}catch(h){l(h)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(r,t||[])).next())})};class wc{constructor(t,{headers:s={},customFetch:n,region:a=kn.Any}={}){this.url=t,this.headers=s,this.region=a,this.fetch=bc(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,s={}){var n;return jc(this,void 0,void 0,function*(){try{const{headers:a,method:i,body:l}=s;let o={},{region:c}=s;c||(c=this.region);const d=new URL(`${this.url}/${t}`);c&&c!=="any"&&(o["x-region"]=c,d.searchParams.set("forceFunctionRegion",c));let u;l&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&(typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",u=l):typeof l=="string"?(o["Content-Type"]="text/plain",u=l):typeof FormData<"u"&&l instanceof FormData?u=l:(o["Content-Type"]="application/json",u=JSON.stringify(l)));const h=yield this.fetch(d.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),a),body:u}).catch(x=>{throw new vc(x)}),g=h.headers.get("x-relay-error");if(g&&g==="true")throw new Ea(h);if(!h.ok)throw new Ca(h);let m=((n=h.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),v;return m==="application/json"?v=yield h.json():m==="application/octet-stream"?v=yield h.blob():m==="text/event-stream"?v=h:m==="multipart/form-data"?v=yield h.formData():v=yield h.text(),{data:v,error:null,response:h}}catch(a){return{data:null,error:a,response:a instanceof Ca||a instanceof Ea?a.context:void 0}}})}}var Je={},Wn={},Wr={},dr={},Hr={},Gr={},_c=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},$s=_c();const Nc=$s.fetch,Fi=$s.fetch.bind($s),Ii=$s.Headers,Sc=$s.Request,kc=$s.Response,Fs=Object.freeze(Object.defineProperty({__proto__:null,Headers:Ii,Request:Sc,Response:kc,default:Fi,fetch:Nc},Symbol.toStringTag,{value:"Module"})),Ec=Gl(Fs);var Kr={};Object.defineProperty(Kr,"__esModule",{value:!0});let Cc=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};Kr.default=Cc;var Ui=at&&at.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Gr,"__esModule",{value:!0});const Ac=Ui(Ec),Tc=Ui(Kr);let Oc=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=Ac.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,s){return this.headers=Object.assign({},this.headers),this.headers[t]=s,this}then(t,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const n=this.fetch;let a=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var l,o,c;let d=null,u=null,h=null,g=i.status,m=i.statusText;if(i.ok){if(this.method!=="HEAD"){const y=await i.text();y===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=y:u=JSON.parse(y))}const x=(l=this.headers.Prefer)===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),f=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");x&&f&&f.length>1&&(h=parseInt(f[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(d={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,g=406,m="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const x=await i.text();try{d=JSON.parse(x),Array.isArray(d)&&i.status===404&&(u=[],d=null,g=200,m="OK")}catch{i.status===404&&x===""?(g=204,m="No Content"):d={message:x}}if(d&&this.isMaybeSingle&&(!((c=d==null?void 0:d.details)===null||c===void 0)&&c.includes("0 rows"))&&(d=null,g=200,m="OK"),d&&this.shouldThrowOnError)throw new Tc.default(d)}return{error:d,data:u,count:h,status:g,statusText:m}});return this.shouldThrowOnError||(a=a.catch(i=>{var l,o,c;return{error:{message:`${(l=i==null?void 0:i.name)!==null&&l!==void 0?l:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),a.then(t,s)}returns(){return this}overrideTypes(){return this}};Gr.default=Oc;var Pc=at&&at.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Hr,"__esModule",{value:!0});const $c=Pc(Gr);let Dc=class extends $c.default{select(t){let s=!1;const n=(t??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:s=!0,nullsFirst:n,foreignTable:a,referencedTable:i=a}={}){const l=i?`${i}.order`:"order",o=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${o?`${o},`:""}${t}.${s?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:s,referencedTable:n=s}={}){const a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(a,`${t}`),this}range(t,s,{foreignTable:n,referencedTable:a=n}={}){const i=typeof a>"u"?"offset":`${a}.offset`,l=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(i,`${t}`),this.url.searchParams.set(l,`${s-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:s=!1,settings:n=!1,buffers:a=!1,wal:i=!1,format:l="text"}={}){var o;const c=[t?"analyze":null,s?"verbose":null,n?"settings":null,a?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${l}; for="${d}"; options=${c};`,l==="json"?this:this}rollback(){var t;return((t=this.headers.Prefer)!==null&&t!==void 0?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Hr.default=Dc;var Lc=at&&at.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(dr,"__esModule",{value:!0});const Rc=Lc(Hr);let Fc=class extends Rc.default{eq(t,s){return this.url.searchParams.append(t,`eq.${s}`),this}neq(t,s){return this.url.searchParams.append(t,`neq.${s}`),this}gt(t,s){return this.url.searchParams.append(t,`gt.${s}`),this}gte(t,s){return this.url.searchParams.append(t,`gte.${s}`),this}lt(t,s){return this.url.searchParams.append(t,`lt.${s}`),this}lte(t,s){return this.url.searchParams.append(t,`lte.${s}`),this}like(t,s){return this.url.searchParams.append(t,`like.${s}`),this}likeAllOf(t,s){return this.url.searchParams.append(t,`like(all).{${s.join(",")}}`),this}likeAnyOf(t,s){return this.url.searchParams.append(t,`like(any).{${s.join(",")}}`),this}ilike(t,s){return this.url.searchParams.append(t,`ilike.${s}`),this}ilikeAllOf(t,s){return this.url.searchParams.append(t,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(t,s){return this.url.searchParams.append(t,`ilike(any).{${s.join(",")}}`),this}is(t,s){return this.url.searchParams.append(t,`is.${s}`),this}in(t,s){const n=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}contains(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cs.{${s.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(s)}`),this}containedBy(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cd.{${s.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(s)}`),this}rangeGt(t,s){return this.url.searchParams.append(t,`sr.${s}`),this}rangeGte(t,s){return this.url.searchParams.append(t,`nxl.${s}`),this}rangeLt(t,s){return this.url.searchParams.append(t,`sl.${s}`),this}rangeLte(t,s){return this.url.searchParams.append(t,`nxr.${s}`),this}rangeAdjacent(t,s){return this.url.searchParams.append(t,`adj.${s}`),this}overlaps(t,s){return typeof s=="string"?this.url.searchParams.append(t,`ov.${s}`):this.url.searchParams.append(t,`ov.{${s.join(",")}}`),this}textSearch(t,s,{config:n,type:a}={}){let i="";a==="plain"?i="pl":a==="phrase"?i="ph":a==="websearch"&&(i="w");const l=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${i}fts${l}.${s}`),this}match(t){return Object.entries(t).forEach(([s,n])=>{this.url.searchParams.append(s,`eq.${n}`)}),this}not(t,s,n){return this.url.searchParams.append(t,`not.${s}.${n}`),this}or(t,{foreignTable:s,referencedTable:n=s}={}){const a=n?`${n}.or`:"or";return this.url.searchParams.append(a,`(${t})`),this}filter(t,s,n){return this.url.searchParams.append(t,`${s}.${n}`),this}};dr.default=Fc;var Ic=at&&at.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Wr,"__esModule",{value:!0});const zs=Ic(dr);let Uc=class{constructor(t,{headers:s={},schema:n,fetch:a}){this.url=t,this.headers=s,this.schema=n,this.fetch=a}select(t,{head:s=!1,count:n}={}){const a=s?"HEAD":"GET";let i=!1;const l=(t??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",l),n&&(this.headers.Prefer=`count=${n}`),new zs.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:s,defaultToNull:n=!0}={}){const a="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),s&&i.push(`count=${s}`),n||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(t)){const l=t.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(l.length>0){const o=[...new Set(l)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new zs.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:s,ignoreDuplicates:n=!1,count:a,defaultToNull:i=!0}={}){const l="POST",o=[`resolution=${n?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&o.push(this.headers.Prefer),a&&o.push(`count=${a}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(t)){const c=t.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new zs.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:s}={}){const n="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),this.headers.Prefer=a.join(","),new zs.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const s="DELETE",n=[];return t&&n.push(`count=${t}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new zs.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Wr.default=Uc;var Jr={},Zr={};Object.defineProperty(Zr,"__esModule",{value:!0});Zr.version=void 0;Zr.version="0.0.0-automated";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.DEFAULT_HEADERS=void 0;const Bc=Zr;Jr.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Bc.version}`};var Bi=at&&at.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Wn,"__esModule",{value:!0});const qc=Bi(Wr),Vc=Bi(dr),Mc=Jr;let zc=class qi{constructor(t,{headers:s={},schema:n,fetch:a}={}){this.url=t,this.headers=Object.assign(Object.assign({},Mc.DEFAULT_HEADERS),s),this.schemaName=n,this.fetch=a}from(t){const s=new URL(`${this.url}/${t}`);return new qc.default(s,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new qi(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:n=!1,get:a=!1,count:i}={}){let l;const o=new URL(`${this.url}/rpc/${t}`);let c;n||a?(l=n?"HEAD":"GET",Object.entries(s).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{o.searchParams.append(u,h)})):(l="POST",c=s);const d=Object.assign({},this.headers);return i&&(d.Prefer=`count=${i}`),new Vc.default({method:l,url:o,headers:d,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};Wn.default=zc;var Is=at&&at.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Je,"__esModule",{value:!0});Je.PostgrestError=Je.PostgrestBuilder=Je.PostgrestTransformBuilder=Je.PostgrestFilterBuilder=Je.PostgrestQueryBuilder=Je.PostgrestClient=void 0;const Vi=Is(Wn);Je.PostgrestClient=Vi.default;const Mi=Is(Wr);Je.PostgrestQueryBuilder=Mi.default;const zi=Is(dr);Je.PostgrestFilterBuilder=zi.default;const Wi=Is(Hr);Je.PostgrestTransformBuilder=Wi.default;const Hi=Is(Gr);Je.PostgrestBuilder=Hi.default;const Gi=Is(Kr);Je.PostgrestError=Gi.default;var Wc=Je.default={PostgrestClient:Vi.default,PostgrestQueryBuilder:Mi.default,PostgrestFilterBuilder:zi.default,PostgrestTransformBuilder:Wi.default,PostgrestBuilder:Hi.default,PostgrestError:Gi.default};const{PostgrestClient:Hc,PostgrestQueryBuilder:Bf,PostgrestFilterBuilder:qf,PostgrestTransformBuilder:Vf,PostgrestBuilder:Mf,PostgrestError:zf}=Wc;function Gc(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Kc=Gc(),Jc="2.11.15",Zc=`realtime-js/${Jc}`,Qc="1.0.0",Ki=1e4,Yc=1e3;var Qs;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Qs||(Qs={}));var Ie;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Ie||(Ie={}));var ht;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(ht||(ht={}));var En;(function(r){r.websocket="websocket"})(En||(En={}));var ns;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(ns||(ns={}));class Xc{constructor(){this.HEADER_LENGTH=1}decode(t,s){return t.constructor===ArrayBuffer?s(this._binaryDecode(t)):s(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const s=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,s,n)}_decodeBroadcast(t,s,n){const a=s.getUint8(1),i=s.getUint8(2);let l=this.HEADER_LENGTH+2;const o=n.decode(t.slice(l,l+a));l=l+a;const c=n.decode(t.slice(l,l+i));l=l+i;const d=JSON.parse(n.decode(t.slice(l,t.byteLength)));return{ref:null,topic:o,event:c,payload:d}}}class Ji{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ge;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(ge||(ge={}));const Aa=(r,t,s={})=>{var n;const a=(n=s.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(t).reduce((i,l)=>(i[l]=ed(l,r,t,a),i),{})},ed=(r,t,s,n)=>{const a=t.find(o=>o.name===r),i=a==null?void 0:a.type,l=s[r];return i&&!n.includes(i)?Zi(i,l):Cn(l)},Zi=(r,t)=>{if(r.charAt(0)==="_"){const s=r.slice(1,r.length);return nd(t,s)}switch(r){case ge.bool:return td(t);case ge.float4:case ge.float8:case ge.int2:case ge.int4:case ge.int8:case ge.numeric:case ge.oid:return sd(t);case ge.json:case ge.jsonb:return rd(t);case ge.timestamp:return ad(t);case ge.abstime:case ge.date:case ge.daterange:case ge.int4range:case ge.int8range:case ge.money:case ge.reltime:case ge.text:case ge.time:case ge.timestamptz:case ge.timetz:case ge.tsrange:case ge.tstzrange:return Cn(t);default:return Cn(t)}},Cn=r=>r,td=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},sd=r=>{if(typeof r=="string"){const t=parseFloat(r);if(!Number.isNaN(t))return t}return r},rd=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(t){return console.log(`JSON parse error: ${t}`),r}return r},nd=(r,t)=>{if(typeof r!="string")return r;const s=r.length-1,n=r[s];if(r[0]==="{"&&n==="}"){let i;const l=r.slice(1,s);try{i=JSON.parse("["+l+"]")}catch{i=l?l.split(","):[]}return i.map(o=>Zi(t,o))}return r},ad=r=>typeof r=="string"?r.replace(" ","T"):r,Qi=r=>{let t=r;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class dn{constructor(t,s,n={},a=Ki){this.channel=t,this.event=s,this.payload=n,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var n;return this._hasReceived(t)&&s((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Ta;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Ta||(Ta={}));class Ys{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},a=>{const{onJoin:i,onLeave:l,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ys.syncState(this.state,a,i,l),this.pendingDiffs.forEach(c=>{this.state=Ys.syncDiff(this.state,c,i,l)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},a=>{const{onJoin:i,onLeave:l,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Ys.syncDiff(this.state,a,i,l),o())}),this.onJoin((a,i,l)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:i,newPresences:l})}),this.onLeave((a,i,l)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:i,leftPresences:l})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,n,a){const i=this.cloneDeep(t),l=this.transformState(s),o={},c={};return this.map(i,(d,u)=>{l[d]||(c[d]=u)}),this.map(l,(d,u)=>{const h=i[d];if(h){const g=u.map(f=>f.presence_ref),m=h.map(f=>f.presence_ref),v=u.filter(f=>m.indexOf(f.presence_ref)<0),x=h.filter(f=>g.indexOf(f.presence_ref)<0);v.length>0&&(o[d]=v),x.length>0&&(c[d]=x)}else o[d]=u}),this.syncDiff(i,{joins:o,leaves:c},n,a)}static syncDiff(t,s,n,a){const{joins:i,leaves:l}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return n||(n=()=>{}),a||(a=()=>{}),this.map(i,(o,c)=>{var d;const u=(d=t[o])!==null&&d!==void 0?d:[];if(t[o]=this.cloneDeep(c),u.length>0){const h=t[o].map(m=>m.presence_ref),g=u.filter(m=>h.indexOf(m.presence_ref)<0);t[o].unshift(...g)}n(o,u,c)}),this.map(l,(o,c)=>{let d=t[o];if(!d)return;const u=c.map(h=>h.presence_ref);d=d.filter(h=>u.indexOf(h.presence_ref)<0),t[o]=d,a(o,d,c),d.length===0&&delete t[o]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(n=>s(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,n)=>{const a=t[n];return"metas"in a?s[n]=a.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):s[n]=a,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Oa;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Oa||(Oa={}));var Pa;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Pa||(Pa={}));var Lt;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Lt||(Lt={}));class Hn{constructor(t,s={config:{}},n){this.topic=t,this.params=s,this.socket=n,this.bindings={},this.state=Ie.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new dn(this,ht.join,this.params,this.timeout),this.rejoinTimer=new Ji(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ie.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ie.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Ie.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ie.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ht.reply,{},(a,i)=>{this._trigger(this._replyEventName(i),a)}),this.presence=new Ys(this),this.broadcastEndpointURL=Qi(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,s=this.timeout){var n,a;if(this.socket.isConnected()||this.socket.connect(),this.state==Ie.closed){const{config:{broadcast:i,presence:l,private:o}}=this.params;this._onError(u=>t==null?void 0:t(Lt.CHANNEL_ERROR,u)),this._onClose(()=>t==null?void 0:t(Lt.CLOSED));const c={},d={broadcast:i,presence:l,postgres_changes:(a=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(u=>u.filter))!==null&&a!==void 0?a:[],private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){t==null||t(Lt.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,m=(h=g==null?void 0:g.length)!==null&&h!==void 0?h:0,v=[];for(let x=0;x<m;x++){const f=g[x],{filter:{event:y,schema:w,table:j,filter:k}}=f,C=u&&u[x];if(C&&C.event===y&&C.schema===w&&C.table===j&&C.filter===k)v.push(Object.assign(Object.assign({},f),{id:C.id}));else{this.unsubscribe(),this.state=Ie.errored,t==null||t(Lt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,t&&t(Lt.SUBSCRIBED);return}}).receive("error",u=>{this.state=Ie.errored,t==null||t(Lt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Lt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,n){return this._on(t,s,n)}async send(t,s={}){var n,a;if(!this._canPush()&&t.type==="broadcast"){const{event:i,payload:l}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:l,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);return await((a=d.body)===null||a===void 0?void 0:a.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var l,o,c;const d=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(o=(l=this.params)===null||l===void 0?void 0:l.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Ie.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ht.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(a=>{n=new dn(this,ht.leave,{},t),n.receive("ok",()=>{s(),a("ok")}).receive("timeout",()=>{s(),a("timed out")}).receive("error",()=>{a("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(t,s,n){const a=new AbortController,i=setTimeout(()=>a.abort(),n),l=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:a.signal}));return clearTimeout(i),l}_push(t,s,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new dn(this,t,s,n);return this._canPush()?a.send():(a.startTimeout(),this.pushBuffer.push(a)),a}_onMessage(t,s,n){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,n){var a,i;const l=t.toLocaleLowerCase(),{close:o,error:c,leave:d,join:u}=ht;if(n&&[o,c,d,u].indexOf(l)>=0&&n!==this._joinRef())return;let g=this._onMessage(l,s,n);if(s&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(l)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(m=>{var v,x,f;return((v=m.filter)===null||v===void 0?void 0:v.event)==="*"||((f=(x=m.filter)===null||x===void 0?void 0:x.event)===null||f===void 0?void 0:f.toLocaleLowerCase())===l}).map(m=>m.callback(g,n)):(i=this.bindings[l])===null||i===void 0||i.filter(m=>{var v,x,f,y,w,j;if(["broadcast","presence","postgres_changes"].includes(l))if("id"in m){const k=m.id,C=(v=m.filter)===null||v===void 0?void 0:v.event;return k&&((x=s.ids)===null||x===void 0?void 0:x.includes(k))&&(C==="*"||(C==null?void 0:C.toLocaleLowerCase())===((f=s.data)===null||f===void 0?void 0:f.type.toLocaleLowerCase()))}else{const k=(w=(y=m==null?void 0:m.filter)===null||y===void 0?void 0:y.event)===null||w===void 0?void 0:w.toLocaleLowerCase();return k==="*"||k===((j=s==null?void 0:s.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===l}).map(m=>{if(typeof g=="object"&&"ids"in g){const v=g.data,{schema:x,table:f,commit_timestamp:y,type:w,errors:j}=v;g=Object.assign(Object.assign({},{schema:x,table:f,commit_timestamp:y,eventType:w,new:{},old:{},errors:j}),this._getPayloadRecords(v))}m.callback(g,n)})}_isClosed(){return this.state===Ie.closed}_isJoined(){return this.state===Ie.joined}_isJoining(){return this.state===Ie.joining}_isLeaving(){return this.state===Ie.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,n){const a=t.toLocaleLowerCase(),i={type:a,filter:s,callback:n};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(t,s){const n=t.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(a=>{var i;return!(((i=a.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&Hn.isEqual(a.filter,s))}),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const n in t)if(t[n]!==s[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(ht.close,{},t)}_onError(t){this._on(ht.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ie.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=Aa(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=Aa(t.columns,t.old_record)),s}}const $a=()=>{},id=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ld{constructor(t,s){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ki,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=$a,this.ref=0,this.logger=$a,this.conn=null,this.sendBuffer=[],this.serializer=new Xc,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let l;return i?l=i:typeof fetch>"u"?l=(...o)=>cr(async()=>{const{default:c}=await Promise.resolve().then(()=>Fs);return{default:c}},void 0).then(({default:c})=>c(...o)):l=fetch,(...o)=>l(...o)},this.endPoint=`${t}/${En.websocket}`,this.httpEndpoint=Qi(t),s!=null&&s.transport?this.transport=s.transport:this.transport=null,s!=null&&s.params&&(this.params=s.params),s!=null&&s.timeout&&(this.timeout=s.timeout),s!=null&&s.logger&&(this.logger=s.logger),(s!=null&&s.logLevel||s!=null&&s.log_level)&&(this.logLevel=s.logLevel||s.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),s!=null&&s.heartbeatIntervalMs&&(this.heartbeatIntervalMs=s.heartbeatIntervalMs);const a=(n=s==null?void 0:s.params)===null||n===void 0?void 0:n.apikey;if(a&&(this.accessTokenValue=a,this.apiKey=a),this.reconnectAfterMs=s!=null&&s.reconnectAfterMs?s.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=s!=null&&s.encode?s.encode:(i,l)=>l(JSON.stringify(i)),this.decode=s!=null&&s.decode?s.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Ji(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(s==null?void 0:s.fetch),s!=null&&s.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(s==null?void 0:s.worker)||!1,this.workerUrl=s==null?void 0:s.workerUrl}this.accessToken=(s==null?void 0:s.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Kc),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Qc}))}disconnect(t,s){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,s??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(n=>n.teardown()))}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,n){this.logger(t,s,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Qs.connecting:return ns.Connecting;case Qs.open:return ns.Open;case Qs.closing:return ns.Closing;default:return ns.Closed}}isConnected(){return this.connectionState()===ns.Open}channel(t,s={config:{}}){const n=`realtime:${t}`,a=this.getChannels().find(i=>i.topic===n);if(a)return a;{const i=new Hn(`realtime:${t}`,s,this);return this.channels.push(i),i}}push(t){const{topic:s,event:n,payload:a,ref:i}=t,l=()=>{this.encode(t,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${s} ${n} (${i})`,a),this.isConnected()?l():this.sendBuffer.push(l)}async setAuth(t=null){let s=t||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(n=>{const a={access_token:s,version:Zc};s&&n.updateJoinPayload(a),n.joinedOnce&&n._isJoined()&&n._push(ht.access_token,{access_token:s})}))}async sendHeartbeat(){var t;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(t=this.conn)===null||t===void 0||t.close(Yc,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_onConnMessage(t){this.decode(t.data,s=>{let{topic:n,event:a,payload:i,ref:l}=s;n==="phoenix"&&a==="phx_reply"&&this.heartbeatCallback(s.payload.status=="ok"?"ok":"error"),l&&l===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${n} ${a} ${l&&"("+l+")"||""}`,i),Array.from(this.channels).filter(o=>o._isMember(n)).forEach(o=>o._trigger(a,i,l)),this.stateChangeCallbacks.message.forEach(o=>o(s))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(t=>t())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(s=>s(t))}_onConnError(t){this.log("transport",`${t}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(s=>s(t))}_triggerChanError(){this.channels.forEach(t=>t._trigger(ht.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const n=t.match(/\?/)?"&":"?",a=new URLSearchParams(s);return`${t}${n}${a}`}_workerObjectUrl(t){let s;if(t)s=t;else{const n=new Blob([id],{type:"application/javascript"});s=URL.createObjectURL(n)}return s}}class Gn extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function Pe(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class od extends Gn{constructor(t,s){super(t),this.name="StorageApiError",this.status=s}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class An extends Gn{constructor(t,s){super(t),this.name="StorageUnknownError",this.originalError=s}}var cd=function(r,t,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(h){l(h)}}function c(u){try{d(n.throw(u))}catch(h){l(h)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(r,t||[])).next())})};const Yi=r=>{let t;return r?t=r:typeof fetch>"u"?t=(...s)=>cr(async()=>{const{default:n}=await Promise.resolve().then(()=>Fs);return{default:n}},void 0).then(({default:n})=>n(...s)):t=fetch,(...s)=>t(...s)},dd=()=>cd(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield cr(()=>Promise.resolve().then(()=>Fs),void 0)).Response:Response}),Tn=r=>{if(Array.isArray(r))return r.map(s=>Tn(s));if(typeof r=="function"||r!==Object(r))return r;const t={};return Object.entries(r).forEach(([s,n])=>{const a=s.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[a]=Tn(n)}),t};var ms=function(r,t,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(h){l(h)}}function c(u){try{d(n.throw(u))}catch(h){l(h)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(r,t||[])).next())})};const un=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),ud=(r,t,s)=>ms(void 0,void 0,void 0,function*(){const n=yield dd();r instanceof n&&!(s!=null&&s.noResolveJson)?r.json().then(a=>{t(new od(un(a),r.status||500))}).catch(a=>{t(new An(un(a),a))}):t(new An(un(r),r))}),hd=(r,t,s,n)=>{const a={method:r,headers:(t==null?void 0:t.headers)||{}};return r==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),n&&(a.body=JSON.stringify(n)),Object.assign(Object.assign({},a),s))};function ur(r,t,s,n,a,i){return ms(this,void 0,void 0,function*(){return new Promise((l,o)=>{r(s,hd(t,n,a,i)).then(c=>{if(!c.ok)throw c;return n!=null&&n.noResolveJson?c:c.json()}).then(c=>l(c)).catch(c=>ud(c,o,n))})})}function $r(r,t,s,n){return ms(this,void 0,void 0,function*(){return ur(r,"GET",t,s,n)})}function qt(r,t,s,n,a){return ms(this,void 0,void 0,function*(){return ur(r,"POST",t,n,a,s)})}function md(r,t,s,n,a){return ms(this,void 0,void 0,function*(){return ur(r,"PUT",t,n,a,s)})}function fd(r,t,s,n){return ms(this,void 0,void 0,function*(){return ur(r,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),n)})}function Xi(r,t,s,n,a){return ms(this,void 0,void 0,function*(){return ur(r,"DELETE",t,n,a,s)})}var He=function(r,t,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(h){l(h)}}function c(u){try{d(n.throw(u))}catch(h){l(h)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(r,t||[])).next())})};const xd={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Da={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class pd{constructor(t,s={},n,a){this.url=t,this.headers=s,this.bucketId=n,this.fetch=Yi(a)}uploadOrUpdate(t,s,n,a){return He(this,void 0,void 0,function*(){try{let i;const l=Object.assign(Object.assign({},Da),a);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(l.upsert)});const c=l.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",l.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.append("cacheControl",l.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=n,o["cache-control"]=`max-age=${l.cacheControl}`,o["content-type"]=l.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),a!=null&&a.headers&&(o=Object.assign(Object.assign({},o),a.headers));const d=this._removeEmptyFolders(s),u=this._getFinalPath(d),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:t,body:i,headers:o},l!=null&&l.duplex?{duplex:l.duplex}:{})),g=yield h.json();return h.ok?{data:{path:d,id:g.Id,fullPath:g.Key},error:null}:{data:null,error:g}}catch(i){if(Pe(i))return{data:null,error:i};throw i}})}upload(t,s,n){return He(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,s,n)})}uploadToSignedUrl(t,s,n,a){return He(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(t),l=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${l}`);o.searchParams.set("token",s);try{let c;const d=Object.assign({upsert:Da.upsert},a),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",d.cacheControl)):(c=n,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u}),g=yield h.json();return h.ok?{data:{path:i,fullPath:g.Key},error:null}:{data:null,error:g}}catch(c){if(Pe(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,s){return He(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const a=Object.assign({},this.headers);s!=null&&s.upsert&&(a["x-upsert"]="true");const i=yield qt(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:a}),l=new URL(this.url+i.url),o=l.searchParams.get("token");if(!o)throw new Gn("No token returned by API");return{data:{signedUrl:l.toString(),path:t,token:o},error:null}}catch(n){if(Pe(n))return{data:null,error:n};throw n}})}update(t,s,n){return He(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,s,n)})}move(t,s,n){return He(this,void 0,void 0,function*(){try{return{data:yield qt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(Pe(a))return{data:null,error:a};throw a}})}copy(t,s,n){return He(this,void 0,void 0,function*(){try{return{data:{path:(yield qt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(Pe(a))return{data:null,error:a};throw a}})}createSignedUrl(t,s,n){return He(this,void 0,void 0,function*(){try{let a=this._getFinalPath(t),i=yield qt(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:s},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const l=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${l}`)},{data:i,error:null}}catch(a){if(Pe(a))return{data:null,error:a};throw a}})}createSignedUrls(t,s,n){return He(this,void 0,void 0,function*(){try{const a=yield qt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:t},{headers:this.headers}),i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:a.map(l=>Object.assign(Object.assign({},l),{signedUrl:l.signedURL?encodeURI(`${this.url}${l.signedURL}${i}`):null})),error:null}}catch(a){if(Pe(a))return{data:null,error:a};throw a}})}download(t,s){return He(this,void 0,void 0,function*(){const a=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),l=i?`?${i}`:"";try{const o=this._getFinalPath(t);return{data:yield(yield $r(this.fetch,`${this.url}/${a}/${o}${l}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(Pe(o))return{data:null,error:o};throw o}})}info(t){return He(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{const n=yield $r(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:Tn(n),error:null}}catch(n){if(Pe(n))return{data:null,error:n};throw n}})}exists(t){return He(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{return yield fd(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(Pe(n)&&n instanceof An){const a=n.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,s){const n=this._getFinalPath(t),a=[],i=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";i!==""&&a.push(i);const o=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});c!==""&&a.push(c);let d=a.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${n}${d}`)}}}remove(t){return He(this,void 0,void 0,function*(){try{return{data:yield Xi(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(s){if(Pe(s))return{data:null,error:s};throw s}})}list(t,s,n){return He(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},xd),s),{prefix:t||""});return{data:yield qt(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},n),error:null}}catch(a){if(Pe(a))return{data:null,error:a};throw a}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const s=[];return t.width&&s.push(`width=${t.width}`),t.height&&s.push(`height=${t.height}`),t.resize&&s.push(`resize=${t.resize}`),t.format&&s.push(`format=${t.format}`),t.quality&&s.push(`quality=${t.quality}`),s.join("&")}}const gd="2.7.1",yd={"X-Client-Info":`storage-js/${gd}`};var vs=function(r,t,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(h){l(h)}}function c(u){try{d(n.throw(u))}catch(h){l(h)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(r,t||[])).next())})};class bd{constructor(t,s={},n){this.url=t,this.headers=Object.assign(Object.assign({},yd),s),this.fetch=Yi(n)}listBuckets(){return vs(this,void 0,void 0,function*(){try{return{data:yield $r(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(Pe(t))return{data:null,error:t};throw t}})}getBucket(t){return vs(this,void 0,void 0,function*(){try{return{data:yield $r(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(s){if(Pe(s))return{data:null,error:s};throw s}})}createBucket(t,s={public:!1}){return vs(this,void 0,void 0,function*(){try{return{data:yield qt(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Pe(n))return{data:null,error:n};throw n}})}updateBucket(t,s){return vs(this,void 0,void 0,function*(){try{return{data:yield md(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(Pe(n))return{data:null,error:n};throw n}})}emptyBucket(t){return vs(this,void 0,void 0,function*(){try{return{data:yield qt(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(Pe(s))return{data:null,error:s};throw s}})}deleteBucket(t){return vs(this,void 0,void 0,function*(){try{return{data:yield Xi(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(s){if(Pe(s))return{data:null,error:s};throw s}})}}class vd extends bd{constructor(t,s={},n){super(t,s,n)}from(t){return new pd(this.url,this.headers,t,this.fetch)}}const jd="2.50.3";let Gs="";typeof Deno<"u"?Gs="deno":typeof document<"u"?Gs="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Gs="react-native":Gs="node";const wd={"X-Client-Info":`supabase-js-${Gs}/${jd}`},_d={headers:wd},Nd={schema:"public"},Sd={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},kd={};var Ed=function(r,t,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(h){l(h)}}function c(u){try{d(n.throw(u))}catch(h){l(h)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(r,t||[])).next())})};const Cd=r=>{let t;return r?t=r:typeof fetch>"u"?t=Fi:t=fetch,(...s)=>t(...s)},Ad=()=>typeof Headers>"u"?Ii:Headers,Td=(r,t,s)=>{const n=Cd(s),a=Ad();return(i,l)=>Ed(void 0,void 0,void 0,function*(){var o;const c=(o=yield t())!==null&&o!==void 0?o:r;let d=new a(l==null?void 0:l.headers);return d.has("apikey")||d.set("apikey",r),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),n(i,Object.assign(Object.assign({},l),{headers:d}))})};var Od=function(r,t,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(h){l(h)}}function c(u){try{d(n.throw(u))}catch(h){l(h)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(r,t||[])).next())})};function Pd(r){return r.endsWith("/")?r:r+"/"}function $d(r,t){var s,n;const{db:a,auth:i,realtime:l,global:o}=r,{db:c,auth:d,realtime:u,global:h}=t,g={db:Object.assign(Object.assign({},c),a),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},u),l),global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},(s=h==null?void 0:h.headers)!==null&&s!==void 0?s:{}),(n=o==null?void 0:o.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>Od(this,void 0,void 0,function*(){return""})};return r.accessToken?g.accessToken=r.accessToken:delete g.accessToken,g}const el="2.70.0",Es=30*1e3,On=3,hn=On*Es,Dd="http://localhost:9999",Ld="supabase.auth.token",Rd={"X-Client-Info":`gotrue-js/${el}`},Pn="X-Supabase-Api-Version",tl={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Fd=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Id=6e5;class Kn extends Error{constructor(t,s,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=n}}function ae(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Ud extends Kn{constructor(t,s,n){super(t,s,n),this.name="AuthApiError",this.status=s,this.code=n}}function Bd(r){return ae(r)&&r.name==="AuthApiError"}class sl extends Kn{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class Qt extends Kn{constructor(t,s,n,a){super(t,n,a),this.name=s,this.status=n}}class Ut extends Qt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function qd(r){return ae(r)&&r.name==="AuthSessionMissingError"}class br extends Qt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class vr extends Qt{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class jr extends Qt{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Vd(r){return ae(r)&&r.name==="AuthImplicitGrantRedirectError"}class La extends Qt{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class $n extends Qt{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function mn(r){return ae(r)&&r.name==="AuthRetryableFetchError"}class Ra extends Qt{constructor(t,s,n){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=n}}class Xs extends Qt{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Dr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Fa=` 	
\r=`.split(""),Md=(()=>{const r=new Array(128);for(let t=0;t<r.length;t+=1)r[t]=-1;for(let t=0;t<Fa.length;t+=1)r[Fa[t].charCodeAt(0)]=-2;for(let t=0;t<Dr.length;t+=1)r[Dr[t].charCodeAt(0)]=t;return r})();function Ia(r,t,s){if(r!==null)for(t.queue=t.queue<<8|r,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;s(Dr[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;s(Dr[n]),t.queuedBits-=6}}function rl(r,t,s){const n=Md[r];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Ua(r){const t=[],s=l=>{t.push(String.fromCodePoint(l))},n={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=l=>{Hd(l,n,s)};for(let l=0;l<r.length;l+=1)rl(r.charCodeAt(l),a,i);return t.join("")}function zd(r,t){if(r<=127){t(r);return}else if(r<=2047){t(192|r>>6),t(128|r&63);return}else if(r<=65535){t(224|r>>12),t(128|r>>6&63),t(128|r&63);return}else if(r<=1114111){t(240|r>>18),t(128|r>>12&63),t(128|r>>6&63),t(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Wd(r,t){for(let s=0;s<r.length;s+=1){let n=r.charCodeAt(s);if(n>55295&&n<=56319){const a=(n-55296)*1024&65535;n=(r.charCodeAt(s+1)-56320&65535|a)+65536,s+=1}zd(n,t)}}function Hd(r,t,s){if(t.utf8seq===0){if(r<=127){s(r);return}for(let n=1;n<6;n+=1)if(!(r>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=r&31;else if(t.utf8seq===3)t.codepoint=r&15;else if(t.utf8seq===4)t.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|r&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function Gd(r){const t=[],s={queue:0,queuedBits:0},n=a=>{t.push(a)};for(let a=0;a<r.length;a+=1)rl(r.charCodeAt(a),s,n);return new Uint8Array(t)}function Kd(r){const t=[];return Wd(r,s=>t.push(s)),new Uint8Array(t)}function Jd(r){const t=[],s={queue:0,queuedBits:0},n=a=>{t.push(a)};return r.forEach(a=>Ia(a,s,n)),Ia(null,s,n),t.join("")}function Zd(r){return Math.round(Date.now()/1e3)+r}function Qd(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const t=Math.random()*16|0;return(r=="x"?t:t&3|8).toString(16)})}const dt=()=>typeof window<"u"&&typeof document<"u",ts={tested:!1,writable:!1},er=()=>{if(!dt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ts.tested)return ts.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),ts.tested=!0,ts.writable=!0}catch{ts.tested=!0,ts.writable=!1}return ts.writable};function Yd(r){const t={},s=new URL(r);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((a,i)=>{t[i]=a})}catch{}return s.searchParams.forEach((n,a)=>{t[a]=n}),t}const nl=r=>{let t;return r?t=r:typeof fetch>"u"?t=(...s)=>cr(async()=>{const{default:n}=await Promise.resolve().then(()=>Fs);return{default:n}},void 0).then(({default:n})=>n(...s)):t=fetch,(...s)=>t(...s)},Xd=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",al=async(r,t,s)=>{await r.setItem(t,JSON.stringify(s))},wr=async(r,t)=>{const s=await r.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},_r=async(r,t)=>{await r.removeItem(t)};class Qr{constructor(){this.promise=new Qr.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}Qr.promiseConstructor=Promise;function fn(r){const t=r.split(".");if(t.length!==3)throw new Xs("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!Fd.test(t[n]))throw new Xs("JWT not in base64url format");return{header:JSON.parse(Ua(t[0])),payload:JSON.parse(Ua(t[1])),signature:Gd(t[2]),raw:{header:t[0],payload:t[1]}}}async function eu(r){return await new Promise(t=>{setTimeout(()=>t(null),r)})}function tu(r,t){return new Promise((n,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{const l=await r(i);if(!t(i,null,l)){n(l);return}}catch(l){if(!t(i,l)){a(l);return}}})()})}function su(r){return("0"+r.toString(16)).substr(-2)}function ru(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=s.length;let a="";for(let i=0;i<56;i++)a+=s.charAt(Math.floor(Math.random()*n));return a}return crypto.getRandomValues(t),Array.from(t,su).join("")}async function nu(r){const s=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",s),a=new Uint8Array(n);return Array.from(a).map(i=>String.fromCharCode(i)).join("")}async function au(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const s=await nu(r);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function js(r,t,s=!1){const n=ru();let a=n;s&&(a+="/PASSWORD_RECOVERY"),await al(r,`${t}-code-verifier`,a);const i=await au(n);return[i,n===i?"plain":"s256"]}const iu=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function lu(r){const t=r.headers.get(Pn);if(!t||!t.match(iu))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function ou(r){if(!r)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(r<=t)throw new Error("JWT has expired")}function cu(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const du=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ws(r){if(!du.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var uu=function(r,t){var s={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(s[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(s[n[a]]=r[n[a]]);return s};const ss=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),hu=[502,503,504];async function Ba(r){var t;if(!Xd(r))throw new $n(ss(r),0);if(hu.includes(r.status))throw new $n(ss(r),r.status);let s;try{s=await r.json()}catch(i){throw new sl(ss(i),i)}let n;const a=lu(r);if(a&&a.getTime()>=tl["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?n=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(n=s.error_code),n){if(n==="weak_password")throw new Ra(ss(s),r.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new Ut}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((i,l)=>i&&typeof l=="string",!0))throw new Ra(ss(s),r.status,s.weak_password.reasons);throw new Ud(ss(s),r.status||500,n)}const mu=(r,t,s,n)=>{const a={method:r,headers:(t==null?void 0:t.headers)||{}};return r==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),a.body=JSON.stringify(n),Object.assign(Object.assign({},a),s))};async function le(r,t,s,n){var a;const i=Object.assign({},n==null?void 0:n.headers);i[Pn]||(i[Pn]=tl["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const l=(a=n==null?void 0:n.query)!==null&&a!==void 0?a:{};n!=null&&n.redirectTo&&(l.redirect_to=n.redirectTo);const o=Object.keys(l).length?"?"+new URLSearchParams(l).toString():"",c=await fu(r,t,s+o,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(c):{data:Object.assign({},c),error:null}}async function fu(r,t,s,n,a,i){const l=mu(t,n,a,i);let o;try{o=await r(s,Object.assign({},l))}catch(c){throw console.error(c),new $n(ss(c),0)}if(o.ok||await Ba(o),n!=null&&n.noResolveJson)return o;try{return await o.json()}catch(c){await Ba(c)}}function Dt(r){var t;let s=null;yu(r)&&(s=Object.assign({},r),r.expires_at||(s.expires_at=Zd(r.expires_in)));const n=(t=r.user)!==null&&t!==void 0?t:r;return{data:{session:s,user:n},error:null}}function qa(r){const t=Dt(r);return!t.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((s,n)=>s&&typeof n=="string",!0)&&(t.data.weak_password=r.weak_password),t}function Mt(r){var t;return{data:{user:(t=r.user)!==null&&t!==void 0?t:r},error:null}}function xu(r){return{data:r,error:null}}function pu(r){const{action_link:t,email_otp:s,hashed_token:n,redirect_to:a,verification_type:i}=r,l=uu(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:s,hashed_token:n,redirect_to:a,verification_type:i},c=Object.assign({},l);return{data:{properties:o,user:c},error:null}}function gu(r){return r}function yu(r){return r.access_token&&r.refresh_token&&r.expires_in}const xn=["global","local","others"];var bu=function(r,t){var s={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0&&(s[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(s[n[a]]=r[n[a]]);return s};class vu{constructor({url:t="",headers:s={},fetch:n}){this.url=t,this.headers=s,this.fetch=nl(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,s=xn[0]){if(xn.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${xn.join(", ")}`);try{return await le(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ae(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,s={}){try{return await le(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:Mt})}catch(n){if(ae(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:s}=t,n=bu(t,["options"]),a=Object.assign(Object.assign({},n),s);return"newEmail"in n&&(a.new_email=n==null?void 0:n.newEmail,delete a.newEmail),await le(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:pu,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(ae(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await le(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Mt})}catch(s){if(ae(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,n,a,i,l,o,c;try{const d={nextPage:null,lastPage:0,total:0},u=await le(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(s=t==null?void 0:t.page)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:"",per_page:(i=(a=t==null?void 0:t.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:gu});if(u.error)throw u.error;const h=await u.json(),g=(l=u.headers.get("x-total-count"))!==null&&l!==void 0?l:0,m=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(v=>{const x=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),f=JSON.parse(v.split(";")[1].split("=")[1]);d[`${f}Page`]=x}),d.total=parseInt(g)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(ae(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){ws(t);try{return await le(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Mt})}catch(s){if(ae(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){ws(t);try{return await le(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:Mt})}catch(n){if(ae(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,s=!1){ws(t);try{return await le(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:Mt})}catch(n){if(ae(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){ws(t.userId);try{const{data:s,error:n}=await le(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:s,error:n}}catch(s){if(ae(s))return{data:null,error:s};throw s}}async _deleteFactor(t){ws(t.userId),ws(t.id);try{return{data:await le(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(ae(s))return{data:null,error:s};throw s}}}const ju={getItem:r=>er()?globalThis.localStorage.getItem(r):null,setItem:(r,t)=>{er()&&globalThis.localStorage.setItem(r,t)},removeItem:r=>{er()&&globalThis.localStorage.removeItem(r)}};function Va(r={}){return{getItem:t=>r[t]||null,setItem:(t,s)=>{r[t]=s},removeItem:t=>{delete r[t]}}}function wu(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const _s={debug:!!(globalThis&&er()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class il extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class _u extends il{}async function Nu(r,t,s){_s.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),_s.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async a=>{if(a){_s.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,a.name);try{return await s()}finally{_s.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,a.name)}}else{if(t===0)throw _s.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new _u(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(_s.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}wu();const Su={url:Dd,storageKey:Ld,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Rd,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ma(r,t,s){return await s()}class ar{constructor(t){var s,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ar.nextInstanceID,ar.nextInstanceID+=1,this.instanceID>0&&dt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},Su),t);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new vu({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=nl(a.fetch),this.lock=a.lock||Ma,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,a.lock?this.lock=a.lock:dt()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=Nu:this.lock=Ma,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?a.storage?this.storage=a.storage:er()?this.storage=ju:(this.memoryStorage={},this.storage=Va(this.memoryStorage)):(this.memoryStorage={},this.storage=Va(this.memoryStorage)),dt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${el}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const s=Yd(window.location.href);let n="none";if(this._isImplicitGrantCallback(s)?n="implicit":await this._isPKCECallback(s)&&(n="pkce"),dt()&&this.detectSessionInUrl&&n!=="none"){const{data:a,error:i}=await this._getSessionFromURL(s,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Vd(i)){const c=(t=i.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:l,redirectType:o}=a;return this._debug("#_initialize()","detected session in URL",l,"redirect type",o),await this._saveSession(l),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",l):await this._notifyAllSubscribers("SIGNED_IN",l)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return ae(s)?{error:s}:{error:new sl("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,n,a;try{const i=await le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(a=t==null?void 0:t.options)===null||a===void 0?void 0:a.captchaToken}},xform:Dt}),{data:l,error:o}=i;if(o||!l)return{data:{user:null,session:null},error:o};const c=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(ae(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(t){var s,n,a;try{let i;if("email"in t){const{email:u,password:h,options:g}=t;let m=null,v=null;this.flowType==="pkce"&&([m,v]=await js(this.storage,this.storageKey)),i=await le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:u,password:h,data:(s=g==null?void 0:g.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:m,code_challenge_method:v},xform:Dt})}else if("phone"in t){const{phone:u,password:h,options:g}=t;i=await le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(n=g==null?void 0:g.data)!==null&&n!==void 0?n:{},channel:(a=g==null?void 0:g.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:Dt})}else throw new vr("You must provide either an email or phone number and a password");const{data:l,error:o}=i;if(o||!l)return{data:{user:null,session:null},error:o};const c=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(ae(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(t){try{let s;if("email"in t){const{email:i,password:l,options:o}=t;s=await le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:l,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:qa})}else if("phone"in t){const{phone:i,password:l,options:o}=t;s=await le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:l,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:qa})}else throw new vr("You must provide either an email or phone number and a password");const{data:n,error:a}=s;return a?{data:{user:null,session:null},error:a}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new br}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:a})}catch(s){if(ae(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(t){var s,n,a,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(a=t.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;if(s==="solana")return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}async signInWithSolana(t){var s,n,a,i,l,o,c,d,u,h,g,m;let v,x;if("message"in t)v=t.message,x=t.signature;else{const{chain:f,wallet:y,statement:w,options:j}=t;let k;if(dt())if(typeof y=="object")k=y;else{const A=window;if("solana"in A&&typeof A.solana=="object"&&("signIn"in A.solana&&typeof A.solana.signIn=="function"||"signMessage"in A.solana&&typeof A.solana.signMessage=="function"))k=A.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(j!=null&&j.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");k=y}const C=new URL((s=j==null?void 0:j.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in k&&k.signIn){const A=await k.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},j==null?void 0:j.signInWithSolana),{version:"1",domain:C.host,uri:C.href}),w?{statement:w}:null));let R;if(Array.isArray(A)&&A[0]&&typeof A[0]=="object")R=A[0];else if(A&&typeof A=="object"&&"signedMessage"in A&&"signature"in A)R=A;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in R&&"signature"in R&&(typeof R.signedMessage=="string"||R.signedMessage instanceof Uint8Array)&&R.signature instanceof Uint8Array)v=typeof R.signedMessage=="string"?R.signedMessage:new TextDecoder().decode(R.signedMessage),x=R.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in k)||typeof k.signMessage!="function"||!("publicKey"in k)||typeof k!="object"||!k.publicKey||!("toBase58"in k.publicKey)||typeof k.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${C.host} wants you to sign in with your Solana account:`,k.publicKey.toBase58(),...w?["",w,""]:[""],"Version: 1",`URI: ${C.href}`,`Issued At: ${(a=(n=j==null?void 0:j.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((i=j==null?void 0:j.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${j.signInWithSolana.notBefore}`]:[],...!((l=j==null?void 0:j.signInWithSolana)===null||l===void 0)&&l.expirationTime?[`Expiration Time: ${j.signInWithSolana.expirationTime}`]:[],...!((o=j==null?void 0:j.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${j.signInWithSolana.chainId}`]:[],...!((c=j==null?void 0:j.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${j.signInWithSolana.nonce}`]:[],...!((d=j==null?void 0:j.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${j.signInWithSolana.requestId}`]:[],...!((h=(u=j==null?void 0:j.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...j.signInWithSolana.resources.map(R=>`- ${R}`)]:[]].join(`
`);const A=await k.signMessage(new TextEncoder().encode(v),"utf8");if(!A||!(A instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");x=A}}try{const{data:f,error:y}=await le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:Jd(x)},!((g=t.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(m=t.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Dt});if(y)throw y;return!f||!f.session||!f.user?{data:{user:null,session:null},error:new br}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),{data:Object.assign({},f),error:y})}catch(f){if(ae(f))return{data:{user:null,session:null},error:f};throw f}}async _exchangeCodeForSession(t){const s=await wr(this.storage,`${this.storageKey}-code-verifier`),[n,a]=(s??"").split("/");try{const{data:i,error:l}=await le(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Dt});if(await _r(this.storage,`${this.storageKey}-code-verifier`),l)throw l;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new br}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:a??null}),error:l})}catch(i){if(ae(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(t){try{const{options:s,provider:n,token:a,access_token:i,nonce:l}=t,o=await le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:a,access_token:i,nonce:l,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:Dt}),{data:c,error:d}=o;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new br}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(s){if(ae(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(t){var s,n,a,i,l;try{if("email"in t){const{email:o,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await js(this.storage,this.storageKey));const{error:h}=await le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in t){const{phone:o,options:c}=t,{data:d,error:u}=await le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(a=c==null?void 0:c.data)!==null&&a!==void 0?a:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(l=c==null?void 0:c.channel)!==null&&l!==void 0?l:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u}}throw new vr("You must provide either an email or phone number.")}catch(o){if(ae(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var s,n;try{let a,i;"options"in t&&(a=(s=t.options)===null||s===void 0?void 0:s.redirectTo,i=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:l,error:o}=await le(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:Dt});if(o)throw o;if(!l)throw new Error("An error occurred on token verification.");const c=l.session,d=l.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(a){if(ae(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(t){var s,n,a;try{let i=null,l=null;return this.flowType==="pkce"&&([i,l]=await js(this.storage,this.storageKey)),await le(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&n!==void 0?n:void 0}),!((a=t==null?void 0:t.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:l}),headers:this.headers,xform:xu})}catch(i){if(ae(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:n}=t;if(n)throw n;if(!s)throw new Ut;const{error:a}=await le(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:a}})}catch(t){if(ae(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:n,type:a,options:i}=t,{error:l}=await le(this.fetch,"POST",s,{headers:this.headers,body:{email:n,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:l}}else if("phone"in t){const{phone:n,type:a,options:i}=t,{data:l,error:o}=await le(this.fetch,"POST",s,{headers:this.headers,body:{phone:n,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:o}}throw new vr("You must provide either an email or phone number and a type")}catch(s){if(ae(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await n,await s()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=s();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await wr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<hn:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.storage.isServer){let l=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,d,u)=>(!l&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),l=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:t},error:null}}const{session:a,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{session:null},error:i}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Mt}):await this._useSession(async s=>{var n,a,i;const{data:l,error:o}=s;if(o)throw o;return!(!((n=l.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ut}:await le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(a=l.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0,xform:Mt})})}catch(s){if(ae(s))return qd(s)&&(await this._removeSession(),await _r(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async n=>{const{data:a,error:i}=n;if(i)throw i;if(!a.session)throw new Ut;const l=a.session;let o=null,c=null;this.flowType==="pkce"&&t.email!=null&&([o,c]=await js(this.storage,this.storageKey));const{data:d,error:u}=await le(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:c}),jwt:l.access_token,xform:Mt});if(u)throw u;return l.user=d.user,await this._saveSession(l),await this._notifyAllSubscribers("USER_UPDATED",l),{data:{user:l.user},error:null}})}catch(n){if(ae(n))return{data:{user:null},error:n};throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ut;const s=Date.now()/1e3;let n=s,a=!0,i=null;const{payload:l}=fn(t.access_token);if(l.exp&&(n=l.exp,a=n<=s),a){const{session:o,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(t.access_token);if(c)throw c;i={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:n-s,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(s){if(ae(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var n;if(!t){const{data:l,error:o}=s;if(o)throw o;t=(n=l.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new Ut;const{session:a,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{user:null,session:null},error:i}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(ae(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(t,s){try{if(!dt())throw new jr("No browser detected.");if(t.error||t.error_description||t.error_code)throw new jr(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new La("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new jr("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new La("No code detected.");const{data:w,error:j}=await this._exchangeCodeForSession(t.code);if(j)throw j;const k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:w.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:a,access_token:i,refresh_token:l,expires_in:o,expires_at:c,token_type:d}=t;if(!i||!o||!l||!d)throw new jr("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let g=u+h;c&&(g=parseInt(c));const m=g-u;m*1e3<=Es&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${h}s`);const v=g-h;u-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,g,u):u-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,g,u);const{data:x,error:f}=await this._getUser(i);if(f)throw f;const y={provider_token:n,provider_refresh_token:a,access_token:i,expires_in:h,expires_at:g,refresh_token:l,token_type:d,user:x.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:t.type},error:null}}catch(n){if(ae(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await wr(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var n;const{data:a,error:i}=s;if(i)return{error:i};const l=(n=a.session)===null||n===void 0?void 0:n.access_token;if(l){const{error:o}=await this.admin.signOut(l,t);if(o&&!(Bd(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return t!=="others"&&(await this._removeSession(),await _r(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const s=Qd(),n={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async s=>{var n,a;try{const{data:{session:i},error:l}=s;if(l)throw l;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,s={}){let n=null,a=null;this.flowType==="pkce"&&([n,a]=await js(this.storage,this.storageKey,!0));try{return await le(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:a,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(i){if(ae(i))return{data:null,error:i};throw i}}async getUserIdentities(){var t;try{const{data:s,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(s){if(ae(s))return{data:null,error:s};throw s}}async linkIdentity(t){var s;try{const{data:n,error:a}=await this._useSession(async i=>{var l,o,c,d,u;const{data:h,error:g}=i;if(g)throw g;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(l=t.options)===null||l===void 0?void 0:l.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await le(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(a)throw a;return dt()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:t.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(ae(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async unlinkIdentity(t){try{return await this._useSession(async s=>{var n,a;const{data:i,error:l}=s;if(l)throw l;return await le(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(a=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:void 0})})}catch(s){if(ae(s))return{data:null,error:s};throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const n=Date.now();return await tu(async a=>(a>0&&await eu(200*Math.pow(2,a-1)),this._debug(s,"refreshing attempt",a),await le(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Dt})),(a,i)=>{const l=200*Math.pow(2,a);return i&&mn(i)&&Date.now()+l-n<Es})}catch(n){if(this._debug(s,"error",n),ae(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",n),dt()&&!s.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await wr(this.storage,this.storageKey);if(this._debug(s,"session from storage",n),!this._isValidSession(n)){this._debug(s,"session is not valid"),n!==null&&await this._removeSession();return}const a=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<hn;if(this._debug(s,`session has${a?"":" not"} expired with margin of ${hn}s`),a){if(this.autoRefreshToken&&n.refresh_token){const{error:i}=await this._callRefreshToken(n.refresh_token);i&&(console.error(i),mn(i)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(s,"error",n),console.error(n);return}finally{this._debug(s,"end")}}async _callRefreshToken(t){var s,n;if(!t)throw new Ut;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new Qr;const{data:i,error:l}=await this._refreshAccessToken(t);if(l)throw l;if(!i.session)throw new Ut;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(a,"error",i),ae(i)){const l={session:null,error:i};return mn(i)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(l),l}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(t,s,n=!0){const a=`#_notifyAllSubscribers(${t})`;this._debug(a,"begin",s,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:s});const i=[],l=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,s)}catch(c){i.push(c)}});if(await Promise.all(l),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(a,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await al(this.storage,this.storageKey,t)}async _removeSession(){this._debug("#_removeSession()"),await _r(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&dt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Es);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:n}}=s;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((n.expires_at*1e3-t)/Es);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${Es}ms, refresh threshold is ${On} ticks`),a<=On&&await this._callRefreshToken(n.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof il)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!dt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,n){const a=[`provider=${encodeURIComponent(s)}`];if(n!=null&&n.redirectTo&&a.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&a.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,l]=await js(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(l)}`});a.push(o.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);a.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&a.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${a.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var n;const{data:a,error:i}=s;return i?{data:null,error:i}:await le(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(s){if(ae(s))return{data:null,error:s};throw s}}async _enroll(t){try{return await this._useSession(async s=>{var n,a;const{data:i,error:l}=s;if(l)return{data:null,error:l};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:c,error:d}=await le(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return d?{data:null,error:d}:(t.factorType==="totp"&&(!((a=c==null?void 0:c.totp)===null||a===void 0)&&a.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(ae(s))return{data:null,error:s};throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var n;const{data:a,error:i}=s;if(i)return{data:null,error:i};const{data:l,error:o}=await le(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:o})})}catch(s){if(ae(s))return{data:null,error:s};throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var n;const{data:a,error:i}=s;return i?{data:null,error:i}:await le(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(s){if(ae(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(t){const{data:s,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const n=(t==null?void 0:t.factors)||[],a=n.filter(l=>l.factor_type==="totp"&&l.status==="verified"),i=n.filter(l=>l.factor_type==="phone"&&l.status==="verified");return{data:{all:n,totp:a,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var s,n;const{data:{session:a},error:i}=t;if(i)return{data:null,error:i};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=fn(a.access_token);let o=null;l.aal&&(o=l.aal);let c=o;((n=(s=a.user.factors)===null||s===void 0?void 0:s.filter(h=>h.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const u=l.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(t,s={keys:[]}){let n=s.keys.find(l=>l.kid===t);if(n||(n=this.jwks.keys.find(l=>l.kid===t),n&&this.jwks_cached_at+Id>Date.now()))return n;const{data:a,error:i}=await le(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!a.keys||a.keys.length===0)throw new Xs("JWKS is empty");if(this.jwks=a,this.jwks_cached_at=Date.now(),n=a.keys.find(l=>l.kid===t),!n)throw new Xs("No matching signing key found in JWKS");return n}async getClaims(t,s={keys:[]}){try{let n=t;if(!n){const{data:m,error:v}=await this.getSession();if(v||!m.session)return{data:null,error:v};n=m.session.access_token}const{header:a,payload:i,signature:l,raw:{header:o,payload:c}}=fn(n);if(ou(i.exp),!a.kid||a.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:m}=await this.getUser(n);if(m)throw m;return{data:{claims:i,header:a,signature:l},error:null}}const d=cu(a.alg),u=await this.fetchJwk(a.kid,s),h=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,l,Kd(`${o}.${c}`)))throw new Xs("Invalid JWT signature");return{data:{claims:i,header:a,signature:l},error:null}}catch(n){if(ae(n))return{data:null,error:n};throw n}}}ar.nextInstanceID=0;const ku=ar;class Eu extends ku{constructor(t){super(t)}}var Cu=function(r,t,s,n){function a(i){return i instanceof s?i:new s(function(l){l(i)})}return new(s||(s=Promise))(function(i,l){function o(u){try{d(n.next(u))}catch(h){l(h)}}function c(u){try{d(n.throw(u))}catch(h){l(h)}}function d(u){u.done?i(u.value):a(u.value).then(o,c)}d((n=n.apply(r,t||[])).next())})};class Au{constructor(t,s,n){var a,i,l;if(this.supabaseUrl=t,this.supabaseKey=s,!t)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const o=Pd(t),c=new URL(o);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const d=`sb-${c.hostname.split(".")[0]}-auth-token`,u={db:Nd,realtime:kd,auth:Object.assign(Object.assign({},Sd),{storageKey:d}),global:_d},h=$d(n??{},u);this.storageKey=(a=h.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(i=h.global.headers)!==null&&i!==void 0?i:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(g,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((l=h.auth)!==null&&l!==void 0?l:{},this.headers,h.global.fetch),this.fetch=Td(s,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new Hc(new URL("rest/v1",c).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new wc(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new vd(this.storageUrl.href,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,s={},n={}){return this.rest.rpc(t,s,n)}channel(t,s={config:{}}){return this.realtime.channel(t,s)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,s;return Cu(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(s=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&s!==void 0?s:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:s,detectSessionInUrl:n,storage:a,storageKey:i,flowType:l,lock:o,debug:c},d,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Eu({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),d),storageKey:i,autoRefreshToken:t,persistSession:s,detectSessionInUrl:n,storage:a,flowType:l,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new ld(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,n)=>{this._handleTokenChanged(s,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(t,s,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:t==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Tu=(r,t,s)=>new Au(r,t,s),Ou="https://mhbdgfvehjarrlewqglc.supabase.co",Pu="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oYmRnZnZlaGphcnJsZXdxZ2xjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEyODQwNzEsImV4cCI6MjA2Njg2MDA3MX0.c6ocKF_ksh8hGASneTCOFknIvQ59Az8m3CjPhLfTV8c",it=Tu(Ou,Pu),$u=()=>{const{user:r,isAdmin:t}=$e(),s=Jt(),[n,a]=b.useState([]),[i,l]=b.useState(!0),[o,c]=b.useState({current_page:1,total_pages:1,total_records:0}),[d,u]=b.useState({status:"",search:"",page:1,limit:10}),h=async()=>{try{l(!0);const x={page:d.page,limit:d.limit,...d.status&&{status:d.status},...d.search&&{search:d.search}},f=await ee.get("/allocations",{params:x});a(f.data.data.allocations),c(f.data.data.pagination)}catch(x){console.error("Error fetching allocations:",x)}finally{l(!1)}};b.useEffect(()=>{h()},[d]),b.useEffect(()=>{const x=it.channel("realtime:allocations").on("postgres_changes",{event:"*",schema:"public",table:"allocation"},()=>{h()}).subscribe();return()=>{it.removeChannel(x)}},[d]);const g=(x,f)=>{u(y=>({...y,[x]:f,page:1}))},m=x=>{u(f=>({...f,page:x}))},v=x=>{const f="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium";switch(x){case"pending":return`${f} bg-yellow-100 text-yellow-800`;case"active":return`${f} bg-green-100 text-green-800`;case"completed":return`${f} bg-blue-100 text-blue-800`;case"cancelled":return`${f} bg-red-100 text-red-800`;default:return`${f} bg-gray-100 text-gray-800`}};return i&&n.length===0?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Allocations"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage cotton allocation and procurement processes"})]}),t&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn-primary",onClick:()=>s("/allocations/manual-entry"),children:"+ Manual Allocation Entry"}),e.jsx("button",{className:"btn-secondary",onClick:()=>s("/logs"),children:"View Logs"})]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:d.status,onChange:x=>g("status",x.target.value),className:"input-field",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsx("input",{type:"text",value:d.search,onChange:x=>g("search",x.target.value),placeholder:"Search by indent number...",className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Per Page"}),e.jsxs("select",{value:d.limit,onChange:x=>g("limit",parseInt(x.target.value)),className:"input-field",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:h,className:"btn-primary w-full",children:"Refresh"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(nt,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:o.total_records})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(io,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pending"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:n.filter(x=>x.allocation_status==="pending").length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(lo,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Active"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:n.filter(x=>x.allocation_status==="active").length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(xt,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Completed"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:n.filter(x=>x.allocation_status==="completed").length})]})]})})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Indent Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Branch & Zone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity & Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(x=>{var f,y;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.indent_number}),e.jsxs("div",{className:"text-sm text-gray-500",children:[x.crop_year,"  ",x.buyer_type]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Period: ",x.lifting_period]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((f=x.branch_information)==null?void 0:f.branch_name)||x.branch_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[x.zone," Zone"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[(y=x.bale_quantity)==null?void 0:y.toLocaleString()," bales"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["",x.otr_price," per candy"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:v(x.allocation_status),children:x.allocation_status})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsxs(Ht,{to:`/allocation/${x.id}`,className:"inline-flex items-center text-blue-600 hover:text-blue-900",children:[e.jsx(Rs,{className:"h-4 w-4 mr-1"}),"View Details"]}),x.allocation_status==="active"&&e.jsxs(Ht,{to:`/allocation/${x.id}`,className:"inline-flex items-center text-green-600 hover:text-green-900",children:[e.jsx(xt,{className:"h-4 w-4 mr-1"}),"Start Procurement"]})]})]},x.id)})})]})}),n.length===0&&!i&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(nt,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No allocations found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No allocations match your current filters."})]}),o.total_pages>1&&e.jsx("div",{className:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing page ",o.current_page," of ",o.total_pages,"(",o.total_records," total records)"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>m(o.current_page-1),disabled:!o.has_previous,className:"px-3 py-1 border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>m(o.current_page+1),disabled:!o.has_next,className:"px-3 py-1 border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})})]})]})},Du=()=>{var x,f;const{id:r}=Mn(),t=Jt(),{user:s}=$e(),[n,a]=b.useState(null),[i,l]=b.useState(null),[o,c]=b.useState(!0),[d,u]=b.useState(!1),[h,g]=b.useState(!1);b.useEffect(()=>{(async()=>{try{const w=await ee.get(`/allocations/${r}`);a(w.data.data.allocation)}catch(w){console.error("Error fetching allocation:",w),L.error("Failed to fetch allocation details")}finally{c(!1)}})()},[r]);const m=async()=>{var y,w;try{u(!0);const j=await ee.post("/procurement/calculate",{indent_number:n.indent_number});l(j.data.data.procurement),L.success("Procurement costs calculated successfully")}catch(j){console.error("Error calculating procurement:",j),L.error(((w=(y=j.response)==null?void 0:y.data)==null?void 0:w.message)||"Failed to calculate procurement costs")}finally{u(!1)}},v=async()=>{var y,w;if(!i){L.error("Please calculate procurement costs first");return}try{g(!0);const k=(await ee.post("/payment/cdu",{procurement_id:i.id})).data.data.payment_id;L.success("CDU generated successfully"),t(`/payment/${k}`)}catch(j){console.error("Error generating CDU:",j),L.error(((w=(y=j.response)==null?void 0:y.data)==null?void 0:w.message)||"Failed to generate CDU")}finally{g(!1)}};return o?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Allocation Details - ",n.indent_number]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"View allocation information and calculate procurement costs"})]}),e.jsx("button",{onClick:()=>t("/allocations"),className:"btn-secondary",children:"Back to List"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(nt,{className:"h-6 w-6 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Basic Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Indent Number"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:n.indent_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Crop Year"}),e.jsx("p",{className:"text-lg text-gray-900",children:n.crop_year})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Buyer Type"}),e.jsx("p",{className:"text-lg text-gray-900",children:n.buyer_type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Status"}),e.jsx("span",{className:`status-badge status-${n.allocation_status}`,children:n.allocation_status})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Lifting Period"}),e.jsx("p",{className:"text-lg text-gray-900",children:n.lifting_period})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(oo,{className:"h-6 w-6 text-green-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Branch & Quantity"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Branch"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:((x=n.branch_information)==null?void 0:x.branch_name)||n.branch_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[n.zone," Zone"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Bale Quantity"}),e.jsxs("p",{className:"text-xl font-bold text-blue-600",children:[(f=n.bale_quantity)==null?void 0:f.toLocaleString()," bales"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"OTR Price"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["",n.otr_price," per candy"]})]})]}),n.parsed_data&&e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-500",children:"Firm Name"}),e.jsx("p",{className:"text-gray-900",children:n.parsed_data.firm_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-500",children:"Centre"}),e.jsx("p",{className:"text-gray-900",children:n.parsed_data.centre_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-500",children:"Variety"}),e.jsx("p",{className:"text-gray-900",children:n.parsed_data.variety})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-500",children:"Fibre Length"}),e.jsx("p",{className:"text-gray-900",children:n.parsed_data.fibre_length})]})]})})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(va,{className:"h-6 w-6 text-purple-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Procurement Cost Calculator"})]}),!i&&e.jsx("button",{onClick:m,disabled:d,className:"btn-primary",children:d?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Calculating..."})]}):"Calculate Costs"})]}),i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Cotton Value"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:["",i.breakdown.cotton_value.toLocaleString()]})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsxs("p",{className:"text-sm font-medium text-yellow-600",children:["EMD Amount (",i.breakdown.emd_percentage,"%)"]}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-900",children:["",i.breakdown.emd_amount.toLocaleString()]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"GST Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900",children:["",i.breakdown.gst_breakdown.total_gst.toLocaleString()]})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Total Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:["",i.breakdown.total_amount.toLocaleString()]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"GST Breakdown"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[i.breakdown.gst_breakdown.igst>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"IGST (18%):"}),e.jsxs("span",{className:"ml-2 font-medium",children:["",i.breakdown.gst_breakdown.igst.toLocaleString()]})]}),i.breakdown.gst_breakdown.cgst>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"CGST (9%):"}),e.jsxs("span",{className:"ml-2 font-medium",children:["",i.breakdown.gst_breakdown.cgst.toLocaleString()]})]}),i.breakdown.gst_breakdown.sgst>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"SGST (9%):"}),e.jsxs("span",{className:"ml-2 font-medium",children:["",i.breakdown.gst_breakdown.sgst.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:m,disabled:d,className:"btn-secondary",children:d?"Recalculating...":"Recalculate"}),e.jsx("button",{onClick:v,disabled:h,className:"btn-primary",children:h?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Generate CDU Draft"]})})]})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(va,{className:"mx-auto h-12 w-12 text-gray-300 mb-4"}),e.jsx("p",{className:"text-lg",children:'Click "Calculate Costs" to view procurement breakdown'}),e.jsx("p",{className:"text-sm",children:"This will calculate EMD, GST, and total amounts"})]})]}),n.procurement_dump&&n.procurement_dump.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(cs,{className:"h-6 w-6 text-orange-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Procurement History"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"EMD Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Due Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:n.procurement_dump.map(y=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(y.created_at).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["",y.total_amount.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["",y.emd_amount.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(y.due_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>t(`/procurement/${y.id}`),className:"text-blue-600 hover:text-blue-900",children:"View Details"})})]},y.id))})]})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Allocation not found"}),e.jsx("button",{onClick:()=>t("/allocations"),className:"mt-4 btn-primary",children:"Back to Allocations"})]})},Lu=()=>{var h,g,m;const{id:r}=Mn(),t=Jt(),{user:s}=$e(),[n,a]=b.useState(null),[i,l]=b.useState(!0),[o,c]=b.useState(!1);b.useEffect(()=>{(async()=>{try{const x=await ee.get(`/payment/${r}`);a(x.data.data.payment)}catch(x){console.error("Error fetching payment:",x),L.error("Failed to fetch payment details")}finally{l(!1)}})()},[r]);const d=async()=>{try{c(!0),L.success("Payment details confirmed"),t(`/utr/${r}`)}catch(v){console.error("Error confirming payment:",v),L.error("Failed to confirm payment")}finally{c(!1)}};if(i)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})});if(!n)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Payment not found"}),e.jsx("button",{onClick:()=>t("/allocations"),className:"mt-4 btn-primary",children:"Back to Allocations"})]});const u={payment_mode:n.payment_mode,payment_type:n.payment_type,amount:n.amount,bank:n.bank,due_date:n.due_date,remarks:n.remarks};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"CDU Payment Preview"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Review payment details and proceed to UTR submission"})]}),e.jsx("button",{onClick:()=>t(-1),className:"btn-secondary",children:"Back"})]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-6 w-6 text-blue-500 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-blue-900",children:"CDU Generated Successfully"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Payment draft has been created. Please review the details below and proceed with payment."})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(xt,{className:"h-6 w-6 text-green-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"CDU Payment Details"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center bg-green-50 p-6 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-green-600 mb-2",children:"Payment Amount"}),e.jsxs("p",{className:"text-4xl font-bold text-green-900",children:["",u.amount.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Payment Mode"}),e.jsx("span",{className:"text-sm text-gray-900 font-medium",children:u.payment_mode})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Payment Type"}),e.jsx("span",{className:"text-sm text-gray-900 font-medium",children:u.payment_type})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Preferred Bank"}),e.jsx("span",{className:"text-sm text-gray-900 font-medium",children:u.bank})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-200",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Due Date"}),e.jsx("span",{className:"text-sm text-gray-900 font-medium",children:new Date(u.due_date).toLocaleDateString()})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-2",children:"Remarks"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-md",children:e.jsx("p",{className:"text-sm text-gray-900",children:u.remarks})})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(ve,{className:"h-6 w-6 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Related Procurement"})]}),n.procurement_dump&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Indent Number"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:n.procurement_dump.indent_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Firm Name"}),e.jsx("p",{className:"text-lg text-gray-900",children:n.procurement_dump.firm_name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Bale Quantity"}),e.jsxs("p",{className:"text-lg text-gray-900",children:[(h=n.procurement_dump.bale_quantity)==null?void 0:h.toLocaleString()," bales"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Zone"}),e.jsx("p",{className:"text-lg text-gray-900",children:n.procurement_dump.zone})]})]}),n.procurement_dump.allocation&&e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500 mb-2",children:"Branch Information"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Branch:"})," "," ",(g=n.procurement_dump.allocation.branch_information)==null?void 0:g.branch_name]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Code:"})," "," ",(m=n.procurement_dump.allocation.branch_information)==null?void 0:m.branch_code]})]})]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(co,{className:"h-6 w-6 text-purple-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Payment Instructions"})]}),e.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-purple-900",children:[e.jsxs("li",{children:["Use the payment mode: ",e.jsx("strong",{children:u.payment_mode})]}),e.jsxs("li",{children:["Transfer amount: ",e.jsxs("strong",{children:["",u.amount.toLocaleString()]})]}),e.jsxs("li",{children:["Preferred bank: ",e.jsx("strong",{children:u.bank})]}),e.jsxs("li",{children:["Complete payment before due date: ",e.jsx("strong",{children:new Date(u.due_date).toLocaleDateString()})]}),e.jsx("li",{children:"After successful payment, submit UTR number in the next step"}),e.jsx("li",{children:"Keep payment receipt for your records"})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(cs,{className:"h-6 w-6 text-orange-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Payment Status"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-5 w-5 text-green-500 mr-3"}),e.jsx("span",{className:"text-sm text-gray-900",children:"CDU Generated"}),e.jsx("span",{className:"ml-auto text-xs text-gray-500",children:new Date(n.created_at).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-5 w-5 border-2 border-gray-300 rounded-full mr-3"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Payment Pending"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-5 w-5 border-2 border-gray-300 rounded-full mr-3"}),e.jsx("span",{className:"text-sm text-gray-500",children:"UTR Submission"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-5 w-5 border-2 border-gray-300 rounded-full mr-3"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Payment Verification"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsxs("button",{onClick:()=>window.print(),className:"btn-secondary",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Print CDU"]}),e.jsx("button",{onClick:d,disabled:o,className:"btn-primary",children:o?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Processing..."})]}):"Proceed to UTR Submission"})]})]})},Ru=()=>{const{id:r}=Mn(),t=Jt(),{user:s}=$e(),[n,a]=b.useState(null),[i,l]=b.useState(!0),[o,c]=b.useState(!1),[d,u]=b.useState(""),[h,g]=b.useState(null);b.useEffect(()=>{(async()=>{try{const y=await ee.get(`/payment/${r}`);if(a(y.data.data.payment),y.data.data.payment.utr_number){t("/payment/verified");return}}catch(y){console.error("Error fetching payment:",y),L.error("Failed to fetch payment details")}finally{l(!1)}})()},[r,t]);const m=async()=>{var f,y;if(!d||d.length<12){L.error("Please enter a valid UTR number (minimum 12 characters)");return}try{c(!0),await ee.post("/utr/submit",{payment_id:r,utr_number:d}),L.success("UTR submitted successfully!"),t("/payment/verified")}catch(w){console.error("Error submitting UTR:",w),L.error(((y=(f=w.response)==null?void 0:f.data)==null?void 0:y.message)||"Failed to submit UTR")}finally{c(!1)}},v=f=>{const y=f.target.files[0];if(y){if(y.size>5*1024*1024){L.error("File size must be less than 5MB");return}g(y)}};if(i)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})});if(!n)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Payment not found"}),e.jsx("button",{onClick:()=>t("/allocations"),className:"mt-4 btn-primary",children:"Back to Allocations"})]});const x=new Date>new Date(n.due_date);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Submit UTR Number"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Enter your UTR number to verify payment completion"})]}),e.jsx("button",{onClick:()=>t(-1),className:"btn-secondary",children:"Back"})]})}),x&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"h-6 w-6 text-red-500 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-900",children:"Payment Overdue"}),e.jsxs("p",{className:"text-sm text-red-700",children:["This payment was due on ",new Date(n.due_date).toLocaleDateString(),". Please submit UTR immediately to avoid delays."]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(ve,{className:"h-6 w-6 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"UTR Submission"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"utr",className:"block text-sm font-medium text-gray-700 mb-2",children:"UTR Number *"}),e.jsx("input",{type:"text",id:"utr",value:d,onChange:f=>u(f.target.value.toUpperCase()),placeholder:"Enter 12-22 digit UTR number",className:"input-field",maxLength:22,minLength:12}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"UTR (Unique Transaction Reference) number from your bank statement"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"screenshot",className:"block text-sm font-medium text-gray-700 mb-2",children:"Payment Screenshot (Optional)"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(uo,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"flex text-sm text-gray-600",children:[e.jsxs("label",{htmlFor:"screenshot",className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"screenshot",name:"screenshot",type:"file",className:"sr-only",accept:"image/*",onChange:v})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF up to 5MB"})]})}),h&&e.jsxs("p",{className:"mt-2 text-sm text-green-600",children:["Selected: ",h.name]})]}),e.jsx("button",{onClick:m,disabled:o||!d||d.length<12,className:"w-full btn-primary",children:o?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Submitting..."})]}):"Submit UTR Number"})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(xt,{className:"h-6 w-6 text-green-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Payment Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-green-600 mb-1",children:"Payment Amount"}),e.jsxs("p",{className:"text-3xl font-bold text-green-900",children:["",n.amount.toLocaleString()]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Payment Mode"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.payment_mode})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Payment Type"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.payment_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Bank"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.bank})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Due Date"}),e.jsxs("span",{className:`text-sm font-medium ${x?"text-red-600":"text-gray-900"}`,children:[new Date(n.due_date).toLocaleDateString(),x&&" (Overdue)"]})]})]}),n.procurement_dump&&e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Related Procurement"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Indent Number"}),e.jsx("span",{className:"font-medium text-gray-900",children:n.procurement_dump.indent_number})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Firm Name"}),e.jsx("span",{className:"text-gray-900",children:n.procurement_dump.firm_name})]})]})]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Ae,{className:"h-6 w-6 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"UTR Submission Guidelines"})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-sm text-blue-900",children:[e.jsx("li",{children:"UTR number is a 12-22 digit unique reference number provided by your bank"}),e.jsx("li",{children:"Check your bank statement, payment receipt, or mobile banking app for UTR"}),e.jsx("li",{children:"Ensure the UTR corresponds to the exact payment amount mentioned above"}),e.jsx("li",{children:"Screenshot upload is optional but recommended for faster verification"}),e.jsx("li",{children:"Once submitted, UTR cannot be modified. Please verify before submission"}),e.jsx("li",{children:'After successful submission, payment status will be updated to "Verified"'})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Sample UTR Formats"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-xs",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-1",children:"SBI"}),e.jsx("p",{className:"text-gray-600",children:"123456789012"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-1",children:"HDFC"}),e.jsx("p",{className:"text-gray-600",children:"H123456789012345"})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-1",children:"ICICI"}),e.jsx("p",{className:"text-gray-600",children:"12345678901234"})]})]})]})]})},Fu=()=>{const{user:r,isAdmin:t}=$e(),[s,n]=b.useState([]),[a,i]=b.useState(!0),[l,o]=b.useState({}),[c,d]=b.useState([]);b.useEffect(()=>{const f=async()=>{try{const y=await ee.get("/utr/pending");n(y.data.data.pending_payments)}catch(y){console.error("Error fetching pending payments:",y),L.error("Failed to fetch pending payments")}finally{i(!1)}};t()?f():i(!1)},[t]);const u=f=>{const y=new Date,w=new Date(f),j=y-w;return Math.ceil(j/(1e3*60*60*24))},h=f=>f<=7?"low":f<=14?"medium":"high",g=async f=>{var y,w;try{o(j=>({...j,[f]:!0})),await ee.post("/payment/send-reminder",{payment_ids:[f]}),L.success("Reminder sent successfully")}catch(j){console.error("Error sending reminder:",j),L.error(((w=(y=j.response)==null?void 0:y.data)==null?void 0:w.message)||"Failed to send reminder")}finally{o(j=>({...j,[f]:!1}))}},m=async()=>{var f,y;if(c.length===0){L.error("Please select payments to send reminders");return}try{o(w=>({...w,bulk:!0})),await ee.post("/payment/send-reminder",{payment_ids:c}),L.success(`Reminders sent to ${c.length} payments`),d([])}catch(w){console.error("Error sending bulk reminders:",w),L.error(((y=(f=w.response)==null?void 0:f.data)==null?void 0:y.message)||"Failed to send reminders")}finally{o(w=>({...w,bulk:!1}))}},v=f=>{d(y=>y.includes(f)?y.filter(w=>w!==f):[...y,f])},x=()=>{c.length===s.length?d([]):d(s.map(f=>f.id))};return t()?a?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Pending UTR Submissions"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Monitor overdue payments and send reminder notifications"})]}),c.length>0&&e.jsx("button",{onClick:m,disabled:l.bulk,className:"btn-primary",children:l.bulk?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Sending..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(on,{className:"h-4 w-4 mr-2"}),"Send Reminders (",c.length,")"]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(xt,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Pending"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-500",children:["Critical (",">14"," days)"]}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.filter(f=>u(f.due_date)>14).length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(cs,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Overdue Amount"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["",s.reduce((f,y)=>f+y.amount,0).toLocaleString()]})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(on,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Selected"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.length})]})]})})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[s.length>0&&e.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:c.length===s.length,onChange:x,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-700",children:["Select All (",s.length,")"]})]})}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Select"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Payment Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Procurement Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Due Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Overdue"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(f=>{var j,k,C,A,R;const y=u(f.due_date),w=h(y);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:c.includes(f.id),onChange:()=>v(f.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["",f.amount.toLocaleString()]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[f.payment_mode,"  ",f.payment_type]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Bank: ",f.bank]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:(j=f.procurement_dump)==null?void 0:j.indent_number}),e.jsx("div",{className:"text-sm text-gray-500",children:(k=f.procurement_dump)==null?void 0:k.firm_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Branch: ",(R=(A=(C=f.procurement_dump)==null?void 0:C.allocation)==null?void 0:A.branch_information)==null?void 0:R.branch_name]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:new Date(f.due_date).toLocaleDateString()})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${w==="high"?"bg-red-100 text-red-800":w==="medium"?"bg-orange-100 text-orange-800":"bg-yellow-100 text-yellow-800"}`,children:[e.jsx(pt,{className:"h-3 w-3 mr-1"}),y," days"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:e.jsxs("button",{onClick:()=>g(f.id),disabled:l[f.id],className:"inline-flex items-center text-blue-600 hover:text-blue-900",children:[l[f.id]?e.jsx(oe,{size:"sm"}):e.jsx(on,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1",children:"Send Reminder"})]})})]},f.id)})})]})}),s.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xt,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No pending UTRs"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"All payments have received UTR submissions."})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Le,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900",children:"Reminder Guidelines"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Send reminders for payments overdue by 3+ days"}),e.jsxs("li",{children:["Critical payments (",">14"," days overdue) require immediate attention"]}),e.jsx("li",{children:"Use bulk reminders for multiple payments from the same firm"}),e.jsx("li",{children:"Follow up with phone calls for high-value overdue payments"})]})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Le,{className:"mx-auto h-12 w-12 text-red-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You don't have permission to view this page."})]})},Iu=()=>{const{user:r,isAdmin:t}=$e(),[s,n]=b.useState([]),[a,i]=b.useState(!0),[l,o]=b.useState({current_page:1,total_pages:1,total_records:0}),[c,d]=b.useState({page:1,limit:10,search:"",date_from:"",date_to:""}),[u,h]=b.useState({total_amount:0,total_count:0,this_month:0}),g=async()=>{try{i(!0);const f={page:c.page,limit:c.limit,...c.search&&{search:c.search},...c.date_from&&{date_from:c.date_from},...c.date_to&&{date_to:c.date_to}},y=await ee.get("/payment/verified",{params:f});n(y.data.data.payments),o(y.data.data.pagination);const w=y.data.data.payments.reduce((k,C)=>k+C.amount,0),j=y.data.data.payments.filter(k=>{const C=new Date(k.verified_at),A=new Date;return C.getMonth()===A.getMonth()&&C.getFullYear()===A.getFullYear()}).length;h({total_amount:w,total_count:y.data.data.payments.length,this_month:j})}catch(f){console.error("Error fetching verified payments:",f),L.error("Failed to fetch verified payments")}finally{i(!1)}};b.useEffect(()=>{g()},[c]);const m=(f,y)=>{d(w=>({...w,[f]:y,page:1}))},v=f=>{d(y=>({...y,page:f}))},x=()=>{d({page:1,limit:10,search:"",date_from:"",date_to:""})};return a&&s.length===0?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Verified Payments"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"View all verified payment transactions with UTR details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Verified"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:u.total_count})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(xt,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Amount"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["",u.total_amount.toLocaleString()]})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(cs,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"This Month"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:u.this_month})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Avg Amount"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["",u.total_count>0?Math.round(u.total_amount/u.total_count).toLocaleString():0]})]})]})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Ps,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsx("input",{type:"text",value:c.search,onChange:f=>m("search",f.target.value),placeholder:"UTR, indent number...",className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:c.date_from,onChange:f=>m("date_from",f.target.value),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:c.date_to,onChange:f=>m("date_to",f.target.value),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Per Page"}),e.jsxs("select",{value:c.limit,onChange:f=>m("limit",parseInt(f.target.value)),className:"input-field",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("button",{onClick:g,className:"btn-primary flex-1",children:"Apply"}),e.jsx("button",{onClick:x,className:"btn-secondary flex-1",children:"Clear"})]})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"UTR Information"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Procurement"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Verification"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(f=>{var y,w,j,k,C,A;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["",f.amount.toLocaleString()]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[f.payment_mode,"  ",f.payment_type]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Bank: ",f.bank]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Due: ",new Date(f.due_date).toLocaleDateString()]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.utr_number}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Submitted: ",new Date(f.verified_at).toLocaleDateString()]}),e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(Ae,{className:"h-3 w-3 mr-1"}),"Verified"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:(y=f.procurement_dump)==null?void 0:y.indent_number}),e.jsx("div",{className:"text-sm text-gray-500",children:(w=f.procurement_dump)==null?void 0:w.firm_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[(k=(j=f.procurement_dump)==null?void 0:j.bale_quantity)==null?void 0:k.toLocaleString()," bales"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-900",children:["By: ",(C=f.verified_user)==null?void 0:C.first_name," ",(A=f.verified_user)==null?void 0:A.last_name]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(f.verified_at).toLocaleString()})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs(Ht,{to:`/payment/${f.id}`,className:"inline-flex items-center text-blue-600 hover:text-blue-900",children:[e.jsx(Rs,{className:"h-4 w-4 mr-1"}),"View Details"]})})]},f.id)})})]})}),s.length===0&&!a&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ae,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No verified payments found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No payments match your current filters."})]}),l.total_pages>1&&e.jsx("div",{className:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing page ",l.current_page," of ",l.total_pages,"(",l.total_records," total records)"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>v(l.current_page-1),disabled:!l.has_previous,className:"px-3 py-1 border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>v(l.current_page+1),disabled:!l.has_next,className:"px-3 py-1 border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Export Options"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Download verified payments data"})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"btn-secondary text-sm",children:"Export CSV"}),e.jsx("button",{className:"btn-secondary text-sm",children:"Export Excel"}),e.jsx("button",{className:"btn-primary text-sm",children:"Generate Report"})]})]})})]})};var hr=r=>r.type==="checkbox",is=r=>r instanceof Date,qe=r=>r==null;const ll=r=>typeof r=="object";var Ne=r=>!qe(r)&&!Array.isArray(r)&&ll(r)&&!is(r),Uu=r=>Ne(r)&&r.target?hr(r.target)?r.target.checked:r.target.value:r,Bu=r=>r.substring(0,r.search(/\.\d+(\.|$)/))||r,qu=(r,t)=>r.has(Bu(t)),Vu=r=>{const t=r.constructor&&r.constructor.prototype;return Ne(t)&&t.hasOwnProperty("isPrototypeOf")},Jn=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function De(r){let t;const s=Array.isArray(r),n=typeof FileList<"u"?r instanceof FileList:!1;if(r instanceof Date)t=new Date(r);else if(r instanceof Set)t=new Set(r);else if(!(Jn&&(r instanceof Blob||n))&&(s||Ne(r)))if(t=s?[]:{},!s&&!Vu(r))t=r;else for(const a in r)r.hasOwnProperty(a)&&(t[a]=De(r[a]));else return r;return t}var Yr=r=>/^\w*$/.test(r),_e=r=>r===void 0,Zn=r=>Array.isArray(r)?r.filter(Boolean):[],Qn=r=>Zn(r.replace(/["|']|\]/g,"").split(/\.|\[/)),W=(r,t,s)=>{if(!t||!Ne(r))return s;const n=(Yr(t)?[t]:Qn(t)).reduce((a,i)=>qe(a)?a:a[i],r);return _e(n)||n===r?_e(r[t])?s:r[t]:n},wt=r=>typeof r=="boolean",xe=(r,t,s)=>{let n=-1;const a=Yr(t)?[t]:Qn(t),i=a.length,l=i-1;for(;++n<i;){const o=a[n];let c=s;if(n!==l){const d=r[o];c=Ne(d)||Array.isArray(d)?d:isNaN(+a[n+1])?{}:[]}if(o==="__proto__"||o==="constructor"||o==="prototype")return;r[o]=c,r=r[o]}};const za={BLUR:"blur",FOCUS_OUT:"focusout"},mt={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Pt={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Mu=pe.createContext(null);Mu.displayName="HookFormContext";var zu=(r,t,s,n=!0)=>{const a={defaultValues:t._defaultValues};for(const i in r)Object.defineProperty(a,i,{get:()=>{const l=i;return t._proxyFormState[l]!==mt.all&&(t._proxyFormState[l]=!n||mt.all),r[l]}});return a};const Wu=typeof window<"u"?b.useLayoutEffect:b.useEffect;var Nt=r=>typeof r=="string",Hu=(r,t,s,n,a)=>Nt(r)?(n&&t.watch.add(r),W(s,r,a)):Array.isArray(r)?r.map(i=>(n&&t.watch.add(i),W(s,i))):(n&&(t.watchAll=!0),s),ol=(r,t,s,n,a)=>t?{...s[r],types:{...s[r]&&s[r].types?s[r].types:{},[n]:a||!0}}:{},tr=r=>Array.isArray(r)?r:[r],Wa=()=>{let r=[];return{get observers(){return r},next:a=>{for(const i of r)i.next&&i.next(a)},subscribe:a=>(r.push(a),{unsubscribe:()=>{r=r.filter(i=>i!==a)}}),unsubscribe:()=>{r=[]}}},Dn=r=>qe(r)||!ll(r);function zt(r,t,s=new WeakSet){if(Dn(r)||Dn(t))return r===t;if(is(r)&&is(t))return r.getTime()===t.getTime();const n=Object.keys(r),a=Object.keys(t);if(n.length!==a.length)return!1;if(s.has(r)||s.has(t))return!0;s.add(r),s.add(t);for(const i of n){const l=r[i];if(!a.includes(i))return!1;if(i!=="ref"){const o=t[i];if(is(l)&&is(o)||Ne(l)&&Ne(o)||Array.isArray(l)&&Array.isArray(o)?!zt(l,o,s):l!==o)return!1}}return!0}var Ke=r=>Ne(r)&&!Object.keys(r).length,Yn=r=>r.type==="file",ft=r=>typeof r=="function",Lr=r=>{if(!Jn)return!1;const t=r?r.ownerDocument:0;return r instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},cl=r=>r.type==="select-multiple",Xn=r=>r.type==="radio",Gu=r=>Xn(r)||hr(r),pn=r=>Lr(r)&&r.isConnected;function Ku(r,t){const s=t.slice(0,-1).length;let n=0;for(;n<s;)r=_e(r)?n++:r[t[n++]];return r}function Ju(r){for(const t in r)if(r.hasOwnProperty(t)&&!_e(r[t]))return!1;return!0}function ke(r,t){const s=Array.isArray(t)?t:Yr(t)?[t]:Qn(t),n=s.length===1?r:Ku(r,s),a=s.length-1,i=s[a];return n&&delete n[i],a!==0&&(Ne(n)&&Ke(n)||Array.isArray(n)&&Ju(n))&&ke(r,s.slice(0,-1)),r}var dl=r=>{for(const t in r)if(ft(r[t]))return!0;return!1};function Rr(r,t={}){const s=Array.isArray(r);if(Ne(r)||s)for(const n in r)Array.isArray(r[n])||Ne(r[n])&&!dl(r[n])?(t[n]=Array.isArray(r[n])?[]:{},Rr(r[n],t[n])):qe(r[n])||(t[n]=!0);return t}function ul(r,t,s){const n=Array.isArray(r);if(Ne(r)||n)for(const a in r)Array.isArray(r[a])||Ne(r[a])&&!dl(r[a])?_e(t)||Dn(s[a])?s[a]=Array.isArray(r[a])?Rr(r[a],[]):{...Rr(r[a])}:ul(r[a],qe(t)?{}:t[a],s[a]):s[a]=!zt(r[a],t[a]);return s}var Ws=(r,t)=>ul(r,t,Rr(t));const Ha={value:!1,isValid:!1},Ga={value:!0,isValid:!0};var hl=r=>{if(Array.isArray(r)){if(r.length>1){const t=r.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return r[0].checked&&!r[0].disabled?r[0].attributes&&!_e(r[0].attributes.value)?_e(r[0].value)||r[0].value===""?Ga:{value:r[0].value,isValid:!0}:Ga:Ha}return Ha},ml=(r,{valueAsNumber:t,valueAsDate:s,setValueAs:n})=>_e(r)?r:t?r===""?NaN:r&&+r:s&&Nt(r)?new Date(r):n?n(r):r;const Ka={isValid:!1,value:null};var fl=r=>Array.isArray(r)?r.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,Ka):Ka;function Ja(r){const t=r.ref;return Yn(t)?t.files:Xn(t)?fl(r.refs).value:cl(t)?[...t.selectedOptions].map(({value:s})=>s):hr(t)?hl(r.refs).value:ml(_e(t.value)?r.ref.value:t.value,r)}var Zu=(r,t,s,n)=>{const a={};for(const i of r){const l=W(t,i);l&&xe(a,i,l._f)}return{criteriaMode:s,names:[...r],fields:a,shouldUseNativeValidation:n}},Fr=r=>r instanceof RegExp,Hs=r=>_e(r)?r:Fr(r)?r.source:Ne(r)?Fr(r.value)?r.value.source:r.value:r,Za=r=>({isOnSubmit:!r||r===mt.onSubmit,isOnBlur:r===mt.onBlur,isOnChange:r===mt.onChange,isOnAll:r===mt.all,isOnTouch:r===mt.onTouched});const Qa="AsyncFunction";var Qu=r=>!!r&&!!r.validate&&!!(ft(r.validate)&&r.validate.constructor.name===Qa||Ne(r.validate)&&Object.values(r.validate).find(t=>t.constructor.name===Qa)),Yu=r=>r.mount&&(r.required||r.min||r.max||r.maxLength||r.minLength||r.pattern||r.validate),Ya=(r,t,s)=>!s&&(t.watchAll||t.watch.has(r)||[...t.watch].some(n=>r.startsWith(n)&&/^\.\w+/.test(r.slice(n.length))));const sr=(r,t,s,n)=>{for(const a of s||Object.keys(r)){const i=W(r,a);if(i){const{_f:l,...o}=i;if(l){if(l.refs&&l.refs[0]&&t(l.refs[0],a)&&!n)return!0;if(l.ref&&t(l.ref,l.name)&&!n)return!0;if(sr(o,t))break}else if(Ne(o)&&sr(o,t))break}}};function Xa(r,t,s){const n=W(r,s);if(n||Yr(s))return{error:n,name:s};const a=s.split(".");for(;a.length;){const i=a.join("."),l=W(t,i),o=W(r,i);if(l&&!Array.isArray(l)&&s!==i)return{name:s};if(o&&o.type)return{name:i,error:o};if(o&&o.root&&o.root.type)return{name:`${i}.root`,error:o.root};a.pop()}return{name:s}}var Xu=(r,t,s,n)=>{s(r);const{name:a,...i}=r;return Ke(i)||Object.keys(i).length>=Object.keys(t).length||Object.keys(i).find(l=>t[l]===(!n||mt.all))},eh=(r,t,s)=>!r||!t||r===t||tr(r).some(n=>n&&(s?n===t:n.startsWith(t)||t.startsWith(n))),th=(r,t,s,n,a)=>a.isOnAll?!1:!s&&a.isOnTouch?!(t||r):(s?n.isOnBlur:a.isOnBlur)?!r:(s?n.isOnChange:a.isOnChange)?r:!0,sh=(r,t)=>!Zn(W(r,t)).length&&ke(r,t),rh=(r,t,s)=>{const n=tr(W(r,s));return xe(n,"root",t[s]),xe(r,s,n),r},Er=r=>Nt(r);function ei(r,t,s="validate"){if(Er(r)||Array.isArray(r)&&r.every(Er)||wt(r)&&!r)return{type:s,message:Er(r)?r:"",ref:t}}var Ns=r=>Ne(r)&&!Fr(r)?r:{value:r,message:""},ti=async(r,t,s,n,a,i)=>{const{ref:l,refs:o,required:c,maxLength:d,minLength:u,min:h,max:g,pattern:m,validate:v,name:x,valueAsNumber:f,mount:y}=r._f,w=W(s,x);if(!y||t.has(x))return{};const j=o?o[0]:l,k=E=>{a&&j.reportValidity&&(j.setCustomValidity(wt(E)?"":E||""),j.reportValidity())},C={},A=Xn(l),R=hr(l),se=A||R,K=(f||Yn(l))&&_e(l.value)&&_e(w)||Lr(l)&&l.value===""||w===""||Array.isArray(w)&&!w.length,T=ol.bind(null,x,n,C),q=(E,P,O,H=Pt.maxLength,J=Pt.minLength)=>{const I=E?P:O;C[x]={type:E?H:J,message:I,ref:l,...T(E?H:J,I)}};if(i?!Array.isArray(w)||!w.length:c&&(!se&&(K||qe(w))||wt(w)&&!w||R&&!hl(o).isValid||A&&!fl(o).isValid)){const{value:E,message:P}=Er(c)?{value:!!c,message:c}:Ns(c);if(E&&(C[x]={type:Pt.required,message:P,ref:j,...T(Pt.required,P)},!n))return k(P),C}if(!K&&(!qe(h)||!qe(g))){let E,P;const O=Ns(g),H=Ns(h);if(!qe(w)&&!isNaN(w)){const J=l.valueAsNumber||w&&+w;qe(O.value)||(E=J>O.value),qe(H.value)||(P=J<H.value)}else{const J=l.valueAsDate||new Date(w),I=ye=>new Date(new Date().toDateString()+" "+ye),V=l.type=="time",ie=l.type=="week";Nt(O.value)&&w&&(E=V?I(w)>I(O.value):ie?w>O.value:J>new Date(O.value)),Nt(H.value)&&w&&(P=V?I(w)<I(H.value):ie?w<H.value:J<new Date(H.value))}if((E||P)&&(q(!!E,O.message,H.message,Pt.max,Pt.min),!n))return k(C[x].message),C}if((d||u)&&!K&&(Nt(w)||i&&Array.isArray(w))){const E=Ns(d),P=Ns(u),O=!qe(E.value)&&w.length>+E.value,H=!qe(P.value)&&w.length<+P.value;if((O||H)&&(q(O,E.message,P.message),!n))return k(C[x].message),C}if(m&&!K&&Nt(w)){const{value:E,message:P}=Ns(m);if(Fr(E)&&!w.match(E)&&(C[x]={type:Pt.pattern,message:P,ref:l,...T(Pt.pattern,P)},!n))return k(P),C}if(v){if(ft(v)){const E=await v(w,s),P=ei(E,j);if(P&&(C[x]={...P,...T(Pt.validate,P.message)},!n))return k(P.message),C}else if(Ne(v)){let E={};for(const P in v){if(!Ke(E)&&!n)break;const O=ei(await v[P](w,s),j,P);O&&(E={...O,...T(P,O.message)},k(O.message),n&&(C[x]=E))}if(!Ke(E)&&(C[x]={ref:j,...E},!n))return C}}return k(!0),C};const nh={mode:mt.onSubmit,reValidateMode:mt.onChange,shouldFocusError:!0};function ah(r={}){let t={...nh,...r},s={submitCount:0,isDirty:!1,isReady:!1,isLoading:ft(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1};const n={};let a=Ne(t.defaultValues)||Ne(t.values)?De(t.defaultValues||t.values)||{}:{},i=t.shouldUnregister?{}:De(a),l={action:!1,mount:!1,watch:!1},o={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},c,d=0;const u={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let h={...u};const g={array:Wa(),state:Wa()},m=t.criteriaMode===mt.all,v=p=>_=>{clearTimeout(d),d=setTimeout(p,_)},x=async p=>{if(!t.disabled&&(u.isValid||h.isValid||p)){const _=t.resolver?Ke((await R()).errors):await K(n,!0);_!==s.isValid&&g.state.next({isValid:_})}},f=(p,_)=>{!t.disabled&&(u.isValidating||u.validatingFields||h.isValidating||h.validatingFields)&&((p||Array.from(o.mount)).forEach(N=>{N&&(_?xe(s.validatingFields,N,_):ke(s.validatingFields,N))}),g.state.next({validatingFields:s.validatingFields,isValidating:!Ke(s.validatingFields)}))},y=(p,_=[],N,F,$=!0,D=!0)=>{if(F&&N&&!t.disabled){if(l.action=!0,D&&Array.isArray(W(n,p))){const z=N(W(n,p),F.argA,F.argB);$&&xe(n,p,z)}if(D&&Array.isArray(W(s.errors,p))){const z=N(W(s.errors,p),F.argA,F.argB);$&&xe(s.errors,p,z),sh(s.errors,p)}if((u.touchedFields||h.touchedFields)&&D&&Array.isArray(W(s.touchedFields,p))){const z=N(W(s.touchedFields,p),F.argA,F.argB);$&&xe(s.touchedFields,p,z)}(u.dirtyFields||h.dirtyFields)&&(s.dirtyFields=Ws(a,i)),g.state.next({name:p,isDirty:q(p,_),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else xe(i,p,_)},w=(p,_)=>{xe(s.errors,p,_),g.state.next({errors:s.errors})},j=p=>{s.errors=p,g.state.next({errors:s.errors,isValid:!1})},k=(p,_,N,F)=>{const $=W(n,p);if($){const D=W(i,p,_e(N)?W(a,p):N);_e(D)||F&&F.defaultChecked||_?xe(i,p,_?D:Ja($._f)):O(p,D),l.mount&&x()}},C=(p,_,N,F,$)=>{let D=!1,z=!1;const re={name:p};if(!t.disabled){if(!N||F){(u.isDirty||h.isDirty)&&(z=s.isDirty,s.isDirty=re.isDirty=q(),D=z!==re.isDirty);const he=zt(W(a,p),_);z=!!W(s.dirtyFields,p),he?ke(s.dirtyFields,p):xe(s.dirtyFields,p,!0),re.dirtyFields=s.dirtyFields,D=D||(u.dirtyFields||h.dirtyFields)&&z!==!he}if(N){const he=W(s.touchedFields,p);he||(xe(s.touchedFields,p,N),re.touchedFields=s.touchedFields,D=D||(u.touchedFields||h.touchedFields)&&he!==N)}D&&$&&g.state.next(re)}return D?re:{}},A=(p,_,N,F)=>{const $=W(s.errors,p),D=(u.isValid||h.isValid)&&wt(_)&&s.isValid!==_;if(t.delayError&&N?(c=v(()=>w(p,N)),c(t.delayError)):(clearTimeout(d),c=null,N?xe(s.errors,p,N):ke(s.errors,p)),(N?!zt($,N):$)||!Ke(F)||D){const z={...F,...D&&wt(_)?{isValid:_}:{},errors:s.errors,name:p};s={...s,...z},g.state.next(z)}},R=async p=>{f(p,!0);const _=await t.resolver(i,t.context,Zu(p||o.mount,n,t.criteriaMode,t.shouldUseNativeValidation));return f(p),_},se=async p=>{const{errors:_}=await R(p);if(p)for(const N of p){const F=W(_,N);F?xe(s.errors,N,F):ke(s.errors,N)}else s.errors=_;return _},K=async(p,_,N={valid:!0})=>{for(const F in p){const $=p[F];if($){const{_f:D,...z}=$;if(D){const re=o.array.has(D.name),he=$._f&&Qu($._f);he&&u.validatingFields&&f([F],!0);const Se=await ti($,o.disabled,i,m,t.shouldUseNativeValidation&&!_,re);if(he&&u.validatingFields&&f([F]),Se[D.name]&&(N.valid=!1,_))break;!_&&(W(Se,D.name)?re?rh(s.errors,Se,D.name):xe(s.errors,D.name,Se[D.name]):ke(s.errors,D.name))}!Ke(z)&&await K(z,_,N)}}return N.valid},T=()=>{for(const p of o.unMount){const _=W(n,p);_&&(_._f.refs?_._f.refs.every(N=>!pn(N)):!pn(_._f.ref))&&Z(p)}o.unMount=new Set},q=(p,_)=>!t.disabled&&(p&&_&&xe(i,p,_),!zt(ye(),a)),E=(p,_,N)=>Hu(p,o,{...l.mount?i:_e(_)?a:Nt(p)?{[p]:_}:_},N,_),P=p=>Zn(W(l.mount?i:a,p,t.shouldUnregister?W(a,p,[]):[])),O=(p,_,N={})=>{const F=W(n,p);let $=_;if(F){const D=F._f;D&&(!D.disabled&&xe(i,p,ml(_,D)),$=Lr(D.ref)&&qe(_)?"":_,cl(D.ref)?[...D.ref.options].forEach(z=>z.selected=$.includes(z.value)):D.refs?hr(D.ref)?D.refs.forEach(z=>{(!z.defaultChecked||!z.disabled)&&(Array.isArray($)?z.checked=!!$.find(re=>re===z.value):z.checked=$===z.value||!!$)}):D.refs.forEach(z=>z.checked=z.value===$):Yn(D.ref)?D.ref.value="":(D.ref.value=$,D.ref.type||g.state.next({name:p,values:De(i)})))}(N.shouldDirty||N.shouldTouch)&&C(p,$,N.shouldTouch,N.shouldDirty,!0),N.shouldValidate&&ie(p)},H=(p,_,N)=>{for(const F in _){if(!_.hasOwnProperty(F))return;const $=_[F],D=p+"."+F,z=W(n,D);(o.array.has(p)||Ne($)||z&&!z._f)&&!is($)?H(D,$,N):O(D,$,N)}},J=(p,_,N={})=>{const F=W(n,p),$=o.array.has(p),D=De(_);xe(i,p,D),$?(g.array.next({name:p,values:De(i)}),(u.isDirty||u.dirtyFields||h.isDirty||h.dirtyFields)&&N.shouldDirty&&g.state.next({name:p,dirtyFields:Ws(a,i),isDirty:q(p,D)})):F&&!F._f&&!qe(D)?H(p,D,N):O(p,D,N),Ya(p,o)&&g.state.next({...s}),g.state.next({name:l.mount?p:void 0,values:De(i)})},I=async p=>{l.mount=!0;const _=p.target;let N=_.name,F=!0;const $=W(n,N),D=he=>{F=Number.isNaN(he)||is(he)&&isNaN(he.getTime())||zt(he,W(i,N,he))},z=Za(t.mode),re=Za(t.reValidateMode);if($){let he,Se;const ot=_.type?Ja($._f):Uu(p),et=p.type===za.BLUR||p.type===za.FOCUS_OUT,It=!Yu($._f)&&!t.resolver&&!W(s.errors,N)&&!$._f.deps||th(et,W(s.touchedFields,N),s.isSubmitted,re,z),ct=Ya(N,o,et);xe(i,N,ot),et?($._f.onBlur&&$._f.onBlur(p),c&&c(0)):$._f.onChange&&$._f.onChange(p);const Ue=C(N,ot,et),je=!Ke(Ue)||ct;if(!et&&g.state.next({name:N,type:p.type,values:De(i)}),It)return(u.isValid||h.isValid)&&(t.mode==="onBlur"?et&&x():et||x()),je&&g.state.next({name:N,...ct?{}:Ue});if(!et&&ct&&g.state.next({...s}),t.resolver){const{errors:Yt}=await R([N]);if(D(ot),F){const Xt=Xa(s.errors,n,N),At=Xa(Yt,n,Xt.name||N);he=At.error,N=At.name,Se=Ke(Yt)}}else f([N],!0),he=(await ti($,o.disabled,i,m,t.shouldUseNativeValidation))[N],f([N]),D(ot),F&&(he?Se=!1:(u.isValid||h.isValid)&&(Se=await K(n,!0)));F&&($._f.deps&&ie($._f.deps),A(N,Se,he,Ue))}},V=(p,_)=>{if(W(s.errors,_)&&p.focus)return p.focus(),1},ie=async(p,_={})=>{let N,F;const $=tr(p);if(t.resolver){const D=await se(_e(p)?p:$);N=Ke(D),F=p?!$.some(z=>W(D,z)):N}else p?(F=(await Promise.all($.map(async D=>{const z=W(n,D);return await K(z&&z._f?{[D]:z}:z)}))).every(Boolean),!(!F&&!s.isValid)&&x()):F=N=await K(n);return g.state.next({...!Nt(p)||(u.isValid||h.isValid)&&N!==s.isValid?{}:{name:p},...t.resolver||!p?{isValid:N}:{},errors:s.errors}),_.shouldFocus&&!F&&sr(n,V,p?$:o.mount),F},ye=p=>{const _={...l.mount?i:a};return _e(p)?_:Nt(p)?W(_,p):p.map(N=>W(_,N))},me=(p,_)=>({invalid:!!W((_||s).errors,p),isDirty:!!W((_||s).dirtyFields,p),error:W((_||s).errors,p),isValidating:!!W(s.validatingFields,p),isTouched:!!W((_||s).touchedFields,p)}),Ee=p=>{p&&tr(p).forEach(_=>ke(s.errors,_)),g.state.next({errors:p?s.errors:{}})},Me=(p,_,N)=>{const F=(W(n,p,{_f:{}})._f||{}).ref,$=W(s.errors,p)||{},{ref:D,message:z,type:re,...he}=$;xe(s.errors,p,{...he,..._,ref:F}),g.state.next({name:p,errors:s.errors,isValid:!1}),N&&N.shouldFocus&&F&&F.focus&&F.focus()},B=(p,_)=>ft(p)?g.state.subscribe({next:N=>p(E(void 0,_),N)}):E(p,_,!0),G=p=>g.state.subscribe({next:_=>{eh(p.name,_.name,p.exact)&&Xu(_,p.formState||u,S,p.reRenderRoot)&&p.callback({values:{...i},...s,..._})}}).unsubscribe,Y=p=>(l.mount=!0,h={...h,...p.formState},G({...p,formState:h})),Z=(p,_={})=>{for(const N of p?tr(p):o.mount)o.mount.delete(N),o.array.delete(N),_.keepValue||(ke(n,N),ke(i,N)),!_.keepError&&ke(s.errors,N),!_.keepDirty&&ke(s.dirtyFields,N),!_.keepTouched&&ke(s.touchedFields,N),!_.keepIsValidating&&ke(s.validatingFields,N),!t.shouldUnregister&&!_.keepDefaultValue&&ke(a,N);g.state.next({values:De(i)}),g.state.next({...s,..._.keepDirty?{isDirty:q()}:{}}),!_.keepIsValid&&x()},ce=({disabled:p,name:_})=>{(wt(p)&&l.mount||p||o.disabled.has(_))&&(p?o.disabled.add(_):o.disabled.delete(_))},ue=(p,_={})=>{let N=W(n,p);const F=wt(_.disabled)||wt(t.disabled);return xe(n,p,{...N||{},_f:{...N&&N._f?N._f:{ref:{name:p}},name:p,mount:!0,..._}}),o.mount.add(p),N?ce({disabled:wt(_.disabled)?_.disabled:t.disabled,name:p}):k(p,!0,_.value),{...F?{disabled:_.disabled||t.disabled}:{},...t.progressive?{required:!!_.required,min:Hs(_.min),max:Hs(_.max),minLength:Hs(_.minLength),maxLength:Hs(_.maxLength),pattern:Hs(_.pattern)}:{},name:p,onChange:I,onBlur:I,ref:$=>{if($){ue(p,_),N=W(n,p);const D=_e($.value)&&$.querySelectorAll&&$.querySelectorAll("input,select,textarea")[0]||$,z=Gu(D),re=N._f.refs||[];if(z?re.find(he=>he===D):D===N._f.ref)return;xe(n,p,{_f:{...N._f,...z?{refs:[...re.filter(pn),D,...Array.isArray(W(a,p))?[{}]:[]],ref:{type:D.type,name:p}}:{ref:D}}}),k(p,!1,void 0,D)}else N=W(n,p,{}),N._f&&(N._f.mount=!1),(t.shouldUnregister||_.shouldUnregister)&&!(qu(o.array,p)&&l.action)&&o.unMount.add(p)}}},Qe=()=>t.shouldFocusError&&sr(n,V,o.mount),Re=p=>{wt(p)&&(g.state.next({disabled:p}),sr(n,(_,N)=>{const F=W(n,N);F&&(_.disabled=F._f.disabled||p,Array.isArray(F._f.refs)&&F._f.refs.forEach($=>{$.disabled=F._f.disabled||p}))},0,!1))},ze=(p,_)=>async N=>{let F;N&&(N.preventDefault&&N.preventDefault(),N.persist&&N.persist());let $=De(i);if(g.state.next({isSubmitting:!0}),t.resolver){const{errors:D,values:z}=await R();s.errors=D,$=De(z)}else await K(n);if(o.disabled.size)for(const D of o.disabled)ke($,D);if(ke(s.errors,"root"),Ke(s.errors)){g.state.next({errors:{}});try{await p($,N)}catch(D){F=D}}else _&&await _({...s.errors},N),Qe(),setTimeout(Qe);if(g.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Ke(s.errors)&&!F,submitCount:s.submitCount+1,errors:s.errors}),F)throw F},bt=(p,_={})=>{W(n,p)&&(_e(_.defaultValue)?J(p,De(W(a,p))):(J(p,_.defaultValue),xe(a,p,De(_.defaultValue))),_.keepTouched||ke(s.touchedFields,p),_.keepDirty||(ke(s.dirtyFields,p),s.isDirty=_.defaultValue?q(p,De(W(a,p))):q()),_.keepError||(ke(s.errors,p),u.isValid&&x()),g.state.next({...s}))},We=(p,_={})=>{const N=p?De(p):a,F=De(N),$=Ke(p),D=$?a:F;if(_.keepDefaultValues||(a=N),!_.keepValues){if(_.keepDirtyValues){const z=new Set([...o.mount,...Object.keys(Ws(a,i))]);for(const re of Array.from(z))W(s.dirtyFields,re)?xe(D,re,W(i,re)):J(re,W(D,re))}else{if(Jn&&_e(p))for(const z of o.mount){const re=W(n,z);if(re&&re._f){const he=Array.isArray(re._f.refs)?re._f.refs[0]:re._f.ref;if(Lr(he)){const Se=he.closest("form");if(Se){Se.reset();break}}}}for(const z of o.mount){const re=W(D,z,W(a,z));_e(re)||(xe(D,z,re),J(z,W(D,z)))}}i=De(D),g.array.next({values:{...D}}),g.state.next({values:{...D}})}o={mount:_.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},l.mount=!u.isValid||!!_.keepIsValid||!!_.keepDirtyValues,l.watch=!!t.shouldUnregister,g.state.next({submitCount:_.keepSubmitCount?s.submitCount:0,isDirty:$?!1:_.keepDirty?s.isDirty:!!(_.keepDefaultValues&&!zt(p,a)),isSubmitted:_.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:$?{}:_.keepDirtyValues?_.keepDefaultValues&&i?Ws(a,i):s.dirtyFields:_.keepDefaultValues&&p?Ws(a,p):_.keepDirty?s.dirtyFields:{},touchedFields:_.keepTouched?s.touchedFields:{},errors:_.keepErrors?s.errors:{},isSubmitSuccessful:_.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},Ct=(p,_)=>We(ft(p)?p(i):p,_),Te=(p,_={})=>{const N=W(n,p),F=N&&N._f;if(F){const $=F.refs?F.refs[0]:F.ref;$.focus&&($.focus(),_.shouldSelect&&ft($.select)&&$.select())}},S=p=>{s={...s,...p}},Q={control:{register:ue,unregister:Z,getFieldState:me,handleSubmit:ze,setError:Me,_subscribe:G,_runSchema:R,_focusError:Qe,_getWatch:E,_getDirty:q,_setValid:x,_setFieldArray:y,_setDisabledField:ce,_setErrors:j,_getFieldArray:P,_reset:We,_resetDefaultValues:()=>ft(t.defaultValues)&&t.defaultValues().then(p=>{Ct(p,t.resetOptions),g.state.next({isLoading:!1})}),_removeUnmounted:T,_disableForm:Re,_subjects:g,_proxyFormState:u,get _fields(){return n},get _formValues(){return i},get _state(){return l},set _state(p){l=p},get _defaultValues(){return a},get _names(){return o},set _names(p){o=p},get _formState(){return s},get _options(){return t},set _options(p){t={...t,...p}}},subscribe:Y,trigger:ie,register:ue,handleSubmit:ze,watch:B,setValue:J,getValues:ye,reset:Ct,resetField:bt,clearErrors:Ee,unregister:Z,setError:Me,setFocus:Te,getFieldState:me};return{...Q,formControl:Q}}function ea(r={}){const t=pe.useRef(void 0),s=pe.useRef(void 0),[n,a]=pe.useState({isDirty:!1,isValidating:!1,isLoading:ft(r.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1,isReady:!1,defaultValues:ft(r.defaultValues)?void 0:r.defaultValues});if(!t.current)if(r.formControl)t.current={...r.formControl,formState:n},r.defaultValues&&!ft(r.defaultValues)&&r.formControl.reset(r.defaultValues,r.resetOptions);else{const{formControl:l,...o}=ah(r);t.current={...o,formState:n}}const i=t.current.control;return i._options=r,Wu(()=>{const l=i._subscribe({formState:i._proxyFormState,callback:()=>a({...i._formState}),reRenderRoot:!0});return a(o=>({...o,isReady:!0})),i._formState.isReady=!0,l},[i]),pe.useEffect(()=>i._disableForm(r.disabled),[i,r.disabled]),pe.useEffect(()=>{r.mode&&(i._options.mode=r.mode),r.reValidateMode&&(i._options.reValidateMode=r.reValidateMode)},[i,r.mode,r.reValidateMode]),pe.useEffect(()=>{r.errors&&(i._setErrors(r.errors),i._focusError())},[i,r.errors]),pe.useEffect(()=>{r.shouldUnregister&&i._subjects.state.next({values:i._getWatch()})},[i,r.shouldUnregister]),pe.useEffect(()=>{if(i._proxyFormState.isDirty){const l=i._getDirty();l!==n.isDirty&&i._subjects.state.next({isDirty:l})}},[i,n.isDirty]),pe.useEffect(()=>{r.values&&!zt(r.values,s.current)?(i._reset(r.values,i._options.resetOptions),s.current=r.values,a(l=>({...l}))):i._resetDefaultValues()},[i,r.values]),pe.useEffect(()=>{i._state.mount||(i._setValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next({...i._formState})),i._removeUnmounted()}),t.current.formState=zu(n,i),t.current}const si=(r,t,s)=>{if(r&&"reportValidity"in r){const n=W(s,t);r.setCustomValidity(n&&n.message||""),r.reportValidity()}},xl=(r,t)=>{for(const s in t.fields){const n=t.fields[s];n&&n.ref&&"reportValidity"in n.ref?si(n.ref,s,r):n&&n.refs&&n.refs.forEach(a=>si(a,s,r))}},ih=(r,t)=>{t.shouldUseNativeValidation&&xl(r,t);const s={};for(const n in r){const a=W(t.fields,n),i=Object.assign(r[n]||{},{ref:a&&a.ref});if(lh(t.names||Object.keys(r),n)){const l=Object.assign({},W(s,n));xe(l,"root",i),xe(s,n,l)}else xe(s,n,i)}return s},lh=(r,t)=>{const s=ri(t);return r.some(n=>ri(n).match(`^${s}\\.\\d+`))};function ri(r){return r.replace(/\]|\[/g,"")}function ta(r,t,s){return s===void 0&&(s={}),function(n,a,i){try{return Promise.resolve(function(l,o){try{var c=(t!=null&&t.context,Promise.resolve(r[s.mode==="sync"?"validateSync":"validate"](n,Object.assign({abortEarly:!1},t,{context:a}))).then(function(d){return i.shouldUseNativeValidation&&xl({},i),{values:s.raw?Object.assign({},n):d,errors:{}}}))}catch(d){return o(d)}return c&&c.then?c.then(void 0,o):c}(0,function(l){if(!l.inner)throw l;return{values:{},errors:ih((o=l,c=!i.shouldUseNativeValidation&&i.criteriaMode==="all",(o.inner||[]).reduce(function(d,u){if(d[u.path]||(d[u.path]={message:u.message,type:u.type}),c){var h=d[u.path].types,g=h&&h[u.type];d[u.path]=ol(u.path,c,d,u.type,g?[].concat(g,u.message):u.message)}return d},{})),i)};var o,c}))}catch(l){return Promise.reject(l)}}}function fs(r){this._maxSize=r,this.clear()}fs.prototype.clear=function(){this._size=0,this._values=Object.create(null)};fs.prototype.get=function(r){return this._values[r]};fs.prototype.set=function(r,t){return this._size>=this._maxSize&&this.clear(),r in this._values||this._size++,this._values[r]=t};var oh=/[^.^\]^[]+|(?=\[\]|\.\.)/g,pl=/^\d+$/,ch=/^\d/,dh=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,uh=/^\s*(['"]?)(.*?)(\1)\s*$/,sa=512,ni=new fs(sa),ai=new fs(sa),ii=new fs(sa),ls={Cache:fs,split:Ln,normalizePath:gn,setter:function(r){var t=gn(r);return ai.get(r)||ai.set(r,function(n,a){for(var i=0,l=t.length,o=n;i<l-1;){var c=t[i];if(c==="__proto__"||c==="constructor"||c==="prototype")return n;o=o[t[i++]]}o[t[i]]=a})},getter:function(r,t){var s=gn(r);return ii.get(r)||ii.set(r,function(a){for(var i=0,l=s.length;i<l;)if(a!=null||!t)a=a[s[i++]];else return;return a})},join:function(r){return r.reduce(function(t,s){return t+(ra(s)||pl.test(s)?"["+s+"]":(t?".":"")+s)},"")},forEach:function(r,t,s){hh(Array.isArray(r)?r:Ln(r),t,s)}};function gn(r){return ni.get(r)||ni.set(r,Ln(r).map(function(t){return t.replace(uh,"$2")}))}function Ln(r){return r.match(oh)||[""]}function hh(r,t,s){var n=r.length,a,i,l,o;for(i=0;i<n;i++)a=r[i],a&&(xh(a)&&(a='"'+a+'"'),o=ra(a),l=!o&&/^\d+$/.test(a),t.call(s,a,o,l,i,r))}function ra(r){return typeof r=="string"&&r&&["'",'"'].indexOf(r.charAt(0))!==-1}function mh(r){return r.match(ch)&&!r.match(pl)}function fh(r){return dh.test(r)}function xh(r){return!ra(r)&&(mh(r)||fh(r))}const ph=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,Xr=r=>r.match(ph)||[],en=r=>r[0].toUpperCase()+r.slice(1),na=(r,t)=>Xr(r).join(t).toLowerCase(),gl=r=>Xr(r).reduce((t,s)=>`${t}${t?s[0].toUpperCase()+s.slice(1).toLowerCase():s.toLowerCase()}`,""),gh=r=>en(gl(r)),yh=r=>na(r,"_"),bh=r=>na(r,"-"),vh=r=>en(na(r," ")),jh=r=>Xr(r).map(en).join(" ");var yn={words:Xr,upperFirst:en,camelCase:gl,pascalCase:gh,snakeCase:yh,kebabCase:bh,sentenceCase:vh,titleCase:jh},aa={exports:{}};aa.exports=function(r){return yl(wh(r),r)};aa.exports.array=yl;function yl(r,t){var s=r.length,n=new Array(s),a={},i=s,l=_h(t),o=Nh(r);for(t.forEach(function(d){if(!o.has(d[0])||!o.has(d[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});i--;)a[i]||c(r[i],i,new Set);return n;function c(d,u,h){if(h.has(d)){var g;try{g=", node was:"+JSON.stringify(d)}catch{g=""}throw new Error("Cyclic dependency"+g)}if(!o.has(d))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(d));if(!a[u]){a[u]=!0;var m=l.get(d)||new Set;if(m=Array.from(m),u=m.length){h.add(d);do{var v=m[--u];c(v,o.get(v),h)}while(u);h.delete(d)}n[--s]=d}}}function wh(r){for(var t=new Set,s=0,n=r.length;s<n;s++){var a=r[s];t.add(a[0]),t.add(a[1])}return Array.from(t)}function _h(r){for(var t=new Map,s=0,n=r.length;s<n;s++){var a=r[s];t.has(a[0])||t.set(a[0],new Set),t.has(a[1])||t.set(a[1],new Set),t.get(a[0]).add(a[1])}return t}function Nh(r){for(var t=new Map,s=0,n=r.length;s<n;s++)t.set(r[s],s);return t}var Sh=aa.exports;const kh=Ai(Sh),Eh=Object.prototype.toString,Ch=Error.prototype.toString,Ah=RegExp.prototype.toString,Th=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",Oh=/^Symbol\((.*)\)(.*)$/;function Ph(r){return r!=+r?"NaN":r===0&&1/r<0?"-0":""+r}function li(r,t=!1){if(r==null||r===!0||r===!1)return""+r;const s=typeof r;if(s==="number")return Ph(r);if(s==="string")return t?`"${r}"`:r;if(s==="function")return"[Function "+(r.name||"anonymous")+"]";if(s==="symbol")return Th.call(r).replace(Oh,"Symbol($1)");const n=Eh.call(r).slice(8,-1);return n==="Date"?isNaN(r.getTime())?""+r:r.toISOString(r):n==="Error"||r instanceof Error?"["+Ch.call(r)+"]":n==="RegExp"?Ah.call(r):null}function Gt(r,t){let s=li(r,t);return s!==null?s:JSON.stringify(r,function(n,a){let i=li(this[n],t);return i!==null?i:a},2)}function bl(r){return r==null?[]:[].concat(r)}let vl,jl,wl,$h=/\$\{\s*(\w+)\s*\}/g;vl=Symbol.toStringTag;class oi{constructor(t,s,n,a){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[vl]="Error",this.name="ValidationError",this.value=s,this.path=n,this.type=a,this.errors=[],this.inner=[],bl(t).forEach(i=>{if(Ze.isError(i)){this.errors.push(...i.errors);const l=i.inner.length?i.inner:[i];this.inner.push(...l)}else this.errors.push(i)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}jl=Symbol.hasInstance;wl=Symbol.toStringTag;class Ze extends Error{static formatError(t,s){const n=s.label||s.path||"this";return s=Object.assign({},s,{path:n,originalPath:s.path}),typeof t=="string"?t.replace($h,(a,i)=>Gt(s[i])):typeof t=="function"?t(s):t}static isError(t){return t&&t.name==="ValidationError"}constructor(t,s,n,a,i){const l=new oi(t,s,n,a);if(i)return l;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[wl]="Error",this.name=l.name,this.message=l.message,this.type=l.type,this.value=l.value,this.path=l.path,this.errors=l.errors,this.inner=l.inner,Error.captureStackTrace&&Error.captureStackTrace(this,Ze)}static[jl](t){return oi[Symbol.hasInstance](t)||super[Symbol.hasInstance](t)}}let _t={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:r,type:t,value:s,originalValue:n})=>{const a=n!=null&&n!==s?` (cast from the value \`${Gt(n,!0)}\`).`:".";return t!=="mixed"?`${r} must be a \`${t}\` type, but the final value was: \`${Gt(s,!0)}\``+a:`${r} must match the configured type. The validated value was: \`${Gt(s,!0)}\``+a}},Ge={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},Bt={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},Rn={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},Dh={isValue:"${path} field must be ${value}"},Cr={noUnknown:"${path} field has unspecified keys: ${unknown}",exact:"${path} object contains unknown properties: ${properties}"},Lh={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},Rh={notType:r=>{const{path:t,value:s,spec:n}=r,a=n.types.length;if(Array.isArray(s)){if(s.length<a)return`${t} tuple value has too few items, expected a length of ${a} but got ${s.length} for value: \`${Gt(s,!0)}\``;if(s.length>a)return`${t} tuple value has too many items, expected a length of ${a} but got ${s.length} for value: \`${Gt(s,!0)}\``}return Ze.formatError(_t.notType,r)}};Object.assign(Object.create(null),{mixed:_t,string:Ge,number:Bt,date:Rn,object:Cr,array:Lh,boolean:Dh,tuple:Rh});const ia=r=>r&&r.__isYupSchema__;class Ir{static fromOptions(t,s){if(!s.then&&!s.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:n,then:a,otherwise:i}=s,l=typeof n=="function"?n:(...o)=>o.every(c=>c===n);return new Ir(t,(o,c)=>{var d;let u=l(...o)?a:i;return(d=u==null?void 0:u(c))!=null?d:c})}constructor(t,s){this.fn=void 0,this.refs=t,this.refs=t,this.fn=s}resolve(t,s){let n=this.refs.map(i=>i.getValue(s==null?void 0:s.value,s==null?void 0:s.parent,s==null?void 0:s.context)),a=this.fn(n,t,s);if(a===void 0||a===t)return t;if(!ia(a))throw new TypeError("conditions must return a schema object");return a.resolve(s)}}const Nr={context:"$",value:"."};class xs{constructor(t,s={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof t!="string")throw new TypeError("ref must be a string, got: "+t);if(this.key=t.trim(),t==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===Nr.context,this.isValue=this.key[0]===Nr.value,this.isSibling=!this.isContext&&!this.isValue;let n=this.isContext?Nr.context:this.isValue?Nr.value:"";this.path=this.key.slice(n.length),this.getter=this.path&&ls.getter(this.path,!0),this.map=s.map}getValue(t,s,n){let a=this.isContext?n:this.isValue?t:s;return this.getter&&(a=this.getter(a||{})),this.map&&(a=this.map(a)),a}cast(t,s){return this.getValue(t,s==null?void 0:s.parent,s==null?void 0:s.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(t){return t&&t.__isYupRef}}xs.prototype.__isYupRef=!0;const Rt=r=>r==null;function Ss(r){function t({value:s,path:n="",options:a,originalValue:i,schema:l},o,c){const{name:d,test:u,params:h,message:g,skipAbsent:m}=r;let{parent:v,context:x,abortEarly:f=l.spec.abortEarly,disableStackTrace:y=l.spec.disableStackTrace}=a;function w(q){return xs.isRef(q)?q.getValue(s,v,x):q}function j(q={}){const E=Object.assign({value:s,originalValue:i,label:l.spec.label,path:q.path||n,spec:l.spec,disableStackTrace:q.disableStackTrace||y},h,q.params);for(const O of Object.keys(E))E[O]=w(E[O]);const P=new Ze(Ze.formatError(q.message||g,E),s,E.path,q.type||d,E.disableStackTrace);return P.params=E,P}const k=f?o:c;let C={path:n,parent:v,type:d,from:a.from,createError:j,resolve:w,options:a,originalValue:i,schema:l};const A=q=>{Ze.isError(q)?k(q):q?c(null):k(j())},R=q=>{Ze.isError(q)?k(q):o(q)};if(m&&Rt(s))return A(!0);let K;try{var T;if(K=u.call(C,s,C),typeof((T=K)==null?void 0:T.then)=="function"){if(a.sync)throw new Error(`Validation test of type: "${C.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(K).then(A,R)}}catch(q){R(q);return}A(K)}return t.OPTIONS=r,t}function Fh(r,t,s,n=s){let a,i,l;return t?(ls.forEach(t,(o,c,d)=>{let u=c?o.slice(1,o.length-1):o;r=r.resolve({context:n,parent:a,value:s});let h=r.type==="tuple",g=d?parseInt(u,10):0;if(r.innerType||h){if(h&&!d)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${l}" must contain an index to the tuple element, e.g. "${l}[0]"`);if(s&&g>=s.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${o}, in the path: ${t}. because there is no value at that index. `);a=s,s=s&&s[g],r=h?r.spec.types[g]:r.innerType}if(!d){if(!r.fields||!r.fields[u])throw new Error(`The schema does not contain the path: ${t}. (failed at: ${l} which is a type: "${r.type}")`);a=s,s=s&&s[u],r=r.fields[u]}i=u,l=c?"["+o+"]":"."+o}),{schema:r,parent:a,parentPath:i}):{parent:a,parentPath:t,schema:r}}class Ur extends Set{describe(){const t=[];for(const s of this.values())t.push(xs.isRef(s)?s.describe():s);return t}resolveAll(t){let s=[];for(const n of this.values())s.push(t(n));return s}clone(){return new Ur(this.values())}merge(t,s){const n=this.clone();return t.forEach(a=>n.add(a)),s.forEach(a=>n.delete(a)),n}}function Cs(r,t=new Map){if(ia(r)||!r||typeof r!="object")return r;if(t.has(r))return t.get(r);let s;if(r instanceof Date)s=new Date(r.getTime()),t.set(r,s);else if(r instanceof RegExp)s=new RegExp(r),t.set(r,s);else if(Array.isArray(r)){s=new Array(r.length),t.set(r,s);for(let n=0;n<r.length;n++)s[n]=Cs(r[n],t)}else if(r instanceof Map){s=new Map,t.set(r,s);for(const[n,a]of r.entries())s.set(n,Cs(a,t))}else if(r instanceof Set){s=new Set,t.set(r,s);for(const n of r)s.add(Cs(n,t))}else if(r instanceof Object){s={},t.set(r,s);for(const[n,a]of Object.entries(r))s[n]=Cs(a,t)}else throw Error(`Unable to clone ${r}`);return s}class lt{constructor(t){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new Ur,this._blacklist=new Ur,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(_t.notType)}),this.type=t.type,this._typeCheck=t.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},t==null?void 0:t.spec),this.withMutation(s=>{s.nonNullable()})}get _type(){return this.type}clone(t){if(this._mutate)return t&&Object.assign(this.spec,t),this;const s=Object.create(Object.getPrototypeOf(this));return s.type=this.type,s._typeCheck=this._typeCheck,s._whitelist=this._whitelist.clone(),s._blacklist=this._blacklist.clone(),s.internalTests=Object.assign({},this.internalTests),s.exclusiveTests=Object.assign({},this.exclusiveTests),s.deps=[...this.deps],s.conditions=[...this.conditions],s.tests=[...this.tests],s.transforms=[...this.transforms],s.spec=Cs(Object.assign({},this.spec,t)),s}label(t){let s=this.clone();return s.spec.label=t,s}meta(...t){if(t.length===0)return this.spec.meta;let s=this.clone();return s.spec.meta=Object.assign(s.spec.meta||{},t[0]),s}withMutation(t){let s=this._mutate;this._mutate=!0;let n=t(this);return this._mutate=s,n}concat(t){if(!t||t===this)return this;if(t.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${t.type}`);let s=this,n=t.clone();const a=Object.assign({},s.spec,n.spec);return n.spec=a,n.internalTests=Object.assign({},s.internalTests,n.internalTests),n._whitelist=s._whitelist.merge(t._whitelist,t._blacklist),n._blacklist=s._blacklist.merge(t._blacklist,t._whitelist),n.tests=s.tests,n.exclusiveTests=s.exclusiveTests,n.withMutation(i=>{t.tests.forEach(l=>{i.test(l.OPTIONS)})}),n.transforms=[...s.transforms,...n.transforms],n}isType(t){return t==null?!!(this.spec.nullable&&t===null||this.spec.optional&&t===void 0):this._typeCheck(t)}resolve(t){let s=this;if(s.conditions.length){let n=s.conditions;s=s.clone(),s.conditions=[],s=n.reduce((a,i)=>i.resolve(a,t),s),s=s.resolve(t)}return s}resolveOptions(t){var s,n,a,i;return Object.assign({},t,{from:t.from||[],strict:(s=t.strict)!=null?s:this.spec.strict,abortEarly:(n=t.abortEarly)!=null?n:this.spec.abortEarly,recursive:(a=t.recursive)!=null?a:this.spec.recursive,disableStackTrace:(i=t.disableStackTrace)!=null?i:this.spec.disableStackTrace})}cast(t,s={}){let n=this.resolve(Object.assign({value:t},s)),a=s.assert==="ignore-optionality",i=n._cast(t,s);if(s.assert!==!1&&!n.isType(i)){if(a&&Rt(i))return i;let l=Gt(t),o=Gt(i);throw new TypeError(`The value of ${s.path||"field"} could not be cast to a value that satisfies the schema type: "${n.type}". 

attempted value: ${l} 
`+(o!==l?`result of cast: ${o}`:""))}return i}_cast(t,s){let n=t===void 0?t:this.transforms.reduce((a,i)=>i.call(this,a,t,this),t);return n===void 0&&(n=this.getDefault(s)),n}_validate(t,s={},n,a){let{path:i,originalValue:l=t,strict:o=this.spec.strict}=s,c=t;o||(c=this._cast(c,Object.assign({assert:!1},s)));let d=[];for(let u of Object.values(this.internalTests))u&&d.push(u);this.runTests({path:i,value:c,originalValue:l,options:s,tests:d},n,u=>{if(u.length)return a(u,c);this.runTests({path:i,value:c,originalValue:l,options:s,tests:this.tests},n,a)})}runTests(t,s,n){let a=!1,{tests:i,value:l,originalValue:o,path:c,options:d}=t,u=x=>{a||(a=!0,s(x,l))},h=x=>{a||(a=!0,n(x,l))},g=i.length,m=[];if(!g)return h([]);let v={value:l,originalValue:o,path:c,options:d,schema:this};for(let x=0;x<i.length;x++){const f=i[x];f(v,u,function(w){w&&(Array.isArray(w)?m.push(...w):m.push(w)),--g<=0&&h(m)})}}asNestedTest({key:t,index:s,parent:n,parentPath:a,originalParent:i,options:l}){const o=t??s;if(o==null)throw TypeError("Must include `key` or `index` for nested validations");const c=typeof o=="number";let d=n[o];const u=Object.assign({},l,{strict:!0,parent:n,value:d,originalValue:i[o],key:void 0,[c?"index":"key"]:o,path:c||o.includes(".")?`${a||""}[${c?o:`"${o}"`}]`:(a?`${a}.`:"")+t});return(h,g,m)=>this.resolve(u)._validate(d,u,g,m)}validate(t,s){var n;let a=this.resolve(Object.assign({},s,{value:t})),i=(n=s==null?void 0:s.disableStackTrace)!=null?n:a.spec.disableStackTrace;return new Promise((l,o)=>a._validate(t,s,(c,d)=>{Ze.isError(c)&&(c.value=d),o(c)},(c,d)=>{c.length?o(new Ze(c,d,void 0,void 0,i)):l(d)}))}validateSync(t,s){var n;let a=this.resolve(Object.assign({},s,{value:t})),i,l=(n=s==null?void 0:s.disableStackTrace)!=null?n:a.spec.disableStackTrace;return a._validate(t,Object.assign({},s,{sync:!0}),(o,c)=>{throw Ze.isError(o)&&(o.value=c),o},(o,c)=>{if(o.length)throw new Ze(o,t,void 0,void 0,l);i=c}),i}isValid(t,s){return this.validate(t,s).then(()=>!0,n=>{if(Ze.isError(n))return!1;throw n})}isValidSync(t,s){try{return this.validateSync(t,s),!0}catch(n){if(Ze.isError(n))return!1;throw n}}_getDefault(t){let s=this.spec.default;return s==null?s:typeof s=="function"?s.call(this,t):Cs(s)}getDefault(t){return this.resolve(t||{})._getDefault(t)}default(t){return arguments.length===0?this._getDefault():this.clone({default:t})}strict(t=!0){return this.clone({strict:t})}nullability(t,s){const n=this.clone({nullable:t});return n.internalTests.nullable=Ss({message:s,name:"nullable",test(a){return a===null?this.schema.spec.nullable:!0}}),n}optionality(t,s){const n=this.clone({optional:t});return n.internalTests.optionality=Ss({message:s,name:"optionality",test(a){return a===void 0?this.schema.spec.optional:!0}}),n}optional(){return this.optionality(!0)}defined(t=_t.defined){return this.optionality(!1,t)}nullable(){return this.nullability(!0)}nonNullable(t=_t.notNull){return this.nullability(!1,t)}required(t=_t.required){return this.clone().withMutation(s=>s.nonNullable(t).defined(t))}notRequired(){return this.clone().withMutation(t=>t.nullable().optional())}transform(t){let s=this.clone();return s.transforms.push(t),s}test(...t){let s;if(t.length===1?typeof t[0]=="function"?s={test:t[0]}:s=t[0]:t.length===2?s={name:t[0],test:t[1]}:s={name:t[0],message:t[1],test:t[2]},s.message===void 0&&(s.message=_t.default),typeof s.test!="function")throw new TypeError("`test` is a required parameters");let n=this.clone(),a=Ss(s),i=s.exclusive||s.name&&n.exclusiveTests[s.name]===!0;if(s.exclusive&&!s.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return s.name&&(n.exclusiveTests[s.name]=!!s.exclusive),n.tests=n.tests.filter(l=>!(l.OPTIONS.name===s.name&&(i||l.OPTIONS.test===a.OPTIONS.test))),n.tests.push(a),n}when(t,s){!Array.isArray(t)&&typeof t!="string"&&(s=t,t=".");let n=this.clone(),a=bl(t).map(i=>new xs(i));return a.forEach(i=>{i.isSibling&&n.deps.push(i.key)}),n.conditions.push(typeof s=="function"?new Ir(a,s):Ir.fromOptions(a,s)),n}typeError(t){let s=this.clone();return s.internalTests.typeError=Ss({message:t,name:"typeError",skipAbsent:!0,test(n){return this.schema._typeCheck(n)?!0:this.createError({params:{type:this.schema.type}})}}),s}oneOf(t,s=_t.oneOf){let n=this.clone();return t.forEach(a=>{n._whitelist.add(a),n._blacklist.delete(a)}),n.internalTests.whiteList=Ss({message:s,name:"oneOf",skipAbsent:!0,test(a){let i=this.schema._whitelist,l=i.resolveAll(this.resolve);return l.includes(a)?!0:this.createError({params:{values:Array.from(i).join(", "),resolved:l}})}}),n}notOneOf(t,s=_t.notOneOf){let n=this.clone();return t.forEach(a=>{n._blacklist.add(a),n._whitelist.delete(a)}),n.internalTests.blacklist=Ss({message:s,name:"notOneOf",test(a){let i=this.schema._blacklist,l=i.resolveAll(this.resolve);return l.includes(a)?this.createError({params:{values:Array.from(i).join(", "),resolved:l}}):!0}}),n}strip(t=!0){let s=this.clone();return s.spec.strip=t,s}describe(t){const s=(t?this.resolve(t):this).clone(),{label:n,meta:a,optional:i,nullable:l}=s.spec;return{meta:a,label:n,optional:i,nullable:l,default:s.getDefault(t),type:s.type,oneOf:s._whitelist.describe(),notOneOf:s._blacklist.describe(),tests:s.tests.map(c=>({name:c.OPTIONS.name,params:c.OPTIONS.params})).filter((c,d,u)=>u.findIndex(h=>h.name===c.name)===d)}}}lt.prototype.__isYupSchema__=!0;for(const r of["validate","validateSync"])lt.prototype[`${r}At`]=function(t,s,n={}){const{parent:a,parentPath:i,schema:l}=Fh(this,t,s,n.context);return l[r](a&&a[i],Object.assign({},n,{parent:a,path:t}))};for(const r of["equals","is"])lt.prototype[r]=lt.prototype.oneOf;for(const r of["not","nope"])lt.prototype[r]=lt.prototype.notOneOf;const Ih=()=>!0;function _l(r){return new Nl(r)}class Nl extends lt{constructor(t){super(typeof t=="function"?{type:"mixed",check:t}:Object.assign({type:"mixed",check:Ih},t))}}_l.prototype=Nl.prototype;const Uh=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function Bh(r){const t=Fn(r);if(!t)return Date.parse?Date.parse(r):Number.NaN;if(t.z===void 0&&t.plusMinus===void 0)return new Date(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond).valueOf();let s=0;return t.z!=="Z"&&t.plusMinus!==void 0&&(s=t.hourOffset*60+t.minuteOffset,t.plusMinus==="+"&&(s=0-s)),Date.UTC(t.year,t.month,t.day,t.hour,t.minute+s,t.second,t.millisecond)}function Fn(r){var t,s;const n=Uh.exec(r);return n?{year:$t(n[1]),month:$t(n[2],1)-1,day:$t(n[3],1),hour:$t(n[4]),minute:$t(n[5]),second:$t(n[6]),millisecond:n[7]?$t(n[7].substring(0,3)):0,precision:(t=(s=n[7])==null?void 0:s.length)!=null?t:void 0,z:n[8]||void 0,plusMinus:n[9]||void 0,hourOffset:$t(n[10]),minuteOffset:$t(n[11])}:null}function $t(r,t=0){return Number(r)||t}let qh=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Vh=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,Mh=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,zh="^\\d{4}-\\d{2}-\\d{2}",Wh="\\d{2}:\\d{2}:\\d{2}",Hh="(([+-]\\d{2}(:?\\d{2})?)|Z)",Gh=new RegExp(`${zh}T${Wh}(\\.\\d+)?${Hh}$`),Kh=r=>Rt(r)||r===r.trim(),Jh={}.toString();function ut(){return new Sl}class Sl extends lt{constructor(){super({type:"string",check(t){return t instanceof String&&(t=t.valueOf()),typeof t=="string"}}),this.withMutation(()=>{this.transform((t,s,n)=>{if(!n.spec.coerce||n.isType(t)||Array.isArray(t))return t;const a=t!=null&&t.toString?t.toString():t;return a===Jh?t:a})})}required(t){return super.required(t).withMutation(s=>s.test({message:t||_t.required,name:"required",skipAbsent:!0,test:n=>!!n.length}))}notRequired(){return super.notRequired().withMutation(t=>(t.tests=t.tests.filter(s=>s.OPTIONS.name!=="required"),t))}length(t,s=Ge.length){return this.test({message:s,name:"length",exclusive:!0,params:{length:t},skipAbsent:!0,test(n){return n.length===this.resolve(t)}})}min(t,s=Ge.min){return this.test({message:s,name:"min",exclusive:!0,params:{min:t},skipAbsent:!0,test(n){return n.length>=this.resolve(t)}})}max(t,s=Ge.max){return this.test({name:"max",exclusive:!0,message:s,params:{max:t},skipAbsent:!0,test(n){return n.length<=this.resolve(t)}})}matches(t,s){let n=!1,a,i;return s&&(typeof s=="object"?{excludeEmptyString:n=!1,message:a,name:i}=s:a=s),this.test({name:i||"matches",message:a||Ge.matches,params:{regex:t},skipAbsent:!0,test:l=>l===""&&n||l.search(t)!==-1})}email(t=Ge.email){return this.matches(qh,{name:"email",message:t,excludeEmptyString:!0})}url(t=Ge.url){return this.matches(Vh,{name:"url",message:t,excludeEmptyString:!0})}uuid(t=Ge.uuid){return this.matches(Mh,{name:"uuid",message:t,excludeEmptyString:!1})}datetime(t){let s="",n,a;return t&&(typeof t=="object"?{message:s="",allowOffset:n=!1,precision:a=void 0}=t:s=t),this.matches(Gh,{name:"datetime",message:s||Ge.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:s||Ge.datetime_offset,params:{allowOffset:n},skipAbsent:!0,test:i=>{if(!i||n)return!0;const l=Fn(i);return l?!!l.z:!1}}).test({name:"datetime_precision",message:s||Ge.datetime_precision,params:{precision:a},skipAbsent:!0,test:i=>{if(!i||a==null)return!0;const l=Fn(i);return l?l.precision===a:!1}})}ensure(){return this.default("").transform(t=>t===null?"":t)}trim(t=Ge.trim){return this.transform(s=>s!=null?s.trim():s).test({message:t,name:"trim",test:Kh})}lowercase(t=Ge.lowercase){return this.transform(s=>Rt(s)?s:s.toLowerCase()).test({message:t,name:"string_case",exclusive:!0,skipAbsent:!0,test:s=>Rt(s)||s===s.toLowerCase()})}uppercase(t=Ge.uppercase){return this.transform(s=>Rt(s)?s:s.toUpperCase()).test({message:t,name:"string_case",exclusive:!0,skipAbsent:!0,test:s=>Rt(s)||s===s.toUpperCase()})}}ut.prototype=Sl.prototype;let Zh=r=>r!=+r;function Ks(){return new kl}class kl extends lt{constructor(){super({type:"number",check(t){return t instanceof Number&&(t=t.valueOf()),typeof t=="number"&&!Zh(t)}}),this.withMutation(()=>{this.transform((t,s,n)=>{if(!n.spec.coerce)return t;let a=t;if(typeof a=="string"){if(a=a.replace(/\s/g,""),a==="")return NaN;a=+a}return n.isType(a)||a===null?a:parseFloat(a)})})}min(t,s=Bt.min){return this.test({message:s,name:"min",exclusive:!0,params:{min:t},skipAbsent:!0,test(n){return n>=this.resolve(t)}})}max(t,s=Bt.max){return this.test({message:s,name:"max",exclusive:!0,params:{max:t},skipAbsent:!0,test(n){return n<=this.resolve(t)}})}lessThan(t,s=Bt.lessThan){return this.test({message:s,name:"max",exclusive:!0,params:{less:t},skipAbsent:!0,test(n){return n<this.resolve(t)}})}moreThan(t,s=Bt.moreThan){return this.test({message:s,name:"min",exclusive:!0,params:{more:t},skipAbsent:!0,test(n){return n>this.resolve(t)}})}positive(t=Bt.positive){return this.moreThan(0,t)}negative(t=Bt.negative){return this.lessThan(0,t)}integer(t=Bt.integer){return this.test({name:"integer",message:t,skipAbsent:!0,test:s=>Number.isInteger(s)})}truncate(){return this.transform(t=>Rt(t)?t:t|0)}round(t){var s;let n=["ceil","floor","round","trunc"];if(t=((s=t)==null?void 0:s.toLowerCase())||"round",t==="trunc")return this.truncate();if(n.indexOf(t.toLowerCase())===-1)throw new TypeError("Only valid options for round() are: "+n.join(", "));return this.transform(a=>Rt(a)?a:Math[t](a))}}Ks.prototype=kl.prototype;let Qh=new Date(""),Yh=r=>Object.prototype.toString.call(r)==="[object Date]";class la extends lt{constructor(){super({type:"date",check(t){return Yh(t)&&!isNaN(t.getTime())}}),this.withMutation(()=>{this.transform((t,s,n)=>!n.spec.coerce||n.isType(t)||t===null?t:(t=Bh(t),isNaN(t)?la.INVALID_DATE:new Date(t)))})}prepareParam(t,s){let n;if(xs.isRef(t))n=t;else{let a=this.cast(t);if(!this._typeCheck(a))throw new TypeError(`\`${s}\` must be a Date or a value that can be \`cast()\` to a Date`);n=a}return n}min(t,s=Rn.min){let n=this.prepareParam(t,"min");return this.test({message:s,name:"min",exclusive:!0,params:{min:t},skipAbsent:!0,test(a){return a>=this.resolve(n)}})}max(t,s=Rn.max){let n=this.prepareParam(t,"max");return this.test({message:s,name:"max",exclusive:!0,params:{max:t},skipAbsent:!0,test(a){return a<=this.resolve(n)}})}}la.INVALID_DATE=Qh;function Xh(r,t=[]){let s=[],n=new Set,a=new Set(t.map(([l,o])=>`${l}-${o}`));function i(l,o){let c=ls.split(l)[0];n.add(c),a.has(`${o}-${c}`)||s.push([o,c])}for(const l of Object.keys(r)){let o=r[l];n.add(l),xs.isRef(o)&&o.isSibling?i(o.path,l):ia(o)&&"deps"in o&&o.deps.forEach(c=>i(c,l))}return kh.array(Array.from(n),s).reverse()}function ci(r,t){let s=1/0;return r.some((n,a)=>{var i;if((i=t.path)!=null&&i.includes(n))return s=a,!0}),s}function El(r){return(t,s)=>ci(r,t)-ci(r,s)}const em=(r,t,s)=>{if(typeof r!="string")return r;let n=r;try{n=JSON.parse(r)}catch{}return s.isType(n)?n:r};function Ar(r){if("fields"in r){const t={};for(const[s,n]of Object.entries(r.fields))t[s]=Ar(n);return r.setFields(t)}if(r.type==="array"){const t=r.optional();return t.innerType&&(t.innerType=Ar(t.innerType)),t}return r.type==="tuple"?r.optional().clone({types:r.spec.types.map(Ar)}):"optional"in r?r.optional():r}const tm=(r,t)=>{const s=[...ls.normalizePath(t)];if(s.length===1)return s[0]in r;let n=s.pop(),a=ls.getter(ls.join(s),!0)(r);return!!(a&&n in a)};let di=r=>Object.prototype.toString.call(r)==="[object Object]";function ui(r,t){let s=Object.keys(r.fields);return Object.keys(t).filter(n=>s.indexOf(n)===-1)}const sm=El([]);function tn(r){return new Cl(r)}class Cl extends lt{constructor(t){super({type:"object",check(s){return di(s)||typeof s=="function"}}),this.fields=Object.create(null),this._sortErrors=sm,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{t&&this.shape(t)})}_cast(t,s={}){var n;let a=super._cast(t,s);if(a===void 0)return this.getDefault(s);if(!this._typeCheck(a))return a;let i=this.fields,l=(n=s.stripUnknown)!=null?n:this.spec.noUnknown,o=[].concat(this._nodes,Object.keys(a).filter(h=>!this._nodes.includes(h))),c={},d=Object.assign({},s,{parent:c,__validating:s.__validating||!1}),u=!1;for(const h of o){let g=i[h],m=h in a;if(g){let v,x=a[h];d.path=(s.path?`${s.path}.`:"")+h,g=g.resolve({value:x,context:s.context,parent:c});let f=g instanceof lt?g.spec:void 0,y=f==null?void 0:f.strict;if(f!=null&&f.strip){u=u||h in a;continue}v=!s.__validating||!y?g.cast(a[h],d):a[h],v!==void 0&&(c[h]=v)}else m&&!l&&(c[h]=a[h]);(m!==h in c||c[h]!==a[h])&&(u=!0)}return u?c:a}_validate(t,s={},n,a){let{from:i=[],originalValue:l=t,recursive:o=this.spec.recursive}=s;s.from=[{schema:this,value:l},...i],s.__validating=!0,s.originalValue=l,super._validate(t,s,n,(c,d)=>{if(!o||!di(d)){a(c,d);return}l=l||d;let u=[];for(let h of this._nodes){let g=this.fields[h];!g||xs.isRef(g)||u.push(g.asNestedTest({options:s,key:h,parent:d,parentPath:s.path,originalParent:l}))}this.runTests({tests:u,value:d,originalValue:l,options:s},n,h=>{a(h.sort(this._sortErrors).concat(c),d)})})}clone(t){const s=super.clone(t);return s.fields=Object.assign({},this.fields),s._nodes=this._nodes,s._excludedEdges=this._excludedEdges,s._sortErrors=this._sortErrors,s}concat(t){let s=super.concat(t),n=s.fields;for(let[a,i]of Object.entries(this.fields)){const l=n[a];n[a]=l===void 0?i:l}return s.withMutation(a=>a.setFields(n,[...this._excludedEdges,...t._excludedEdges]))}_getDefault(t){if("default"in this.spec)return super._getDefault(t);if(!this._nodes.length)return;let s={};return this._nodes.forEach(n=>{var a;const i=this.fields[n];let l=t;(a=l)!=null&&a.value&&(l=Object.assign({},l,{parent:l.value,value:l.value[n]})),s[n]=i&&"getDefault"in i?i.getDefault(l):void 0}),s}setFields(t,s){let n=this.clone();return n.fields=t,n._nodes=Xh(t,s),n._sortErrors=El(Object.keys(t)),s&&(n._excludedEdges=s),n}shape(t,s=[]){return this.clone().withMutation(n=>{let a=n._excludedEdges;return s.length&&(Array.isArray(s[0])||(s=[s]),a=[...n._excludedEdges,...s]),n.setFields(Object.assign(n.fields,t),a)})}partial(){const t={};for(const[s,n]of Object.entries(this.fields))t[s]="optional"in n&&n.optional instanceof Function?n.optional():n;return this.setFields(t)}deepPartial(){return Ar(this)}pick(t){const s={};for(const n of t)this.fields[n]&&(s[n]=this.fields[n]);return this.setFields(s,this._excludedEdges.filter(([n,a])=>t.includes(n)&&t.includes(a)))}omit(t){const s=[];for(const n of Object.keys(this.fields))t.includes(n)||s.push(n);return this.pick(s)}from(t,s,n){let a=ls.getter(t,!0);return this.transform(i=>{if(!i)return i;let l=i;return tm(i,t)&&(l=Object.assign({},i),n||delete l[t],l[s]=a(i)),l})}json(){return this.transform(em)}exact(t){return this.test({name:"exact",exclusive:!0,message:t||Cr.exact,test(s){if(s==null)return!0;const n=ui(this.schema,s);return n.length===0||this.createError({params:{properties:n.join(", ")}})}})}stripUnknown(){return this.clone({noUnknown:!0})}noUnknown(t=!0,s=Cr.noUnknown){typeof t!="boolean"&&(s=t,t=!0);let n=this.test({name:"noUnknown",exclusive:!0,message:s,test(a){if(a==null)return!0;const i=ui(this.schema,a);return!t||i.length===0||this.createError({params:{unknown:i.join(", ")}})}});return n.spec.noUnknown=t,n}unknown(t=!0,s=Cr.noUnknown){return this.noUnknown(!t,s)}transformKeys(t){return this.transform(s=>{if(!s)return s;const n={};for(const a of Object.keys(s))n[t(a)]=s[a];return n})}camelCase(){return this.transformKeys(yn.camelCase)}snakeCase(){return this.transformKeys(yn.snakeCase)}constantCase(){return this.transformKeys(t=>yn.snakeCase(t).toUpperCase())}describe(t){const s=(t?this.resolve(t):this).clone(),n=super.describe(t);n.fields={};for(const[i,l]of Object.entries(s.fields)){var a;let o=t;(a=o)!=null&&a.value&&(o=Object.assign({},o,{parent:o.value,value:o.value[i]})),n.fields[i]=l.describe(o)}return n}}tn.prototype=Cl.prototype;const rm=pe.createContext({}),Al=!0;function nm({baseColor:r,highlightColor:t,width:s,height:n,borderRadius:a,circle:i,direction:l,duration:o,enableAnimation:c=Al,customHighlightBackground:d}){const u={};return l==="rtl"&&(u["--animation-direction"]="reverse"),typeof o=="number"&&(u["--animation-duration"]=`${o}s`),c||(u["--pseudo-element-display"]="none"),(typeof s=="string"||typeof s=="number")&&(u.width=s),(typeof n=="string"||typeof n=="number")&&(u.height=n),(typeof a=="string"||typeof a=="number")&&(u.borderRadius=a),i&&(u.borderRadius="50%"),typeof r<"u"&&(u["--base-color"]=r),typeof t<"u"&&(u["--highlight-color"]=t),typeof d=="string"&&(u["--custom-highlight-background"]=d),u}function Ts({count:r=1,wrapper:t,className:s,containerClassName:n,containerTestId:a,circle:i=!1,style:l,...o}){var c,d,u;const h=pe.useContext(rm),g={...o};for(const[j,k]of Object.entries(o))typeof k>"u"&&delete g[j];const m={...h,...g,circle:i},v={...l,...nm(m)};let x="react-loading-skeleton";s&&(x+=` ${s}`);const f=(c=m.inline)!==null&&c!==void 0?c:!1,y=[],w=Math.ceil(r);for(let j=0;j<w;j++){let k=v;if(w>r&&j===w-1){const A=(d=k.width)!==null&&d!==void 0?d:"100%",R=r%1,se=typeof A=="number"?A*R:`calc(${A} * ${R})`;k={...k,width:se}}const C=pe.createElement("span",{className:x,style:k,key:j},"");f?y.push(C):y.push(pe.createElement(pe.Fragment,{key:j},C,pe.createElement("br",null)))}return pe.createElement("span",{className:n,"data-testid":a,"aria-live":"polite","aria-busy":(u=m.enableAnimation)!==null&&u!==void 0?u:Al},t?y.map((j,k)=>pe.createElement(t,{key:k},j)):y)}const Ds=Math.min,os=Math.max,Br=Math.round,Sr=Math.floor,St=r=>({x:r,y:r}),am={left:"right",right:"left",bottom:"top",top:"bottom"},im={start:"end",end:"start"};function In(r,t,s){return os(r,Ds(t,s))}function mr(r,t){return typeof r=="function"?r(t):r}function ds(r){return r.split("-")[0]}function fr(r){return r.split("-")[1]}function Tl(r){return r==="x"?"y":"x"}function oa(r){return r==="y"?"height":"width"}const lm=new Set(["top","bottom"]);function Wt(r){return lm.has(ds(r))?"y":"x"}function ca(r){return Tl(Wt(r))}function om(r,t,s){s===void 0&&(s=!1);const n=fr(r),a=ca(r),i=oa(a);let l=a==="x"?n===(s?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(l=qr(l)),[l,qr(l)]}function cm(r){const t=qr(r);return[Un(r),t,Un(t)]}function Un(r){return r.replace(/start|end/g,t=>im[t])}const hi=["left","right"],mi=["right","left"],dm=["top","bottom"],um=["bottom","top"];function hm(r,t,s){switch(r){case"top":case"bottom":return s?t?mi:hi:t?hi:mi;case"left":case"right":return t?dm:um;default:return[]}}function mm(r,t,s,n){const a=fr(r);let i=hm(ds(r),s==="start",n);return a&&(i=i.map(l=>l+"-"+a),t&&(i=i.concat(i.map(Un)))),i}function qr(r){return r.replace(/left|right|bottom|top/g,t=>am[t])}function fm(r){return{top:0,right:0,bottom:0,left:0,...r}}function Ol(r){return typeof r!="number"?fm(r):{top:r,right:r,bottom:r,left:r}}function Vr(r){const{x:t,y:s,width:n,height:a}=r;return{width:n,height:a,top:s,left:t,right:t+n,bottom:s+a,x:t,y:s}}function fi(r,t,s){let{reference:n,floating:a}=r;const i=Wt(t),l=ca(t),o=oa(l),c=ds(t),d=i==="y",u=n.x+n.width/2-a.width/2,h=n.y+n.height/2-a.height/2,g=n[o]/2-a[o]/2;let m;switch(c){case"top":m={x:u,y:n.y-a.height};break;case"bottom":m={x:u,y:n.y+n.height};break;case"right":m={x:n.x+n.width,y:h};break;case"left":m={x:n.x-a.width,y:h};break;default:m={x:n.x,y:n.y}}switch(fr(t)){case"start":m[l]-=g*(s&&d?-1:1);break;case"end":m[l]+=g*(s&&d?-1:1);break}return m}const xm=async(r,t,s)=>{const{placement:n="bottom",strategy:a="absolute",middleware:i=[],platform:l}=s,o=i.filter(Boolean),c=await(l.isRTL==null?void 0:l.isRTL(t));let d=await l.getElementRects({reference:r,floating:t,strategy:a}),{x:u,y:h}=fi(d,n,c),g=n,m={},v=0;for(let x=0;x<o.length;x++){const{name:f,fn:y}=o[x],{x:w,y:j,data:k,reset:C}=await y({x:u,y:h,initialPlacement:n,placement:g,strategy:a,middlewareData:m,rects:d,platform:l,elements:{reference:r,floating:t}});u=w??u,h=j??h,m={...m,[f]:{...m[f],...k}},C&&v<=50&&(v++,typeof C=="object"&&(C.placement&&(g=C.placement),C.rects&&(d=C.rects===!0?await l.getElementRects({reference:r,floating:t,strategy:a}):C.rects),{x:u,y:h}=fi(d,g,c)),x=-1)}return{x:u,y:h,placement:g,strategy:a,middlewareData:m}};async function Pl(r,t){var s;t===void 0&&(t={});const{x:n,y:a,platform:i,rects:l,elements:o,strategy:c}=r,{boundary:d="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:g=!1,padding:m=0}=mr(t,r),v=Ol(m),f=o[g?h==="floating"?"reference":"floating":h],y=Vr(await i.getClippingRect({element:(s=await(i.isElement==null?void 0:i.isElement(f)))==null||s?f:f.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(o.floating)),boundary:d,rootBoundary:u,strategy:c})),w=h==="floating"?{x:n,y:a,width:l.floating.width,height:l.floating.height}:l.reference,j=await(i.getOffsetParent==null?void 0:i.getOffsetParent(o.floating)),k=await(i.isElement==null?void 0:i.isElement(j))?await(i.getScale==null?void 0:i.getScale(j))||{x:1,y:1}:{x:1,y:1},C=Vr(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:w,offsetParent:j,strategy:c}):w);return{top:(y.top-C.top+v.top)/k.y,bottom:(C.bottom-y.bottom+v.bottom)/k.y,left:(y.left-C.left+v.left)/k.x,right:(C.right-y.right+v.right)/k.x}}const pm=r=>({name:"arrow",options:r,async fn(t){const{x:s,y:n,placement:a,rects:i,platform:l,elements:o,middlewareData:c}=t,{element:d,padding:u=0}=mr(r,t)||{};if(d==null)return{};const h=Ol(u),g={x:s,y:n},m=ca(a),v=oa(m),x=await l.getDimensions(d),f=m==="y",y=f?"top":"left",w=f?"bottom":"right",j=f?"clientHeight":"clientWidth",k=i.reference[v]+i.reference[m]-g[m]-i.floating[v],C=g[m]-i.reference[m],A=await(l.getOffsetParent==null?void 0:l.getOffsetParent(d));let R=A?A[j]:0;(!R||!await(l.isElement==null?void 0:l.isElement(A)))&&(R=o.floating[j]||i.floating[v]);const se=k/2-C/2,K=R/2-x[v]/2-1,T=Ds(h[y],K),q=Ds(h[w],K),E=T,P=R-x[v]-q,O=R/2-x[v]/2+se,H=In(E,O,P),J=!c.arrow&&fr(a)!=null&&O!==H&&i.reference[v]/2-(O<E?T:q)-x[v]/2<0,I=J?O<E?O-E:O-P:0;return{[m]:g[m]+I,data:{[m]:H,centerOffset:O-H-I,...J&&{alignmentOffset:I}},reset:J}}}),gm=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(t){var s,n;const{placement:a,middlewareData:i,rects:l,initialPlacement:o,platform:c,elements:d}=t,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:g,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:x=!0,...f}=mr(r,t);if((s=i.arrow)!=null&&s.alignmentOffset)return{};const y=ds(a),w=Wt(o),j=ds(o)===o,k=await(c.isRTL==null?void 0:c.isRTL(d.floating)),C=g||(j||!x?[qr(o)]:cm(o)),A=v!=="none";!g&&A&&C.push(...mm(o,x,v,k));const R=[o,...C],se=await Pl(t,f),K=[];let T=((n=i.flip)==null?void 0:n.overflows)||[];if(u&&K.push(se[y]),h){const O=om(a,l,k);K.push(se[O[0]],se[O[1]])}if(T=[...T,{placement:a,overflows:K}],!K.every(O=>O<=0)){var q,E;const O=(((q=i.flip)==null?void 0:q.index)||0)+1,H=R[O];if(H&&(!(h==="alignment"?w!==Wt(H):!1)||T.every(V=>V.overflows[0]>0&&Wt(V.placement)===w)))return{data:{index:O,overflows:T},reset:{placement:H}};let J=(E=T.filter(I=>I.overflows[0]<=0).sort((I,V)=>I.overflows[1]-V.overflows[1])[0])==null?void 0:E.placement;if(!J)switch(m){case"bestFit":{var P;const I=(P=T.filter(V=>{if(A){const ie=Wt(V.placement);return ie===w||ie==="y"}return!0}).map(V=>[V.placement,V.overflows.filter(ie=>ie>0).reduce((ie,ye)=>ie+ye,0)]).sort((V,ie)=>V[1]-ie[1])[0])==null?void 0:P[0];I&&(J=I);break}case"initialPlacement":J=o;break}if(a!==J)return{reset:{placement:J}}}return{}}}},ym=new Set(["left","top"]);async function bm(r,t){const{placement:s,platform:n,elements:a}=r,i=await(n.isRTL==null?void 0:n.isRTL(a.floating)),l=ds(s),o=fr(s),c=Wt(s)==="y",d=ym.has(l)?-1:1,u=i&&c?-1:1,h=mr(t,r);let{mainAxis:g,crossAxis:m,alignmentAxis:v}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return o&&typeof v=="number"&&(m=o==="end"?v*-1:v),c?{x:m*u,y:g*d}:{x:g*d,y:m*u}}const vm=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(t){var s,n;const{x:a,y:i,placement:l,middlewareData:o}=t,c=await bm(t,r);return l===((s=o.offset)==null?void 0:s.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:a+c.x,y:i+c.y,data:{...c,placement:l}}}}},jm=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(t){const{x:s,y:n,placement:a}=t,{mainAxis:i=!0,crossAxis:l=!1,limiter:o={fn:f=>{let{x:y,y:w}=f;return{x:y,y:w}}},...c}=mr(r,t),d={x:s,y:n},u=await Pl(t,c),h=Wt(ds(a)),g=Tl(h);let m=d[g],v=d[h];if(i){const f=g==="y"?"top":"left",y=g==="y"?"bottom":"right",w=m+u[f],j=m-u[y];m=In(w,m,j)}if(l){const f=h==="y"?"top":"left",y=h==="y"?"bottom":"right",w=v+u[f],j=v-u[y];v=In(w,v,j)}const x=o.fn({...t,[g]:m,[h]:v});return{...x,data:{x:x.x-s,y:x.y-n,enabled:{[g]:i,[h]:l}}}}}};function sn(){return typeof window<"u"}function Us(r){return $l(r)?(r.nodeName||"").toLowerCase():"#document"}function Xe(r){var t;return(r==null||(t=r.ownerDocument)==null?void 0:t.defaultView)||window}function Et(r){var t;return(t=($l(r)?r.ownerDocument:r.document)||window.document)==null?void 0:t.documentElement}function $l(r){return sn()?r instanceof Node||r instanceof Xe(r).Node:!1}function gt(r){return sn()?r instanceof Element||r instanceof Xe(r).Element:!1}function kt(r){return sn()?r instanceof HTMLElement||r instanceof Xe(r).HTMLElement:!1}function xi(r){return!sn()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Xe(r).ShadowRoot}const wm=new Set(["inline","contents"]);function xr(r){const{overflow:t,overflowX:s,overflowY:n,display:a}=yt(r);return/auto|scroll|overlay|hidden|clip/.test(t+n+s)&&!wm.has(a)}const _m=new Set(["table","td","th"]);function Nm(r){return _m.has(Us(r))}const Sm=[":popover-open",":modal"];function rn(r){return Sm.some(t=>{try{return r.matches(t)}catch{return!1}})}const km=["transform","translate","scale","rotate","perspective"],Em=["transform","translate","scale","rotate","perspective","filter"],Cm=["paint","layout","strict","content"];function da(r){const t=ua(),s=gt(r)?yt(r):r;return km.some(n=>s[n]?s[n]!=="none":!1)||(s.containerType?s.containerType!=="normal":!1)||!t&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!t&&(s.filter?s.filter!=="none":!1)||Em.some(n=>(s.willChange||"").includes(n))||Cm.some(n=>(s.contain||"").includes(n))}function Am(r){let t=Kt(r);for(;kt(t)&&!Ls(t);){if(da(t))return t;if(rn(t))return null;t=Kt(t)}return null}function ua(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Tm=new Set(["html","body","#document"]);function Ls(r){return Tm.has(Us(r))}function yt(r){return Xe(r).getComputedStyle(r)}function nn(r){return gt(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Kt(r){if(Us(r)==="html")return r;const t=r.assignedSlot||r.parentNode||xi(r)&&r.host||Et(r);return xi(t)?t.host:t}function Dl(r){const t=Kt(r);return Ls(t)?r.ownerDocument?r.ownerDocument.body:r.body:kt(t)&&xr(t)?t:Dl(t)}function ir(r,t,s){var n;t===void 0&&(t=[]),s===void 0&&(s=!0);const a=Dl(r),i=a===((n=r.ownerDocument)==null?void 0:n.body),l=Xe(a);if(i){const o=Bn(l);return t.concat(l,l.visualViewport||[],xr(a)?a:[],o&&s?ir(o):[])}return t.concat(a,ir(a,[],s))}function Bn(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function Ll(r){const t=yt(r);let s=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const a=kt(r),i=a?r.offsetWidth:s,l=a?r.offsetHeight:n,o=Br(s)!==i||Br(n)!==l;return o&&(s=i,n=l),{width:s,height:n,$:o}}function ha(r){return gt(r)?r:r.contextElement}function Os(r){const t=ha(r);if(!kt(t))return St(1);const s=t.getBoundingClientRect(),{width:n,height:a,$:i}=Ll(t);let l=(i?Br(s.width):s.width)/n,o=(i?Br(s.height):s.height)/a;return(!l||!Number.isFinite(l))&&(l=1),(!o||!Number.isFinite(o))&&(o=1),{x:l,y:o}}const Om=St(0);function Rl(r){const t=Xe(r);return!ua()||!t.visualViewport?Om:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Pm(r,t,s){return t===void 0&&(t=!1),!s||t&&s!==Xe(r)?!1:t}function us(r,t,s,n){t===void 0&&(t=!1),s===void 0&&(s=!1);const a=r.getBoundingClientRect(),i=ha(r);let l=St(1);t&&(n?gt(n)&&(l=Os(n)):l=Os(r));const o=Pm(i,s,n)?Rl(i):St(0);let c=(a.left+o.x)/l.x,d=(a.top+o.y)/l.y,u=a.width/l.x,h=a.height/l.y;if(i){const g=Xe(i),m=n&&gt(n)?Xe(n):n;let v=g,x=Bn(v);for(;x&&n&&m!==v;){const f=Os(x),y=x.getBoundingClientRect(),w=yt(x),j=y.left+(x.clientLeft+parseFloat(w.paddingLeft))*f.x,k=y.top+(x.clientTop+parseFloat(w.paddingTop))*f.y;c*=f.x,d*=f.y,u*=f.x,h*=f.y,c+=j,d+=k,v=Xe(x),x=Bn(v)}}return Vr({width:u,height:h,x:c,y:d})}function ma(r,t){const s=nn(r).scrollLeft;return t?t.left+s:us(Et(r)).left+s}function Fl(r,t,s){s===void 0&&(s=!1);const n=r.getBoundingClientRect(),a=n.left+t.scrollLeft-(s?0:ma(r,n)),i=n.top+t.scrollTop;return{x:a,y:i}}function $m(r){let{elements:t,rect:s,offsetParent:n,strategy:a}=r;const i=a==="fixed",l=Et(n),o=t?rn(t.floating):!1;if(n===l||o&&i)return s;let c={scrollLeft:0,scrollTop:0},d=St(1);const u=St(0),h=kt(n);if((h||!h&&!i)&&((Us(n)!=="body"||xr(l))&&(c=nn(n)),kt(n))){const m=us(n);d=Os(n),u.x=m.x+n.clientLeft,u.y=m.y+n.clientTop}const g=l&&!h&&!i?Fl(l,c,!0):St(0);return{width:s.width*d.x,height:s.height*d.y,x:s.x*d.x-c.scrollLeft*d.x+u.x+g.x,y:s.y*d.y-c.scrollTop*d.y+u.y+g.y}}function Dm(r){return Array.from(r.getClientRects())}function Lm(r){const t=Et(r),s=nn(r),n=r.ownerDocument.body,a=os(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),i=os(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let l=-s.scrollLeft+ma(r);const o=-s.scrollTop;return yt(n).direction==="rtl"&&(l+=os(t.clientWidth,n.clientWidth)-a),{width:a,height:i,x:l,y:o}}function Rm(r,t){const s=Xe(r),n=Et(r),a=s.visualViewport;let i=n.clientWidth,l=n.clientHeight,o=0,c=0;if(a){i=a.width,l=a.height;const d=ua();(!d||d&&t==="fixed")&&(o=a.offsetLeft,c=a.offsetTop)}return{width:i,height:l,x:o,y:c}}const Fm=new Set(["absolute","fixed"]);function Im(r,t){const s=us(r,!0,t==="fixed"),n=s.top+r.clientTop,a=s.left+r.clientLeft,i=kt(r)?Os(r):St(1),l=r.clientWidth*i.x,o=r.clientHeight*i.y,c=a*i.x,d=n*i.y;return{width:l,height:o,x:c,y:d}}function pi(r,t,s){let n;if(t==="viewport")n=Rm(r,s);else if(t==="document")n=Lm(Et(r));else if(gt(t))n=Im(t,s);else{const a=Rl(r);n={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return Vr(n)}function Il(r,t){const s=Kt(r);return s===t||!gt(s)||Ls(s)?!1:yt(s).position==="fixed"||Il(s,t)}function Um(r,t){const s=t.get(r);if(s)return s;let n=ir(r,[],!1).filter(o=>gt(o)&&Us(o)!=="body"),a=null;const i=yt(r).position==="fixed";let l=i?Kt(r):r;for(;gt(l)&&!Ls(l);){const o=yt(l),c=da(l);!c&&o.position==="fixed"&&(a=null),(i?!c&&!a:!c&&o.position==="static"&&!!a&&Fm.has(a.position)||xr(l)&&!c&&Il(r,l))?n=n.filter(u=>u!==l):a=o,l=Kt(l)}return t.set(r,n),n}function Bm(r){let{element:t,boundary:s,rootBoundary:n,strategy:a}=r;const l=[...s==="clippingAncestors"?rn(t)?[]:Um(t,this._c):[].concat(s),n],o=l[0],c=l.reduce((d,u)=>{const h=pi(t,u,a);return d.top=os(h.top,d.top),d.right=Ds(h.right,d.right),d.bottom=Ds(h.bottom,d.bottom),d.left=os(h.left,d.left),d},pi(t,o,a));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function qm(r){const{width:t,height:s}=Ll(r);return{width:t,height:s}}function Vm(r,t,s){const n=kt(t),a=Et(t),i=s==="fixed",l=us(r,!0,i,t);let o={scrollLeft:0,scrollTop:0};const c=St(0);function d(){c.x=ma(a)}if(n||!n&&!i)if((Us(t)!=="body"||xr(a))&&(o=nn(t)),n){const m=us(t,!0,i,t);c.x=m.x+t.clientLeft,c.y=m.y+t.clientTop}else a&&d();i&&!n&&a&&d();const u=a&&!n&&!i?Fl(a,o):St(0),h=l.left+o.scrollLeft-c.x-u.x,g=l.top+o.scrollTop-c.y-u.y;return{x:h,y:g,width:l.width,height:l.height}}function bn(r){return yt(r).position==="static"}function gi(r,t){if(!kt(r)||yt(r).position==="fixed")return null;if(t)return t(r);let s=r.offsetParent;return Et(r)===s&&(s=s.ownerDocument.body),s}function Ul(r,t){const s=Xe(r);if(rn(r))return s;if(!kt(r)){let a=Kt(r);for(;a&&!Ls(a);){if(gt(a)&&!bn(a))return a;a=Kt(a)}return s}let n=gi(r,t);for(;n&&Nm(n)&&bn(n);)n=gi(n,t);return n&&Ls(n)&&bn(n)&&!da(n)?s:n||Am(r)||s}const Mm=async function(r){const t=this.getOffsetParent||Ul,s=this.getDimensions,n=await s(r.floating);return{reference:Vm(r.reference,await t(r.floating),r.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function zm(r){return yt(r).direction==="rtl"}const Wm={convertOffsetParentRelativeRectToViewportRelativeRect:$m,getDocumentElement:Et,getClippingRect:Bm,getOffsetParent:Ul,getElementRects:Mm,getClientRects:Dm,getDimensions:qm,getScale:Os,isElement:gt,isRTL:zm};function Bl(r,t){return r.x===t.x&&r.y===t.y&&r.width===t.width&&r.height===t.height}function Hm(r,t){let s=null,n;const a=Et(r);function i(){var o;clearTimeout(n),(o=s)==null||o.disconnect(),s=null}function l(o,c){o===void 0&&(o=!1),c===void 0&&(c=1),i();const d=r.getBoundingClientRect(),{left:u,top:h,width:g,height:m}=d;if(o||t(),!g||!m)return;const v=Sr(h),x=Sr(a.clientWidth-(u+g)),f=Sr(a.clientHeight-(h+m)),y=Sr(u),j={rootMargin:-v+"px "+-x+"px "+-f+"px "+-y+"px",threshold:os(0,Ds(1,c))||1};let k=!0;function C(A){const R=A[0].intersectionRatio;if(R!==c){if(!k)return l();R?l(!1,R):n=setTimeout(()=>{l(!1,1e-7)},1e3)}R===1&&!Bl(d,r.getBoundingClientRect())&&l(),k=!1}try{s=new IntersectionObserver(C,{...j,root:a.ownerDocument})}catch{s=new IntersectionObserver(C,j)}s.observe(r)}return l(!0),i}function Gm(r,t,s,n){n===void 0&&(n={});const{ancestorScroll:a=!0,ancestorResize:i=!0,elementResize:l=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:c=!1}=n,d=ha(r),u=a||i?[...d?ir(d):[],...ir(t)]:[];u.forEach(y=>{a&&y.addEventListener("scroll",s,{passive:!0}),i&&y.addEventListener("resize",s)});const h=d&&o?Hm(d,s):null;let g=-1,m=null;l&&(m=new ResizeObserver(y=>{let[w]=y;w&&w.target===d&&m&&(m.unobserve(t),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var j;(j=m)==null||j.observe(t)})),s()}),d&&!c&&m.observe(d),m.observe(t));let v,x=c?us(r):null;c&&f();function f(){const y=us(r);x&&!Bl(x,y)&&s(),x=y,v=requestAnimationFrame(f)}return s(),()=>{var y;u.forEach(w=>{a&&w.removeEventListener("scroll",s),i&&w.removeEventListener("resize",s)}),h==null||h(),(y=m)==null||y.disconnect(),m=null,c&&cancelAnimationFrame(v)}}const Km=vm,Jm=jm,Zm=gm,Qm=pm,yi=(r,t,s)=>{const n=new Map,a={platform:Wm,...s},i={...a.platform,_c:n};return xm(r,t,{...a,platform:i})};var ql={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(r){(function(){var t={}.hasOwnProperty;function s(){for(var i="",l=0;l<arguments.length;l++){var o=arguments[l];o&&(i=a(i,n(o)))}return i}function n(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return s.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var l="";for(var o in i)t.call(i,o)&&i[o]&&(l=a(l,o));return l}function a(i,l){return l?i?i+" "+l:i+l:i}r.exports?(s.default=s,r.exports=s):window.classNames=s})()})(ql);var Ym=ql.exports;const qn=Ai(Ym);var bi={};const Xm="react-tooltip-core-styles",ef="react-tooltip-base-styles",vi={core:!1,base:!1};function ji({css:r,id:t=ef,type:s="base",ref:n}){var a,i;if(!r||typeof document>"u"||vi[s]||s==="core"&&typeof process<"u"&&(!((a=process==null?void 0:bi)===null||a===void 0)&&a.REACT_TOOLTIP_DISABLE_CORE_STYLES)||s!=="base"&&typeof process<"u"&&(!((i=process==null?void 0:bi)===null||i===void 0)&&i.REACT_TOOLTIP_DISABLE_BASE_STYLES))return;s==="core"&&(t=Xm),n||(n={});const{insertAt:l}=n;if(document.getElementById(t))return;const o=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.id=t,c.type="text/css",l==="top"&&o.firstChild?o.insertBefore(c,o.firstChild):o.appendChild(c),c.styleSheet?c.styleSheet.cssText=r:c.appendChild(document.createTextNode(r)),vi[s]=!0}const wi=async({elementReference:r=null,tooltipReference:t=null,tooltipArrowReference:s=null,place:n="top",offset:a=10,strategy:i="absolute",middlewares:l=[Km(Number(a)),Zm({fallbackAxisSideDirection:"start"}),Jm({padding:5})],border:o,arrowSize:c=8})=>{if(!r)return{tooltipStyles:{},tooltipArrowStyles:{},place:n};if(t===null)return{tooltipStyles:{},tooltipArrowStyles:{},place:n};const d=l;return s?(d.push(Qm({element:s,padding:5})),yi(r,t,{placement:n,strategy:i,middleware:d}).then(({x:u,y:h,placement:g,middlewareData:m})=>{var v,x;const f={left:`${u}px`,top:`${h}px`,border:o},{x:y,y:w}=(v=m.arrow)!==null&&v!==void 0?v:{x:0,y:0},j=(x={top:"bottom",right:"left",bottom:"top",left:"right"}[g.split("-")[0]])!==null&&x!==void 0?x:"bottom",k=o&&{borderBottom:o,borderRight:o};let C=0;if(o){const A=`${o}`.match(/(\d+)px/);C=A!=null&&A[1]?Number(A[1]):1}return{tooltipStyles:f,tooltipArrowStyles:{left:y!=null?`${y}px`:"",top:w!=null?`${w}px`:"",right:"",bottom:"",...k,[j]:`-${c/2+C}px`},place:g}})):yi(r,t,{placement:"bottom",strategy:i,middleware:d}).then(({x:u,y:h,placement:g})=>({tooltipStyles:{left:`${u}px`,top:`${h}px`},tooltipArrowStyles:{},place:g}))},_i=(r,t)=>!("CSS"in window&&"supports"in window.CSS)||window.CSS.supports(r,t),Ni=(r,t,s)=>{let n=null;const a=function(...i){const l=()=>{n=null};!n&&(r.apply(this,i),n=setTimeout(l,t))};return a.cancel=()=>{n&&(clearTimeout(n),n=null)},a},Si=r=>r!==null&&!Array.isArray(r)&&typeof r=="object",Vn=(r,t)=>{if(r===t)return!0;if(Array.isArray(r)&&Array.isArray(t))return r.length===t.length&&r.every((a,i)=>Vn(a,t[i]));if(Array.isArray(r)!==Array.isArray(t))return!1;if(!Si(r)||!Si(t))return r===t;const s=Object.keys(r),n=Object.keys(t);return s.length===n.length&&s.every(a=>Vn(r[a],t[a]))},tf=r=>{if(!(r instanceof HTMLElement||r instanceof SVGElement))return!1;const t=getComputedStyle(r);return["overflow","overflow-x","overflow-y"].some(s=>{const n=t.getPropertyValue(s);return n==="auto"||n==="scroll"})},ki=r=>{if(!r)return null;let t=r.parentElement;for(;t;){if(tf(t))return t;t=t.parentElement}return document.scrollingElement||document.documentElement},sf=typeof window<"u"?b.useLayoutEffect:b.useEffect,rt=r=>{r.current&&(clearTimeout(r.current),r.current=null)},rf="DEFAULT_TOOLTIP_ID",nf={anchorRefs:new Set,activeAnchor:{current:null},attach:()=>{},detach:()=>{},setActiveAnchor:()=>{}},af=b.createContext({getTooltipData:()=>nf});function Vl(r=rf){return b.useContext(af).getTooltipData(r)}var ks={tooltip:"core-styles-module_tooltip__3vRRp",fixed:"core-styles-module_fixed__pcSol",arrow:"core-styles-module_arrow__cvMwQ",noArrow:"core-styles-module_noArrow__xock6",clickable:"core-styles-module_clickable__ZuTTB",show:"core-styles-module_show__Nt9eE",closing:"core-styles-module_closing__sGnxF"},vn={tooltip:"styles-module_tooltip__mnnfp",arrow:"styles-module_arrow__K0L3T",dark:"styles-module_dark__xNqje",light:"styles-module_light__Z6W-X",success:"styles-module_success__A2AKt",warning:"styles-module_warning__SCK0X",error:"styles-module_error__JvumD",info:"styles-module_info__BWdHW"};const lf=({forwardRef:r,id:t,className:s,classNameArrow:n,variant:a="dark",anchorId:i,anchorSelect:l,place:o="top",offset:c=10,events:d=["hover"],openOnClick:u=!1,positionStrategy:h="absolute",middlewares:g,wrapper:m,delayShow:v=0,delayHide:x=0,float:f=!1,hidden:y=!1,noArrow:w=!1,clickable:j=!1,closeOnEsc:k=!1,closeOnScroll:C=!1,closeOnResize:A=!1,openEvents:R,closeEvents:se,globalCloseEvents:K,imperativeModeOnly:T,style:q,position:E,afterShow:P,afterHide:O,disableTooltip:H,content:J,contentWrapperRef:I,isOpen:V,defaultIsOpen:ie=!1,setIsOpen:ye,activeAnchor:me,setActiveAnchor:Ee,border:Me,opacity:B,arrowColor:G,arrowSize:Y=8,role:Z="tooltip"})=>{var ce;const ue=b.useRef(null),Qe=b.useRef(null),Re=b.useRef(null),ze=b.useRef(null),bt=b.useRef(null),[We,Ct]=b.useState({tooltipStyles:{},tooltipArrowStyles:{},place:o}),[Te,S]=b.useState(!1),[U,Q]=b.useState(!1),[p,_]=b.useState(null),N=b.useRef(!1),F=b.useRef(null),{anchorRefs:$,setActiveAnchor:D}=Vl(t),z=b.useRef(!1),[re,he]=b.useState([]),Se=b.useRef(!1),ot=u||d.includes("click"),et=ot||(R==null?void 0:R.click)||(R==null?void 0:R.dblclick)||(R==null?void 0:R.mousedown),It=R?{...R}:{mouseover:!0,focus:!0,mouseenter:!1,click:!1,dblclick:!1,mousedown:!1};!R&&ot&&Object.assign(It,{mouseenter:!1,focus:!1,mouseover:!1,click:!0});const ct=se?{...se}:{mouseout:!0,blur:!0,mouseleave:!1,click:!1,dblclick:!1,mouseup:!1};!se&&ot&&Object.assign(ct,{mouseleave:!1,blur:!1,mouseout:!1});const Ue=K?{...K}:{escape:k||!1,scroll:C||!1,resize:A||!1,clickOutsideAnchor:et||!1};T&&(Object.assign(It,{mouseover:!1,focus:!1,mouseenter:!1,click:!1,dblclick:!1,mousedown:!1}),Object.assign(ct,{mouseout:!1,blur:!1,mouseleave:!1,click:!1,dblclick:!1,mouseup:!1}),Object.assign(Ue,{escape:!1,scroll:!1,resize:!1,clickOutsideAnchor:!1})),sf(()=>(Se.current=!0,()=>{Se.current=!1}),[]);const je=M=>{Se.current&&(M&&Q(!0),setTimeout(()=>{Se.current&&(ye==null||ye(M),V===void 0&&S(M))},10))};b.useEffect(()=>{if(V===void 0)return()=>null;V&&Q(!0);const M=setTimeout(()=>{S(V)},10);return()=>{clearTimeout(M)}},[V]),b.useEffect(()=>{if(Te!==N.current)if(rt(bt),N.current=Te,Te)P==null||P();else{const M=(te=>{const ne=te.match(/^([\d.]+)(ms|s)$/);if(!ne)return 0;const[,Ce,Fe]=ne;return Number(Ce)*(Fe==="ms"?1:1e3)})(getComputedStyle(document.body).getPropertyValue("--rt-transition-show-delay"));bt.current=setTimeout(()=>{Q(!1),_(null),O==null||O()},M+25)}},[Te]);const Yt=M=>{Ct(te=>Vn(te,M)?te:M)},Xt=(M=v)=>{rt(Re),U?je(!0):Re.current=setTimeout(()=>{je(!0)},M)},At=(M=x)=>{rt(ze),ze.current=setTimeout(()=>{z.current||je(!1)},M)},Bs=M=>{var te;if(!M)return;const ne=(te=M.currentTarget)!==null&&te!==void 0?te:M.target;if(!(ne!=null&&ne.isConnected))return Ee(null),void D({current:null});v?Xt():je(!0),Ee(ne),D({current:ne}),rt(ze)},ps=()=>{j?At(x||100):x?At():je(!1),rt(Re)},gs=({x:M,y:te})=>{var ne;const Ce={getBoundingClientRect:()=>({x:M,y:te,width:0,height:0,top:te,left:M,right:M,bottom:te})};wi({place:(ne=p==null?void 0:p.place)!==null&&ne!==void 0?ne:o,offset:c,elementReference:Ce,tooltipReference:ue.current,tooltipArrowReference:Qe.current,strategy:h,middlewares:g,border:Me,arrowSize:Y}).then(Fe=>{Yt(Fe)})},ys=M=>{if(!M)return;const te=M,ne={x:te.clientX,y:te.clientY};gs(ne),F.current=ne},qs=M=>{var te;if(!Te)return;const ne=M.target;ne.isConnected&&(!((te=ue.current)===null||te===void 0)&&te.contains(ne)||[document.querySelector(`[id='${i}']`),...re].some(Ce=>Ce==null?void 0:Ce.contains(ne))||(je(!1),rt(Re)))},pr=Ni(Bs,50),Oe=Ni(ps,50),tt=M=>{Oe.cancel(),pr(M)},X=()=>{pr.cancel(),Oe()},de=b.useCallback(()=>{var M,te;const ne=(M=p==null?void 0:p.position)!==null&&M!==void 0?M:E;ne?gs(ne):f?F.current&&gs(F.current):me!=null&&me.isConnected&&wi({place:(te=p==null?void 0:p.place)!==null&&te!==void 0?te:o,offset:c,elementReference:me,tooltipReference:ue.current,tooltipArrowReference:Qe.current,strategy:h,middlewares:g,border:Me,arrowSize:Y}).then(Ce=>{Se.current&&Yt(Ce)})},[Te,me,J,q,o,p==null?void 0:p.place,c,h,E,p==null?void 0:p.position,f,Y]);b.useEffect(()=>{var M,te;const ne=new Set($);re.forEach(fe=>{H!=null&&H(fe)||ne.add({current:fe})});const Ce=document.querySelector(`[id='${i}']`);Ce&&!(H!=null&&H(Ce))&&ne.add({current:Ce});const Fe=()=>{je(!1)},vt=ki(me),jt=ki(ue.current);Ue.scroll&&(window.addEventListener("scroll",Fe),vt==null||vt.addEventListener("scroll",Fe),jt==null||jt.addEventListener("scroll",Fe));let Be=null;Ue.resize?window.addEventListener("resize",Fe):me&&ue.current&&(Be=Gm(me,ue.current,de,{ancestorResize:!0,elementResize:!0,layoutShift:!0}));const st=fe=>{fe.key==="Escape"&&je(!1)};Ue.escape&&window.addEventListener("keydown",st),Ue.clickOutsideAnchor&&window.addEventListener("click",qs);const be=[],bs=fe=>!!(fe!=null&&fe.target&&(me!=null&&me.contains(fe.target))),Ml=fe=>{Te&&bs(fe)||Bs(fe)},zl=fe=>{Te&&bs(fe)&&ps()},fa=["mouseover","mouseout","mouseenter","mouseleave","focus","blur"],xa=["click","dblclick","mousedown","mouseup"];Object.entries(It).forEach(([fe,Tt])=>{Tt&&(fa.includes(fe)?be.push({event:fe,listener:tt}):xa.includes(fe)&&be.push({event:fe,listener:Ml}))}),Object.entries(ct).forEach(([fe,Tt])=>{Tt&&(fa.includes(fe)?be.push({event:fe,listener:X}):xa.includes(fe)&&be.push({event:fe,listener:zl}))}),f&&be.push({event:"pointermove",listener:ys});const pa=()=>{z.current=!0},ga=()=>{z.current=!1,ps()},ya=j&&(ct.mouseout||ct.mouseleave);return ya&&((M=ue.current)===null||M===void 0||M.addEventListener("mouseover",pa),(te=ue.current)===null||te===void 0||te.addEventListener("mouseout",ga)),be.forEach(({event:fe,listener:Tt})=>{ne.forEach(an=>{var Vs;(Vs=an.current)===null||Vs===void 0||Vs.addEventListener(fe,Tt)})}),()=>{var fe,Tt;Ue.scroll&&(window.removeEventListener("scroll",Fe),vt==null||vt.removeEventListener("scroll",Fe),jt==null||jt.removeEventListener("scroll",Fe)),Ue.resize?window.removeEventListener("resize",Fe):Be==null||Be(),Ue.clickOutsideAnchor&&window.removeEventListener("click",qs),Ue.escape&&window.removeEventListener("keydown",st),ya&&((fe=ue.current)===null||fe===void 0||fe.removeEventListener("mouseover",pa),(Tt=ue.current)===null||Tt===void 0||Tt.removeEventListener("mouseout",ga)),be.forEach(({event:an,listener:Vs})=>{ne.forEach(Wl=>{var ln;(ln=Wl.current)===null||ln===void 0||ln.removeEventListener(an,Vs)})})}},[me,de,U,$,re,R,se,K,ot,v,x]),b.useEffect(()=>{var M,te;let ne=(te=(M=p==null?void 0:p.anchorSelect)!==null&&M!==void 0?M:l)!==null&&te!==void 0?te:"";!ne&&t&&(ne=`[data-tooltip-id='${t.replace(/'/g,"\\'")}']`);const Ce=new MutationObserver(Fe=>{const vt=[],jt=[];Fe.forEach(Be=>{if(Be.type==="attributes"&&Be.attributeName==="data-tooltip-id"&&(Be.target.getAttribute("data-tooltip-id")===t?vt.push(Be.target):Be.oldValue===t&&jt.push(Be.target)),Be.type==="childList"){if(me){const st=[...Be.removedNodes].filter(be=>be.nodeType===1);if(ne)try{jt.push(...st.filter(be=>be.matches(ne))),jt.push(...st.flatMap(be=>[...be.querySelectorAll(ne)]))}catch{}st.some(be=>{var bs;return!!(!((bs=be==null?void 0:be.contains)===null||bs===void 0)&&bs.call(be,me))&&(Q(!1),je(!1),Ee(null),rt(Re),rt(ze),!0)})}if(ne)try{const st=[...Be.addedNodes].filter(be=>be.nodeType===1);vt.push(...st.filter(be=>be.matches(ne))),vt.push(...st.flatMap(be=>[...be.querySelectorAll(ne)]))}catch{}}}),(vt.length||jt.length)&&he(Be=>[...Be.filter(st=>!jt.includes(st)),...vt])});return Ce.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-tooltip-id"],attributeOldValue:!0}),()=>{Ce.disconnect()}},[t,l,p==null?void 0:p.anchorSelect,me]),b.useEffect(()=>{de()},[de]),b.useEffect(()=>{if(!(I!=null&&I.current))return()=>null;const M=new ResizeObserver(()=>{setTimeout(()=>de())});return M.observe(I.current),()=>{M.disconnect()}},[J,I==null?void 0:I.current]),b.useEffect(()=>{var M;const te=document.querySelector(`[id='${i}']`),ne=[...re,te];me&&ne.includes(me)||Ee((M=re[0])!==null&&M!==void 0?M:te)},[i,re,me]),b.useEffect(()=>(ie&&je(!0),()=>{rt(Re),rt(ze)}),[]),b.useEffect(()=>{var M;let te=(M=p==null?void 0:p.anchorSelect)!==null&&M!==void 0?M:l;if(!te&&t&&(te=`[data-tooltip-id='${t.replace(/'/g,"\\'")}']`),te)try{const ne=Array.from(document.querySelectorAll(te));he(ne)}catch{he([])}},[t,l,p==null?void 0:p.anchorSelect]),b.useEffect(()=>{Re.current&&(rt(Re),Xt(v))},[v]);const Ye=(ce=p==null?void 0:p.content)!==null&&ce!==void 0?ce:J,es=Te&&Object.keys(We.tooltipStyles).length>0;return b.useImperativeHandle(r,()=>({open:M=>{if(M!=null&&M.anchorSelect)try{document.querySelector(M.anchorSelect)}catch{return void console.warn(`[react-tooltip] "${M.anchorSelect}" is not a valid CSS selector`)}_(M??null),M!=null&&M.delay?Xt(M.delay):je(!0)},close:M=>{M!=null&&M.delay?At(M.delay):je(!1)},activeAnchor:me,place:We.place,isOpen:!!(U&&!y&&Ye&&es)})),U&&!y&&Ye?pe.createElement(m,{id:t,role:Z,className:qn("react-tooltip",ks.tooltip,vn.tooltip,vn[a],s,`react-tooltip__place-${We.place}`,ks[es?"show":"closing"],es?"react-tooltip__show":"react-tooltip__closing",h==="fixed"&&ks.fixed,j&&ks.clickable),onTransitionEnd:M=>{rt(bt),Te||M.propertyName!=="opacity"||(Q(!1),_(null),O==null||O())},style:{...q,...We.tooltipStyles,opacity:B!==void 0&&es?B:void 0},ref:ue},Ye,pe.createElement(m,{className:qn("react-tooltip-arrow",ks.arrow,vn.arrow,n,w&&ks.noArrow),style:{...We.tooltipArrowStyles,background:G?`linear-gradient(to right bottom, transparent 50%, ${G} 50%)`:void 0,"--rt-arrow-size":`${Y}px`},ref:Qe})):null},of=({content:r})=>pe.createElement("span",{dangerouslySetInnerHTML:{__html:r}}),lr=pe.forwardRef(({id:r,anchorId:t,anchorSelect:s,content:n,html:a,render:i,className:l,classNameArrow:o,variant:c="dark",place:d="top",offset:u=10,wrapper:h="div",children:g=null,events:m=["hover"],openOnClick:v=!1,positionStrategy:x="absolute",middlewares:f,delayShow:y=0,delayHide:w=0,float:j=!1,hidden:k=!1,noArrow:C=!1,clickable:A=!1,closeOnEsc:R=!1,closeOnScroll:se=!1,closeOnResize:K=!1,openEvents:T,closeEvents:q,globalCloseEvents:E,imperativeModeOnly:P=!1,style:O,position:H,isOpen:J,defaultIsOpen:I=!1,disableStyleInjection:V=!1,border:ie,opacity:ye,arrowColor:me,arrowSize:Ee,setIsOpen:Me,afterShow:B,afterHide:G,disableTooltip:Y,role:Z="tooltip"},ce)=>{const[ue,Qe]=b.useState(n),[Re,ze]=b.useState(a),[bt,We]=b.useState(d),[Ct,Te]=b.useState(c),[S,U]=b.useState(u),[Q,p]=b.useState(y),[_,N]=b.useState(w),[F,$]=b.useState(j),[D,z]=b.useState(k),[re,he]=b.useState(h),[Se,ot]=b.useState(m),[et,It]=b.useState(x),[ct,Ue]=b.useState(null),[je,Yt]=b.useState(null),Xt=b.useRef(V),{anchorRefs:At,activeAnchor:Bs}=Vl(r),ps=Oe=>Oe==null?void 0:Oe.getAttributeNames().reduce((tt,X)=>{var de;return X.startsWith("data-tooltip-")&&(tt[X.replace(/^data-tooltip-/,"")]=(de=Oe==null?void 0:Oe.getAttribute(X))!==null&&de!==void 0?de:null),tt},{}),gs=Oe=>{const tt={place:X=>{var de;We((de=X)!==null&&de!==void 0?de:d)},content:X=>{Qe(X??n)},html:X=>{ze(X??a)},variant:X=>{var de;Te((de=X)!==null&&de!==void 0?de:c)},offset:X=>{U(X===null?u:Number(X))},wrapper:X=>{var de;he((de=X)!==null&&de!==void 0?de:h)},events:X=>{const de=X==null?void 0:X.split(" ");ot(de??m)},"position-strategy":X=>{var de;It((de=X)!==null&&de!==void 0?de:x)},"delay-show":X=>{p(X===null?y:Number(X))},"delay-hide":X=>{N(X===null?w:Number(X))},float:X=>{$(X===null?j:X==="true")},hidden:X=>{z(X===null?k:X==="true")},"class-name":X=>{Ue(X)}};Object.values(tt).forEach(X=>X(null)),Object.entries(Oe).forEach(([X,de])=>{var Ye;(Ye=tt[X])===null||Ye===void 0||Ye.call(tt,de)})};b.useEffect(()=>{Qe(n)},[n]),b.useEffect(()=>{ze(a)},[a]),b.useEffect(()=>{We(d)},[d]),b.useEffect(()=>{Te(c)},[c]),b.useEffect(()=>{U(u)},[u]),b.useEffect(()=>{p(y)},[y]),b.useEffect(()=>{N(w)},[w]),b.useEffect(()=>{$(j)},[j]),b.useEffect(()=>{z(k)},[k]),b.useEffect(()=>{It(x)},[x]),b.useEffect(()=>{Xt.current!==V&&console.warn("[react-tooltip] Do not change `disableStyleInjection` dynamically.")},[V]),b.useEffect(()=>{typeof window<"u"&&window.dispatchEvent(new CustomEvent("react-tooltip-inject-styles",{detail:{disableCore:V==="core",disableBase:V}}))},[]),b.useEffect(()=>{var Oe;const tt=new Set(At);let X=s;if(!X&&r&&(X=`[data-tooltip-id='${r.replace(/'/g,"\\'")}']`),X)try{document.querySelectorAll(X).forEach(te=>{tt.add({current:te})})}catch{console.warn(`[react-tooltip] "${X}" is not a valid CSS selector`)}const de=document.querySelector(`[id='${t}']`);if(de&&tt.add({current:de}),!tt.size)return()=>null;const Ye=(Oe=je??de)!==null&&Oe!==void 0?Oe:Bs.current,es=new MutationObserver(te=>{te.forEach(ne=>{var Ce;if(!Ye||ne.type!=="attributes"||!(!((Ce=ne.attributeName)===null||Ce===void 0)&&Ce.startsWith("data-tooltip-")))return;const Fe=ps(Ye);gs(Fe)})}),M={attributes:!0,childList:!1,subtree:!1};if(Ye){const te=ps(Ye);gs(te),es.observe(Ye,M)}return()=>{es.disconnect()}},[At,Bs,je,t,s]),b.useEffect(()=>{O!=null&&O.border&&console.warn("[react-tooltip] Do not set `style.border`. Use `border` prop instead."),ie&&!_i("border",`${ie}`)&&console.warn(`[react-tooltip] "${ie}" is not a valid \`border\`.`),O!=null&&O.opacity&&console.warn("[react-tooltip] Do not set `style.opacity`. Use `opacity` prop instead."),ye&&!_i("opacity",`${ye}`)&&console.warn(`[react-tooltip] "${ye}" is not a valid \`opacity\`.`)},[]);let ys=g;const qs=b.useRef(null);if(i){const Oe=i({content:(je==null?void 0:je.getAttribute("data-tooltip-content"))||ue||null,activeAnchor:je});ys=Oe?pe.createElement("div",{ref:qs,className:"react-tooltip-content-wrapper"},Oe):null}else ue&&(ys=ue);Re&&(ys=pe.createElement(of,{content:Re}));const pr={forwardRef:ce,id:r,anchorId:t,anchorSelect:s,className:qn(l,ct),classNameArrow:o,content:ys,contentWrapperRef:qs,place:bt,variant:Ct,offset:S,wrapper:re,events:Se,openOnClick:v,positionStrategy:et,middlewares:f,delayShow:Q,delayHide:_,float:F,hidden:D,noArrow:C,clickable:A,closeOnEsc:R,closeOnScroll:se,closeOnResize:K,openEvents:T,closeEvents:q,globalCloseEvents:E,imperativeModeOnly:P,style:O,position:H,isOpen:J,defaultIsOpen:I,border:ie,opacity:ye,arrowColor:me,arrowSize:Ee,setIsOpen:Me,afterShow:B,afterHide:G,disableTooltip:Y,activeAnchor:je,setActiveAnchor:Oe=>Yt(Oe),role:Z};return pe.createElement(lf,{...pr})});typeof window<"u"&&window.addEventListener("react-tooltip-inject-styles",r=>{r.detail.disableCore||ji({css:":root{--rt-color-white:#fff;--rt-color-dark:#222;--rt-color-success:#8dc572;--rt-color-error:#be6464;--rt-color-warning:#f0ad4e;--rt-color-info:#337ab7;--rt-opacity:0.9;--rt-transition-show-delay:0.15s;--rt-transition-closing-delay:0.15s;--rt-arrow-size:8px}.core-styles-module_tooltip__3vRRp{position:absolute;top:0;left:0;pointer-events:none;opacity:0;will-change:opacity}.core-styles-module_fixed__pcSol{position:fixed}.core-styles-module_arrow__cvMwQ{position:absolute;background:inherit;z-index:-1}.core-styles-module_noArrow__xock6{display:none}.core-styles-module_clickable__ZuTTB{pointer-events:auto}.core-styles-module_show__Nt9eE{opacity:var(--rt-opacity);transition:opacity var(--rt-transition-show-delay)ease-out}.core-styles-module_closing__sGnxF{opacity:0;transition:opacity var(--rt-transition-closing-delay)ease-in}",type:"core"}),r.detail.disableBase||ji({css:`
.styles-module_tooltip__mnnfp{padding:8px 16px;border-radius:3px;font-size:90%;width:max-content}.styles-module_arrow__K0L3T{width:var(--rt-arrow-size);height:var(--rt-arrow-size)}[class*='react-tooltip__place-top']>.styles-module_arrow__K0L3T{transform:rotate(45deg)}[class*='react-tooltip__place-right']>.styles-module_arrow__K0L3T{transform:rotate(135deg)}[class*='react-tooltip__place-bottom']>.styles-module_arrow__K0L3T{transform:rotate(225deg)}[class*='react-tooltip__place-left']>.styles-module_arrow__K0L3T{transform:rotate(315deg)}.styles-module_dark__xNqje{background:var(--rt-color-dark);color:var(--rt-color-white)}.styles-module_light__Z6W-X{background-color:var(--rt-color-white);color:var(--rt-color-dark)}.styles-module_success__A2AKt{background-color:var(--rt-color-success);color:var(--rt-color-white)}.styles-module_warning__SCK0X{background-color:var(--rt-color-warning);color:var(--rt-color-white)}.styles-module_error__JvumD{background-color:var(--rt-color-error);color:var(--rt-color-white)}.styles-module_info__BWdHW{background-color:var(--rt-color-info);color:var(--rt-color-white)}`,type:"base"})});const cf=tn().shape({indentNumber:ut().required("Indent number is required").matches(/^\w+$/,"Invalid indent number format")}),df=()=>{var q,E,P,O,H,J;const r=Jt(),{user:t}=$e(),[s,n]=b.useState(null),[a,i]=b.useState(!1),[l,o]=b.useState(!1),[c,d]=b.useState([]),[u,h]=b.useState(!1),[g,m]=b.useState(!1),[v,x]=b.useState("all"),[f,y]=b.useState(""),{register:w,handleSubmit:j,formState:{errors:k},setValue:C}=ea({resolver:ta(cf),defaultValues:{indentNumber:""}}),A=async I=>{var ie,ye,me;const V=I.indentNumber.trim();try{i(!0),n(null),o(!1);const Ee=await ee.get("/contract/search",{params:{indent_number:V}});n(Ee.data.data.procurement),o(!0),Ee.data.data.procurement&&L.success("Procurement details found")}catch(Ee){console.error("Error searching procurement:",Ee),o(!0),((ie=Ee.response)==null?void 0:ie.status)===404?L.error("No procurement found for this indent number"):L.error(((me=(ye=Ee.response)==null?void 0:ye.data)==null?void 0:me.message)||"Failed to search procurement")}finally{i(!1)}},R=async()=>{try{h(!0);const I=await ee.get("/contract/indent-status");d(I.data.data.indent_status)}catch(I){console.error("Error fetching indent status:",I),L.error("Failed to fetch indent status")}finally{h(!1)}};b.useEffect(()=>{R()},[]);const se=()=>{r("/contract/upload",{state:{procurement:s,indentNumber:s.indent_number}})},K=I=>{const V=c.find(ie=>ie.indent_number===I);V&&r("/contract/upload",{state:{procurement:{indent_number:V.indent_number,firm_name:V.firm_name,bale_quantity:V.bale_quantity,total_amount:V.total_amount,allocation:{branch_information:{branch_name:V.branch_name,branch_code:V.branch_code}}},indentNumber:V.indent_number}})},T=c.filter(I=>{if(v!=="all"){if(v==="pending"){if(I.contract_status!=="pending")return!1}else if(v==="uploaded"&&I.contract_status==="pending")return!1}if(f){const V=f.toLowerCase();return I.indent_number.toLowerCase().includes(V)||I.firm_name.toLowerCase().includes(V)||I.branch_name&&I.branch_name.toLowerCase().includes(V)}return!0});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Contract Upload"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Search for procurement details and upload purchase contract"})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(Or,{className:"h-6 w-6 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Search Procurement"})]}),e.jsx("form",{onSubmit:j(A),className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"indent",className:"block text-sm font-medium text-gray-700 mb-2",children:["Indent Number *",e.jsx("span",{"data-tip":!0,"data-for":"indentTip",className:"ml-1 cursor-pointer text-blue-500",children:e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M18 10A8 8 0 11 2 10a8 8 0 0116 0zm-8 4a1 1 0 100-2 1 1 0 000 2zm1-7V7a1 1 0 10-2 0v1a1 1 0 00.293.707l1 1A1 1 0 0110 11a1 1 0 01-1-1H8a2 2 0 104 0 2 2 0 01-2 2z"})})}),e.jsx(lr,{id:"indentTip",place:"top",effect:"solid",children:"Enter the exact indent number as provided in your procurement confirmation (e.g., IND001)"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("input",{type:"text",id:"indent",...w("indentNumber"),placeholder:"Enter indent number (e.g., IND001)",className:`flex-1 input-field ${k.indentNumber?"border-red-500":""}`,disabled:a,onChange:I=>C("indentNumber",I.target.value.toUpperCase())}),e.jsx("button",{type:"submit",disabled:a,className:"btn-primary",children:a?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Searching..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Or,{className:"h-4 w-4 mr-2"}),"Search"]})})]}),k.indentNumber&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:k.indentNumber.message}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter the exact indent number from your procurement confirmation"})]})})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ps,{className:"h-6 w-6 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Indent Contract Status"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:R,disabled:u,className:"btn-secondary",children:u?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Refreshing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:"h-4 w-4 mr-2"}),"Refresh"]})}),e.jsxs("button",{onClick:()=>m(!g),className:"btn-secondary",children:[g?"Hide":"Show"," Indent Status"]})]})]}),g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(nt,{className:"h-6 w-6 text-blue-500 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Total Indents"}),e.jsx("p",{className:"text-lg font-semibold text-blue-900",children:c.length})]})]})}),e.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pt,{className:"h-6 w-6 text-yellow-500 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-700",children:"Pending Contracts"}),e.jsx("p",{className:"text-lg font-semibold text-yellow-900",children:c.filter(I=>I.contract_status==="pending").length})]})]})}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-6 w-6 text-green-500 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Uploaded Contracts"}),e.jsx("p",{className:"text-lg font-semibold text-green-900",children:c.filter(I=>I.contract_status!=="pending").length})]})]})}),e.jsx("div",{className:"bg-purple-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-6 w-6 text-purple-500 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Approved & Sent"}),e.jsx("p",{className:"text-lg font-semibold text-purple-900",children:c.filter(I=>I.contract_status==="sent").length})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filter by status:"}),e.jsxs("select",{value:v,onChange:I=>x(I.target.value),className:"input-field max-w-xs",children:[e.jsx("option",{value:"all",children:"All Indents"}),e.jsx("option",{value:"pending",children:"Pending Contracts"}),e.jsx("option",{value:"uploaded",children:"Uploaded Contracts"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Search:"}),e.jsx("input",{type:"text",placeholder:"Search by indent number, firm name, or branch...",value:f,onChange:I=>y(I.target.value),className:"input-field max-w-xs"})]})]}),e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",e.jsx("span",{className:"font-medium",children:T.length})," of ",e.jsx("span",{className:"font-medium",children:c.length})," indents",f&&e.jsxs("span",{children:[' matching "',e.jsx("span",{className:"font-medium",children:f}),'"']}),v!=="all"&&e.jsxs("span",{children:[" with ",v," contracts"]})]})}),u?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((I,V)=>e.jsx(Ts,{height:60},V))}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Indent Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Firm Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Branch"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contract Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map(I=>{var V,ie;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:I.indent_number}),e.jsxs("div",{className:"text-sm text-gray-500",children:[(V=I.bale_quantity)==null?void 0:V.toLocaleString()," bales"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:I.firm_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["",(ie=I.total_amount)==null?void 0:ie.toLocaleString()]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:I.branch_name}),e.jsx("div",{className:"text-sm text-gray-500",children:I.branch_code})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[I.contract_status==="pending"?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(pt,{className:"h-3 w-3 mr-1"}),"Pending"]}):I.contract_status==="sent"?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(Ae,{className:"h-3 w-3 mr-1"}),"Sent"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"Uploaded"]}),I.contract_uploaded_at&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(I.contract_uploaded_at).toLocaleDateString()})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:I.contract_status==="pending"?e.jsxs("button",{onClick:()=>K(I.indent_number),className:"text-blue-600 hover:text-blue-900 btn-secondary",children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"Upload Contract"]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-green-600 text-sm",children:"Contract uploaded"}),I.contract_file_name&&e.jsx(Rs,{className:"h-4 w-4 text-gray-400"})]})})]},I.indent_number)})})]}),T.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Le,{className:"mx-auto h-8 w-8 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"No indents found with the selected filter."})]})]})]})]}),a&&e.jsx("div",{className:"card p-6",children:e.jsx(Ts,{height:32,count:6})}),l&&!a&&e.jsx("div",{className:"card p-6",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(nt,{className:"h-6 w-6 text-green-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Procurement Details Found"})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(nt,{className:"h-5 w-5 text-green-500 mr-2"}),e.jsxs("p",{className:"text-green-800 font-medium",children:["Procurement record found for indent ",s.indent_number]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Indent Number"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:s.indent_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Firm Name"}),e.jsx("p",{className:"text-lg text-gray-900",children:s.firm_name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Bale Quantity"}),e.jsxs("p",{className:"text-lg text-gray-900",children:[(q=s.bale_quantity)==null?void 0:q.toLocaleString()," bales"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Zone"}),e.jsx("p",{className:"text-lg text-gray-900",children:s.zone})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Transaction Type"}),e.jsx("p",{className:"text-lg text-gray-900",children:s.transaction_type})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 border-b pb-2",children:"Financial Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Cotton Value"}),e.jsxs("p",{className:"text-lg text-gray-900",children:["",(E=s.cotton_value)==null?void 0:E.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"EMD Amount"}),e.jsxs("p",{className:"text-lg text-gray-900",children:["",(P=s.emd_amount)==null?void 0:P.toLocaleString()]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"GST Amount"}),e.jsxs("p",{className:"text-lg text-gray-900",children:["",(O=s.gst_amount)==null?void 0:O.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Total Amount"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["",(H=s.total_amount)==null?void 0:H.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Due Date"}),e.jsx("p",{className:"text-lg text-gray-900",children:new Date(s.due_date).toLocaleDateString()})]})]})]}),((J=s.allocation)==null?void 0:J.branch_information)&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-3",children:"Branch Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Branch Name:"}),e.jsx("p",{className:"text-gray-900",children:s.allocation.branch_information.branch_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Branch Code:"}),e.jsx("p",{className:"text-gray-900",children:s.allocation.branch_information.branch_code})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Email:"}),e.jsx("p",{className:"text-gray-900",children:s.allocation.branch_information.branch_email_id})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:se,className:"btn-primary",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Proceed to Upload Contract",e.jsx(ho,{className:"h-4 w-4 ml-2"})]})})]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"h-6 w-6 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-700 font-medium",children:"No procurement found for this indent number."})]})}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ve,{className:"h-6 w-6 text-purple-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Contract Upload Process"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-3 w-12 h-12 flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-blue-600 font-bold",children:"1"})}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Search"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enter indent number to find procurement details"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-green-100 rounded-full p-3 w-12 h-12 flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-green-600 font-bold",children:"2"})}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Upload"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload PDF contract file with proper naming"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-yellow-100 rounded-full p-3 w-12 h-12 flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-yellow-600 font-bold",children:"3"})}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Review"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Admin reviews and approves the contract"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-purple-100 rounded-full p-3 w-12 h-12 flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-purple-600 font-bold",children:"4"})}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Send"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Contract is emailed to relevant branch"})]})]})]})]})},uf="https://webhook-processor-production-b54b.up.railway.app/webhook/contract-upload",hf=tn().shape({contract:_l().required("Please select a PDF file").test("fileType","Only PDF files are allowed",r=>r&&r.type==="application/pdf").test("fileSize","File size must be less than 10MB",r=>r&&r.size<=10*1024*1024)}),mf=()=>{var K,T,q;const r=Ci(),t=Jt(),{user:s}=$e(),[n,a]=b.useState(null),[i,l]=b.useState(!1),[o,c]=b.useState(!1),[d,u]=b.useState(null),[h,g]=b.useState(!1),m=(K=r.state)==null?void 0:K.procurement,v=(T=r.state)==null?void 0:T.indentNumber,{register:x,handleSubmit:f,setValue:y,formState:{errors:w}}=ea({resolver:ta(hf)});b.useEffect(()=>{(!m||!v)&&(L.error("Please search for procurement details first"),t("/contract/search"))},[m,v,t]);const j=E=>{if(E.type!=="application/pdf"){L.error("Please select a PDF file");return}const P=10*1024*1024;if(E.size>P){L.error("File size must be less than 10MB");return}a(E)},k=E=>{const P=E.target.files[0];j(P)},C=E=>{E.preventDefault(),E.stopPropagation(),E.type==="dragenter"||E.type==="dragover"?g(!0):E.type==="dragleave"&&g(!1)},A=E=>{E.preventDefault(),E.stopPropagation(),g(!1),E.dataTransfer.files&&E.dataTransfer.files[0]&&j(E.dataTransfer.files[0])},R=async()=>{var P,O,H;if(!n){L.error("Please select a PDF file");return}const E=((O=(P=m==null?void 0:m.allocation)==null?void 0:P.branch_information)==null?void 0:O.branch_email_id)||"";try{l(!0);const J=new FormData;J.append("contract",n),J.append("indent_number",v),J.append("firm_name",m.firm_name),J.append("branch_email_id",E);const I=await fetch(uf,{method:"POST",body:J});if(!I.ok){const ie=await I.json();throw new Error(ie.message||"Failed to upload contract")}const V=await I.json();u(((H=V.data)==null?void 0:H.contract)||V.data),c(!0),L.success("Contract uploaded successfully!")}catch(J){console.error("Error uploading contract:",J),L.error(J.message||"Failed to upload contract")}finally{l(!1)}},se=()=>m?`${m.firm_name.replace(/[^a-zA-Z0-9]/g,"_")}_${v}_PurchaseContract.pdf`:"";return!m||!v?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})}):o?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(Ae,{className:"mx-auto h-16 w-16 text-green-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Contract Uploaded Successfully!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your contract has been uploaded and is now waiting for admin approval."}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"text-left space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-900",children:"Contract ID:"}),e.jsx("span",{className:"text-green-800",children:d==null?void 0:d.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-900",children:"Indent Number:"}),e.jsx("span",{className:"text-green-800",children:v})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-900",children:"Firm Name:"}),e.jsx("span",{className:"text-green-800",children:m.firm_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-900",children:"File Name:"}),e.jsx("span",{className:"text-green-800",children:d==null?void 0:d.file_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-900",children:"Status:"}),e.jsx("span",{className:"status-badge status-pending",children:"Pending Approval"})]})]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"What happens next?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:" Admin will review your uploaded contract"}),e.jsx("li",{children:" Once approved, the contract will be sent to the relevant branch"}),e.jsx("li",{children:" You will receive a notification about the approval status"}),e.jsx("li",{children:" Check the admin contracts section for status updates"})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:()=>t("/contract/search"),className:"btn-secondary",children:"Upload Another Contract"}),e.jsx("button",{onClick:()=>t("/admin/contracts"),className:"btn-primary",children:"View Contract Status"})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Upload Purchase Contract"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Upload PDF contract for indent ",v]})]}),e.jsxs("button",{onClick:()=>t("/contract/search"),className:"btn-secondary",children:[e.jsx(mo,{className:"h-4 w-4 mr-2"}),"Back to Search"]})]})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Procurement Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Indent Number:"}),e.jsx("p",{className:"text-gray-900 font-medium",children:v})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Firm Name:"}),e.jsx("p",{className:"text-gray-900",children:m.firm_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Total Amount:"}),e.jsxs("p",{className:"text-gray-900 font-medium",children:["",(q=m.total_amount)==null?void 0:q.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(cn,{className:"h-6 w-6 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Upload Contract PDF"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-900",children:[e.jsx("strong",{children:"Suggested filename:"})," ",se(),e.jsx("span",{"data-tip":!0,"data-for":"filenameTip",className:"ml-1 cursor-pointer text-blue-500",children:e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M18 10A8 8 0 11 2 10a8 8 0 0116 0zm-8 4a1 1 0 100-2 1 1 0 000 2zm1-7V7a1 1 0 10-2 0v1a1 1 0 00.293.707l1 1A1 1 0 0110 11a1 1 0 01-1-1H8a2 2 0 104 0 2 2 0 01-2 2z"})})}),e.jsxs(lr,{id:"filenameTip",place:"top",effect:"solid",children:["Please rename your file to match this format for better organization.",e.jsx("br",{}),"Format: Firm_Name_Indent_Number_PurchaseContract.pdf"]})]}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Please rename your file to match this format for better organization"})]}),e.jsxs("form",{onSubmit:E=>{E.preventDefault(),R()},children:[e.jsx("div",{className:`relative border-2 border-dashed rounded-lg p-6 transition-colors ${h?"border-blue-400 bg-blue-50":n?"border-green-400 bg-green-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:C,onDragLeave:C,onDragOver:C,onDrop:A,children:e.jsx("div",{className:"text-center",children:n?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ae,{className:"mx-auto h-12 w-12 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium text-gray-900",children:n.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(n.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx("button",{type:"button",onClick:()=>{a(null)},className:"text-sm text-red-600 hover:text-red-800",children:"Remove file"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(cn,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md font-medium text-blue-600 hover:text-blue-500",children:[e.jsx("span",{children:"Upload a file"}),e.jsx("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:".pdf",onChange:k})]}),e.jsx("span",{className:"text-gray-500",children:" or drag and drop"}),e.jsx("span",{"data-tip":!0,"data-for":"fileTip",className:"ml-1 cursor-pointer text-blue-500",children:e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M18 10A8 8 0 11 2 10a8 8 0 0116 0zm-8 4a1 1 0 100-2 1 1 0 000 2zm1-7V7a1 1 0 10-2 0v1a1 1 0 00.293.707l1 1A1 1 0 0110 11a1 1 0 01-1-1H8a2 2 0 104 0 2 2 0 01-2 2z"})})}),e.jsxs(lr,{id:"fileTip",place:"top",effect:"solid",children:["PDF files only, up to 10MB. File must be clear, complete, and properly signed.",e.jsx("br",{}),"Only PDF files are accepted."]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PDF files only, up to 10MB"})]})})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{type:"submit",disabled:!n||i,className:"btn-primary",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Ts,{width:24,height:24,circle:!0,inline:!0}),e.jsx("span",{className:"ml-2",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(cn,{className:"h-4 w-4 mr-2"}),"Upload Contract"]})})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Le,{className:"h-6 w-6 text-yellow-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Upload Guidelines"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"File Requirements"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("li",{children:" PDF format only"}),e.jsx("li",{children:" Maximum file size: 10MB"}),e.jsx("li",{children:" Clear and readable document"}),e.jsx("li",{children:" Complete contract with all pages"}),e.jsx("li",{children:" Properly signed and dated"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Naming Convention"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("li",{children:" Use suggested filename format"}),e.jsx("li",{children:" Include firm name and indent number"}),e.jsx("li",{children:" Use underscores instead of spaces"}),e.jsx("li",{children:" End with _PurchaseContract.pdf"}),e.jsx("li",{children:" Avoid special characters"})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Important:"})," Once uploaded, the contract will be sent for admin approval. Ensure all details are correct before uploading."]})})]})]})},ff="https://webhook-processor-production-b54b.up.railway.app/webhook/contract-approve",xf=()=>{const{user:r,isAdmin:t}=$e(),[s,n]=b.useState([]),[a,i]=b.useState(!0),[l,o]=b.useState({}),[c,d]=b.useState({status:"pending"}),u=async()=>{try{i(!0);const m=await ee.get("/contract/pending");n(m.data.data.contracts)}catch(m){console.error("Error fetching contracts:",m),L.error("Failed to fetch contracts")}finally{i(!1)}};b.useEffect(()=>{t()?u():i(!1)},[t]),b.useEffect(()=>{if(!t())return;const m=it.channel("realtime:purchase_contract_table").on("postgres_changes",{event:"*",schema:"public",table:"purchase_contract_table"},v=>{u(),v.eventType==="INSERT"?L.success("New contract uploaded and pending review"):v.eventType==="UPDATE"?v.new.status==="sent"?L.success("Contract approved and sent to branch"):v.new.status==="failed"?L.error("Contract sending failed"):L("Contract status updated"):v.eventType==="DELETE"&&L("Contract removed")}).subscribe();return()=>{it.removeChannel(m)}},[t]);const h=async m=>{var v,x,f,y,w;try{o(R=>({...R,[m]:!0}));const j=s.find(R=>R.id===m);let k="";try{k=((w=(y=(f=(x=(v=(await ee.get("/contract/search",{params:{indent_number:j.indent_number}})).data)==null?void 0:v.data)==null?void 0:x.procurement)==null?void 0:f.allocation)==null?void 0:y.branch_information)==null?void 0:w.branch_email_id)||""}catch(R){console.error("Failed to fetch procurement for branch email",R)}const C={contract_id:m,indent_number:j.indent_number,firm_name:j.firm_name,file_url:j.file_url,branch_name:j.branch_name,branch_email_id:k},A=await fetch(ff,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});if(!A.ok){const R=await A.json();throw new Error(R.message||"Failed to approve contract")}L.success("Contract approved and sent successfully!"),n(R=>R.filter(se=>se.id!==m))}catch(j){console.error("Error approving contract:",j),L.error(j.message||"Failed to approve contract")}finally{o(j=>({...j,[m]:!1}))}},g=m=>{window.open(m,"_blank")};return t()?a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Contract Administration"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Review and approve uploaded purchase contracts"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[...Array(4)].map((m,v)=>e.jsx(Ts,{height:80},v))}),e.jsx("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:e.jsx(Ts,{height:48,count:6})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Contract Administration"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Review and approve uploaded purchase contracts"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pt,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pending Review"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Contracts"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Approved Today"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.filter(m=>{const v=new Date().toDateString();return new Date(m.uploaded_at).toDateString()===v}).length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ja,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Avg Review Time"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"2.5h"})]})]})})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ps,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"})]}),e.jsx("button",{onClick:u,className:"btn-secondary text-sm",children:"Refresh"})]})}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contract Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Procurement Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Upload Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Actions",e.jsx("span",{"data-tip":!0,"data-for":"actionsTip",className:"ml-1 cursor-pointer text-blue-500",children:e.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M18 10A8 8 0 11 2 10a8 8 0 0116 0zm-8 4a1 1 0 100-2 1 1 0 000 2zm1-7V7a1 1 0 10-2 0v1a1 1 0 00.293.707l1 1A1 1 0 0110 11a1 1 0 01-1-1H8a2 2 0 104 0 2 2 0 01-2 2z"})})})]})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(m=>{var v,x;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:m.indent_number}),e.jsx("div",{className:"text-sm text-gray-500",children:m.firm_name}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["File: ",m.file_name]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:"View in procurement section"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Related to ",m.indent_number]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[(v=m.uploaded_user)==null?void 0:v.first_name," ",(x=m.uploaded_user)==null?void 0:x.last_name]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(m.uploaded_at).toLocaleDateString()}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(m.uploaded_at).toLocaleTimeString()})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"status-badge status-pending",children:[e.jsx(pt,{className:"h-3 w-3 mr-1"}),m.status]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>g(m.file_url),className:"inline-flex items-center text-blue-600 hover:text-blue-900","data-tip":!0,"data-for":"viewTip",children:[e.jsx(Rs,{className:"h-4 w-4 mr-1"}),"View PDF"]}),e.jsx(lr,{id:"viewTip",place:"top",effect:"solid",children:"View the uploaded contract PDF in a new tab."})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>h(m.id),disabled:l[m.id],className:"inline-flex items-center btn-primary text-sm","data-tip":!0,"data-for":"approveTip",children:l[m.id]?e.jsxs(e.Fragment,{children:[e.jsx(Ts,{width:16,height:16,circle:!0,inline:!0}),e.jsx("span",{className:"ml-2",children:"Processing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ja,{className:"h-4 w-4 mr-1"}),"Approve & Send"]})}),e.jsx(lr,{id:"approveTip",place:"top",effect:"solid",children:"Approve the contract and send it to the branch email."})]})]})]},m.id)})})]})}),s.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No pending contracts"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"All contracts have been reviewed and processed."})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Le,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900",children:"Contract Review Guidelines"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Verify that the indent number matches the procurement record"}),e.jsx("li",{children:"Ensure the firm name is correct and matches procurement details"}),e.jsx("li",{children:"Check that the contract is properly signed and dated"}),e.jsx("li",{children:"Verify all terms and conditions are clearly mentioned"}),e.jsx("li",{children:"Ensure the PDF is clear and readable"}),e.jsx("li",{children:"Once approved, the contract will be automatically sent to the branch email"})]})]})]})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Approval Process"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-3 w-12 h-12 flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-blue-600 font-bold",children:"1"})}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Review"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Check contract details and PDF quality"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-yellow-100 rounded-full p-3 w-12 h-12 flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-yellow-600 font-bold",children:"2"})}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Validate"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Verify against procurement data"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-green-100 rounded-full p-3 w-12 h-12 flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-green-600 font-bold",children:"3"})}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Approve"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Click approve & send button"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-purple-100 rounded-full p-3 w-12 h-12 flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-purple-600 font-bold",children:"4"})}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Send"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Automatically emailed to branch"})]})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Le,{className:"mx-auto h-12 w-12 text-red-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You don't have permission to view this page."})]})},pf=()=>{const{user:r,isAdmin:t}=$e(),[s,n]=b.useState([]),[a,i]=b.useState(!0),[l,o]=b.useState({current_page:1,total_pages:1,total_records:0}),[c,d]=b.useState({page:1,limit:20}),u=async()=>{try{i(!0);const m={page:c.page,limit:c.limit},v=await ee.get("/contract/logs",{params:m});n(v.data.data.logs),o(v.data.data.pagination)}catch(m){console.error("Error fetching contract logs:",m)}finally{i(!1)}};b.useEffect(()=>{t()?u():i(!1)},[c,t]),b.useEffect(()=>{if(!t())return;const m=it.channel("realtime:contract_logs").on("postgres_changes",{event:"*",schema:"public",table:"contract_logs"},v=>{u(),v.eventType==="INSERT"?L.success("New contract log entry"):v.eventType==="UPDATE"?L("Contract log updated"):v.eventType==="DELETE"&&L("Contract log removed")}).subscribe();return()=>{it.removeChannel(m)}},[c,t]);const h=m=>{d(v=>({...v,page:m}))},g=m=>{switch(m){case"uploaded":return{icon:ve,color:"text-blue-600",bg:"bg-blue-100",label:"Uploaded"};case"approved":return{icon:pt,color:"text-green-600",bg:"bg-green-100",label:"Approved"};case"sent":return{icon:jn,color:"text-purple-600",bg:"bg-purple-100",label:"Sent"};case"rejected":return{icon:Rs,color:"text-red-600",bg:"bg-red-100",label:"Rejected"};default:return{icon:ve,color:"text-gray-600",bg:"bg-gray-100",label:m}}};return t()?a?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Contract Audit Logs"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Complete audit trail of all contract operations and status changes"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ve,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Logs"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:l.total_records})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pt,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Today's Activities"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.filter(m=>{const v=new Date().toDateString();return new Date(m.timestamp).toDateString()===v}).length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(jn,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Sent Contracts"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.filter(m=>m.action==="sent").length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(cs,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"This Week"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:s.filter(m=>{const v=new Date;return v.setDate(v.getDate()-7),new Date(m.timestamp)>v}).length})]})]})})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ps,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Activity Log"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:c.limit,onChange:m=>d(v=>({...v,limit:parseInt(m.target.value),page:1})),className:"text-sm border border-gray-300 rounded-md px-3 py-1",children:[e.jsx("option",{value:10,children:"10 per page"}),e.jsx("option",{value:20,children:"20 per page"}),e.jsx("option",{value:50,children:"50 per page"})]}),e.jsx("button",{onClick:u,className:"btn-secondary text-sm",children:"Refresh"})]})]})}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Contract Activity Timeline"})}),e.jsx("div",{className:"flow-root",children:e.jsx("ul",{className:"-mb-8",children:s.map((m,v)=>{var y,w,j,k,C;const x=g(m.action),f=x.icon;return e.jsx("li",{children:e.jsxs("div",{className:"relative pb-8",children:[v!==s.length-1&&e.jsx("span",{className:"absolute top-5 left-5 -ml-px h-full w-0.5 bg-gray-200"}),e.jsxs("div",{className:"relative flex items-start space-x-3",children:[e.jsx("div",{className:"relative px-1",children:e.jsx("div",{className:`h-8 w-8 ${x.bg} rounded-full ring-8 ring-white flex items-center justify-center`,children:e.jsx(f,{className:`h-4 w-4 ${x.color}`})})}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x.bg} ${x.color}`,children:x.label}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:(y=m.purchase_contract_table)==null?void 0:y.indent_number})]}),e.jsx("time",{className:"text-xs text-gray-500",children:new Date(m.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Contract:"}),e.jsx("p",{className:"text-gray-900",children:(w=m.purchase_contract_table)==null?void 0:w.firm_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Status:"}),e.jsx("p",{className:"text-gray-900",children:(j=m.purchase_contract_table)==null?void 0:j.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"User:"}),e.jsxs("p",{className:"text-gray-900",children:[(k=m.users)==null?void 0:k.first_name," ",(C=m.users)==null?void 0:C.last_name]})]})]}),m.notes&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-medium text-gray-500 text-sm",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:m.notes})]})]})})]})]})},m.id)})})}),s.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No contract logs found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Contract activities will appear here as they occur."})]}),l.total_pages>1&&e.jsx("div",{className:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing page ",l.current_page," of ",l.total_pages,"(",l.total_records," total records)"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>h(l.current_page-1),disabled:!l.has_previous,className:"px-3 py-1 border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>h(l.current_page+1),disabled:!l.has_next,className:"px-3 py-1 border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Export Logs"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Download contract activity logs for reporting"})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"btn-secondary text-sm",children:"Export CSV"}),e.jsx("button",{className:"btn-primary text-sm",children:"Generate Report"})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You don't have permission to view contract logs."})]})},gf=()=>{var q;const{user:r}=$e(),[t,s]=b.useState(""),[n,a]=b.useState(null),[i,l]=b.useState(!1),[o,c]=b.useState([]),[d,u]=b.useState([]),[h,g]=b.useState(1),[m,v]=b.useState(!1),[x,f]=b.useState([]),[y,w]=b.useState([]),j=async()=>{var E,P;if(!t.trim()){L.error("Please enter an indent number");return}try{l(!0);const O=await ee.get("/sampling/fetch-indent",{params:{indent_number:t.trim()}});a(O.data.data);const H=O.data.data.calculated_lots,J=Array(H.total_lots).fill("");c(J),g(2),L.success("Indent details found")}catch(O){console.error("Error fetching indent:",O),L.error(((P=(E=O.response)==null?void 0:E.data)==null?void 0:P.message)||"Indent not found")}finally{l(!1)}},k=()=>{c(E=>[...E,""])},C=E=>{o.length>1&&c(P=>P.filter((O,H)=>H!==E))},A=(E,P)=>{c(O=>{const H=[...O];return H[E]=P.toUpperCase(),H}),w(O=>{const H=[...O];return H[E]="",H})},R=()=>{const E=o.map(O=>O.trim()),P=E.map((O,H,J)=>O?J.indexOf(O)!==H?"Duplicate lot number":"":"Lot number required");if(w(P),P.some(O=>O)){L.error("Please fix the errors before proceeding");return}u(Array(E.length).fill("")),g(3)},se=(E,P)=>{u(O=>{const H=[...O];return H[E]=P.toUpperCase(),H})},K=async()=>{var J,I;const E=o.filter(V=>V.trim()!==""),P=d.filter(V=>V.trim()!=="");if(P.length!==E.length){L.error("Please re-enter all lot numbers for verification"),f(Array(E.length).fill("Please re-enter this lot number"));return}const O=E.map((V,ie)=>V!==P[ie]?"Lot numbers do not match":"");if(f(O),O.some(V=>V)){L.error("Lot numbers do not match. Please check and try again.");return}try{v(!0),await ee.post("/sampling/save",{indent_number:t,lots:E}),g(4),L.success("Sampling entries saved successfully!")}catch(V){console.error("Error saving sampling:",V),L.error(((I=(J=V.response)==null?void 0:J.data)==null?void 0:I.message)||"Failed to save sampling entries")}finally{v(!1)}},T=()=>{s(""),a(null),c([]),u([]),g(1)};return h===4?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(Ae,{className:"mx-auto h-16 w-16 text-green-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Sampling Entry Completed!"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Successfully saved ",o.filter(E=>E.trim()!=="").length," lot numbers for indent ",t]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"text-left space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-900",children:"Indent Number:"}),e.jsx("span",{className:"text-green-800",children:t})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-900",children:"Total Lots Entered:"}),e.jsx("span",{className:"text-green-800",children:o.filter(E=>E.trim()!=="").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-900",children:"Added By:"}),e.jsxs("span",{className:"text-green-800",children:[r==null?void 0:r.first_name," ",r==null?void 0:r.last_name]})]})]})}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:T,className:"btn-secondary",children:"Enter Another Indent"}),e.jsx("button",{onClick:()=>window.location.href="/sales-processing",className:"btn-primary",children:"Proceed to Sales"})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sampling Entry"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Enter lot numbers for inventory management after procurement completion"})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsx("div",{className:"flex items-center justify-between",children:[{number:1,title:"Search Indent",active:h===1,completed:h>1},{number:2,title:"Enter Lots",active:h===2,completed:h>2},{number:3,title:"Verification",active:h===3,completed:h>3},{number:4,title:"Complete",active:h===4,completed:!1}].map((E,P)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium ${E.completed?"bg-green-500 text-white":E.active?"bg-blue-500 text-white":"bg-gray-300 text-gray-600"}`,children:E.completed?e.jsx(Ae,{className:"h-5 w-5"}):E.number}),e.jsx("span",{className:`ml-2 text-sm font-medium ${E.active?"text-blue-600":"text-gray-500"}`,children:E.title}),P<3&&e.jsx("div",{className:"w-12 h-0.5 bg-gray-300 mx-4"})]},E.number))})}),h===1&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(Or,{className:"h-6 w-6 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Search Indent Details"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"indent",className:"block text-sm font-medium text-gray-700 mb-2",children:"Indent Number *"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("input",{type:"text",id:"indent",value:t,onChange:E=>s(E.target.value.toUpperCase()),placeholder:"Enter indent number (e.g., IND001)",className:"flex-1 input-field",disabled:i}),e.jsx("button",{onClick:j,disabled:i||!t.trim(),className:"btn-primary",children:i?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Searching..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Or,{className:"h-4 w-4 mr-2"}),"Search"]})})]})]})})]}),h===2&&n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(nt,{className:"h-6 w-6 text-green-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Indent Details"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Indent Number:"}),e.jsx("p",{className:"text-gray-900 font-medium",children:n.indent_details.indent_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Bales Quantity:"}),e.jsx("p",{className:"text-gray-900",children:(q=n.indent_details.bales_quantity)==null?void 0:q.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Centre:"}),e.jsx("p",{className:"text-gray-900",children:n.indent_details.centre_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Branch:"}),e.jsx("p",{className:"text-gray-900",children:n.indent_details.branch})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Variety:"}),e.jsx("p",{className:"text-gray-900",children:n.indent_details.variety})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Fibre Length:"}),e.jsx("p",{className:"text-gray-900",children:n.indent_details.fibre_length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Bid Price:"}),e.jsxs("p",{className:"text-gray-900",children:["",n.indent_details.bid_price]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Lifting Period:"}),e.jsx("p",{className:"text-gray-900",children:n.indent_details.lifting_period})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(rr,{className:"h-6 w-6 text-purple-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Calculated Lot Requirements"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Base Lots"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:n.calculated_lots.base_lots}),e.jsxs("p",{className:"text-xs text-blue-700",children:["(",n.indent_details.bales_quantity,"  100)"]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Extra Lots (20%)"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:n.calculated_lots.extra_lots}),e.jsx("p",{className:"text-xs text-green-700",children:"(20% of base lots)"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Total Required"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:n.calculated_lots.total_lots}),e.jsx("p",{className:"text-xs text-purple-700",children:"(Base + Extra)"})]})]}),n.sampling_completed&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"h-5 w-5 text-yellow-500 mr-2"}),e.jsxs("p",{className:"text-yellow-800 font-medium",children:["Sampling already completed for this indent with ",n.existing_lots.length," lots."]})]})})]}),!n.sampling_completed&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Enter Lot Numbers"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:k,className:"btn-secondary text-sm",children:[e.jsx(wa,{className:"h-4 w-4 mr-1"}),"Add Lot"]})})]}),e.jsx("div",{className:"space-y-2",children:o.map((E,P)=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2",children:[e.jsx("input",{type:"text",value:E,onChange:O=>A(P,O.target.value),placeholder:`Lot #${P+1}`,className:`input-field w-40 ${y[P]?"border-red-500":""}`,autoComplete:"off"}),e.jsx("button",{type:"button",onClick:()=>C(P),className:"btn-secondary px-2 py-1",disabled:o.length===1,children:e.jsx(fo,{className:"h-4 w-4"})}),y[P]&&e.jsx("span",{className:"text-xs text-red-600 mt-1 md:ml-2",children:y[P]})]},P))}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsxs("button",{type:"button",onClick:k,className:"btn-secondary",children:[e.jsx(wa,{className:"h-4 w-4 mr-1"})," Add Field"]}),e.jsx("button",{onClick:R,className:"btn-primary",children:"Next: Verify Lots"})]})]})]}),h===3&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(Ae,{className:"h-6 w-6 text-yellow-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Verify Lot Numbers"})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-yellow-800 text-sm",children:"Please re-enter all lot numbers to verify accuracy. The first entry is masked for security."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Original Entry (Masked)"}),e.jsx("div",{className:"space-y-2",children:o.filter(E=>E.trim()!=="").map((E,P)=>e.jsxs("div",{className:"p-2 bg-gray-100 rounded text-sm text-gray-600",children:["Lot ",P+1,": ","*".repeat(E.length)]},P))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Re-enter for Verification"}),e.jsx("div",{className:"space-y-2",children:o.filter(E=>E.trim()!=="").map((E,P)=>e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-xs text-gray-500 mb-1",children:["Lot #",P+1]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"password",value:E,disabled:!0,className:"input-field w-32 bg-gray-100 text-gray-400",style:{WebkitTextSecurity:"disc"}}),e.jsx("span",{className:"mx-2",children:""}),e.jsx("input",{type:"text",value:d[P]||"",onChange:O=>se(P,O.target.value),className:`input-field w-32 ${x[P]?"border-red-500":""}`,autoComplete:"off"})]}),x[P]&&e.jsx("span",{className:"text-xs text-red-600 mt-1",children:x[P]})]},P))})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx("button",{onClick:()=>g(2),className:"btn-secondary",children:"Back to Entry"}),e.jsx("button",{onClick:K,disabled:m,className:"btn-primary",children:m?e.jsx(oe,{size:"sm"}):"Submit"})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(rr,{className:"h-6 w-6 text-blue-500 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Sampling Guidelines"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Lot Number Format"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("li",{children:" Use consistent naming convention"}),e.jsx("li",{children:" Suggested format: LOT001, LOT002, etc."}),e.jsx("li",{children:" Ensure uniqueness across all lots"}),e.jsx("li",{children:" Use alphanumeric characters only"}),e.jsx("li",{children:" Maximum 10 characters per lot number"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Process Notes"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("li",{children:" Base lots = Total bales  100"}),e.jsx("li",{children:" Extra lots = 20% of base lots (minimum buffer)"}),e.jsx("li",{children:" You can add more lots than recommended"}),e.jsx("li",{children:" Verification step prevents data entry errors"}),e.jsx("li",{children:" Once saved, lots become available for sales"})]})]})]})]})]})},yf=()=>{var ue,Qe,Re,ze,bt,We,Ct,Te;const{user:r}=$e(),[t,s]=b.useState([]),[n,a]=b.useState(null),[i,l]=b.useState([]),[o,c]=b.useState([]),[d,u]=b.useState([]),[h,g]=b.useState(!0),[m,v]=b.useState(!1),[x,f]=b.useState("list"),[y,w]=b.useState({requiredBales:0,selectedBales:0,totalValue:0,brokerCommission:0,netAmount:0,insufficientLots:!1,warningMessage:""}),[j,k]=b.useState(!1),[C,A]=b.useState({customer_id:"",broker_id:"",line_items:[{indent_number:"",quantity:"",broker_brokerage_per_bale:"",our_brokerage_per_bale:"",indent_details:null}]}),[R,se]=b.useState(!1),[K,T]=b.useState([]),[q,E]=b.useState([]);b.useEffect(()=>{ee.get("/customer-info").then(S=>T(S.data.data.customers||[])).catch(()=>T([])),ee.get("/broker-info").then(S=>E(S.data.data.brokers||[])).catch(()=>E([]))},[]);const P=(S,U)=>{A(Q=>({...Q,[S]:U}))},O=(S,U,Q)=>{A(p=>{const _=[...p.line_items];if(_[S][U]=Q,U==="quantity"&&_[S].indent_details){const N=Number(Q),F=_[S].indent_details.available_bales;N>F&&(L.error(`Quantity cannot exceed available bales (${F})`),_[S][U]=F.toString())}return{...p,line_items:_}})},H=()=>{A(S=>({...S,line_items:[...S.line_items,{indent_number:"",quantity:"",broker_brokerage_per_bale:"",our_brokerage_per_bale:"",indent_details:null}]}))},J=S=>{A(U=>({...U,line_items:U.line_items.filter((Q,p)=>p!==S)}))},I=async(S,U)=>{var Q,p;if(!S.trim()){L.error("Please enter an indent number");return}try{const N=(await ee.post("/sales/validate-indent",{indent_number:S.trim().toUpperCase()})).data.data.indent;A(F=>{const $=[...F.line_items];return $[U].indent_details=N,Number($[U].quantity)>N.available_bales&&($[U].quantity=""),{...F,line_items:$}}),L.success(`Indent ${S} validated successfully`)}catch(_){console.error("Error validating indent:",_);const N=((p=(Q=_.response)==null?void 0:Q.data)==null?void 0:p.message)||"Failed to validate indent";L.error(N),A(F=>{const $=[...F.line_items];return $[U].indent_details=null,{...F,line_items:$}})}},V=()=>{let S=0,U=0,Q=0;return C.line_items.forEach(p=>{p.indent_details&&p.quantity&&(S+=Number(p.quantity),U+=Number(p.quantity)*Number(p.broker_brokerage_per_bale||0),Q+=Number(p.quantity)*Number(p.our_brokerage_per_bale||0))}),{totalLots:S,totalBrokerBrokerage:U,totalOurBrokerage:Q}},ie=async S=>{var U,Q;S.preventDefault(),se(!0);try{if(!C.customer_id||!C.broker_id||C.line_items.length===0){L.error("Please fill all required fields and add at least one line item"),se(!1);return}if(C.line_items.filter(N=>!N.indent_number||!N.quantity||!N.broker_brokerage_per_bale||!N.our_brokerage_per_bale||!N.indent_details).length>0){L.error("Please fill all fields in line items and validate indents"),se(!1);return}if(C.line_items.filter(N=>Number(N.quantity)<=0).length>0){L.error("All quantities must be positive"),se(!1);return}await ee.post("/sales/new",{...C,line_items:C.line_items.map(N=>({indent_number:N.indent_number,quantity:Number(N.quantity),broker_brokerage_per_bale:Number(N.broker_brokerage_per_bale),our_brokerage_per_bale:Number(N.our_brokerage_per_bale)}))}),L.success("Sales order created successfully!"),k(!1),A({customer_id:"",broker_id:"",line_items:[{indent_number:"",quantity:"",broker_brokerage_per_bale:"",our_brokerage_per_bale:"",indent_details:null}]}),ye()}catch(p){console.error("Error creating order:",p);const _=((Q=(U=p.response)==null?void 0:U.data)==null?void 0:Q.message)||"Failed to create order";L.error(_)}finally{se(!1)}},ye=async()=>{var S;try{g(!0);const U=await ee.get("/sales/pending-orders");s(U.data.data.orders)}catch(U){console.error("Error fetching pending orders:",U),((S=U.response)==null?void 0:S.status)!==401&&L.error("Failed to fetch pending orders")}finally{g(!1)}};b.useEffect(()=>{ye();const S=it.channel("public:sales_configuration").on("postgres_changes",{event:"*",schema:"public",table:"sales_configuration"},U=>{ye()}).subscribe();return()=>{it.removeChannel(S)}},[]);const me=S=>S,Ee=async S=>{var U,Q;try{a(S),f("processing");const p=me(S.requested_quantity),_=await ee.post("/sales/auto-select-lots",{sales_config_id:S.id,requested_qty:p});if(_.data.data.out_of_stock){L.error("No available lots found matching the criteria"),f("list");return}l(_.data.data.available_lots),c(_.data.data.auto_selected),u(_.data.data.auto_selected.map(N=>N.id)),Me(_.data.data.auto_selected,p,S),f("selection")}catch(p){console.error("Error selecting order:",p);const _=((Q=(U=p.response)==null?void 0:U.data)==null?void 0:Q.message)||"Failed to process order";L.error(_),f("list")}},Me=(S,U,Q)=>{var D;const p=S.reduce((z,re)=>z+(re.bid_price||0),0),_=p*(((D=Q.broker_info)==null?void 0:D.commission_rate)||0)/100,N=p-_,F=S.length<U;let $="";F?$=`Insufficient lots. Required: ${U}, Selected: ${S.length}`:S.length>U*1.2&&($=`Over-selected lots. Required: ${U}, Selected: ${S.length}`),w({requiredBales:U,selectedBales:S.length,totalValue:p,brokerCommission:_,netAmount:N,insufficientLots:F,warningMessage:$})},B=S=>{u(U=>{const Q=U.includes(S)?U.filter(N=>N!==S):[...U,S],p=i.filter(N=>Q.includes(N.id)),_=me(n.requested_quantity);return Me(p,_,n),Q})},G=()=>{const S=me(n.requested_quantity);if(d.length<S){L.error(`Please select at least ${S} lots`);return}if(y.insufficientLots){L.error("Insufficient lots selected. Please add more lots or contact inventory management.");return}f("confirm")},Y=async()=>{var S,U;try{v(!0),await ee.post("/sales/save-draft",{sales_config_id:n.id,selected_lots:d,notes:`Draft saved by ${r.first_name} ${r.last_name} on ${new Date().toLocaleString()}`}),L.success("Sales draft saved successfully"),f("list"),ye()}catch(Q){console.error("Error saving draft:",Q);const p=((U=(S=Q.response)==null?void 0:S.data)==null?void 0:U.message)||"Failed to save draft";L.error(p)}finally{v(!1)}},Z=async()=>{var S,U;try{v(!0),await ee.post("/sales/confirm",{sales_config_id:n.id,selected_lots:d,notes:`Sale confirmed by ${r.first_name} ${r.last_name} on ${new Date().toLocaleString()}`}),L.success("Sales order confirmed successfully! n8n automation triggered."),f("list"),ye()}catch(Q){console.error("Error confirming sale:",Q);const p=((U=(S=Q.response)==null?void 0:S.data)==null?void 0:U.message)||"Failed to confirm sale";L.error(p)}finally{v(!1)}},ce=()=>{a(null),l([]),c([]),u([]),w({requiredBales:0,selectedBales:0,totalValue:0,brokerCommission:0,netAmount:0,insufficientLots:!1,warningMessage:""}),f("list")};if(h)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})});if(x==="list")return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Create New Sales Order"}),e.jsx("button",{className:"btn-primary",onClick:()=>k(S=>!S),children:j?"Cancel":"New Order"})]}),j&&e.jsxs("form",{className:"mt-4 space-y-4",onSubmit:ie,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Customer"}),e.jsxs("select",{className:"input-field",value:C.customer_id,onChange:S=>P("customer_id",S.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Customer"}),K.map(S=>e.jsxs("option",{value:S.id,children:[S.customer_name," (",S.customer_code,")"]},S.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Broker"}),e.jsxs("select",{className:"input-field",value:C.broker_id,onChange:S=>P("broker_id",S.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Broker"}),q.map(S=>e.jsxs("option",{value:S.id,children:[S.broker_name," (",S.broker_code,")"]},S.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Lines"}),C.line_items.map((S,U)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Indent Number"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"input-field flex-1",placeholder:"Enter indent number",value:S.indent_number,onChange:Q=>O(U,"indent_number",Q.target.value),required:!0}),e.jsx("button",{type:"button",className:"btn-secondary px-3",onClick:()=>I(S.indent_number,U),disabled:!S.indent_number.trim(),children:"Validate"})]})]})}),S.indent_details&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Indent Details"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Bales Quantity:"}),e.jsx("p",{className:"font-medium",children:S.indent_details.bales_quantity})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Available:"}),e.jsx("p",{className:"font-medium text-green-600",children:S.indent_details.available_bales})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Centre:"}),e.jsx("p",{className:"font-medium",children:S.indent_details.centre_name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Branch:"}),e.jsx("p",{className:"font-medium",children:S.indent_details.branch})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Lifting Period:"}),e.jsx("p",{className:"font-medium",children:S.indent_details.lifting_period})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Fibre Length:"}),e.jsx("p",{className:"font-medium",children:S.indent_details.fibre_length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Variety:"}),e.jsx("p",{className:"font-medium",children:S.indent_details.variety})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Bid Price:"}),e.jsxs("p",{className:"font-medium",children:["",S.indent_details.bid_price]})]})]})]}),S.indent_details&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Line Quantity (lots)"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Enter quantity in lots",min:1,max:S.indent_details.available_bales,value:S.quantity,onChange:Q=>O(U,"quantity",Q.target.value),required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Max available: ",S.indent_details.available_bales," lots"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Broker Brokerage per Bale"}),e.jsx("input",{type:"number",className:"input-field",placeholder:" per bale",min:0,step:.01,value:S.broker_brokerage_per_bale,onChange:Q=>O(U,"broker_brokerage_per_bale",Q.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Our Brokerage per Bale"}),e.jsx("input",{type:"number",className:"input-field",placeholder:" per bale",min:0,step:.01,value:S.our_brokerage_per_bale,onChange:Q=>O(U,"our_brokerage_per_bale",Q.target.value),required:!0})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"button",className:"btn-secondary w-full",onClick:()=>J(U),disabled:C.line_items.length===1,children:"Remove Line"})})]})]},U)),e.jsx("button",{type:"button",className:"btn-primary mt-2",onClick:H,children:"Add Order Line"})]}),C.line_items.some(S=>S.indent_details&&S.quantity)&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Order Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Lots:"}),e.jsx("p",{className:"font-medium text-lg",children:V().totalLots})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Broker Brokerage:"}),e.jsxs("p",{className:"font-medium text-lg",children:["",V().totalBrokerBrokerage.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Total Our Brokerage:"}),e.jsxs("p",{className:"font-medium text-lg",children:["",V().totalOurBrokerage.toFixed(2)]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"btn-primary",disabled:R,children:R?"Creating...":"Create Order"})})]})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sales Processing - Flow 6"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Process pending sales orders and allocate inventory lots for confirmed contracts"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Tr,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pending Orders"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:t.length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(nr,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Requested"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[t.reduce((S,U)=>S+U.requested_quantity,0)," lots"]})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(As,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Customers"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:new Set(t.map(S=>{var U;return(U=S.customer_info)==null?void 0:U.id})).size})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pt,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Processing"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:t.filter(S=>S.status==="processing").length})]})]})})]}),e.jsx("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Pending Sales Orders"}),t.length>0?e.jsx("div",{className:"space-y-4",children:t.map(S=>{var U,Q,p,_,N;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Customer"}),e.jsx("p",{className:"text-sm text-gray-600",children:(U=S.customer_info)==null?void 0:U.customer_name}),e.jsx("p",{className:"text-xs text-gray-500",children:(Q=S.customer_info)==null?void 0:Q.customer_code}),e.jsx("p",{className:"text-xs text-gray-500",children:(p=S.customer_info)==null?void 0:p.state})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Broker"}),e.jsx("p",{className:"text-sm text-gray-600",children:(_=S.broker_info)==null?void 0:_.broker_name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Commission: ",(N=S.broker_info)==null?void 0:N.commission_rate,"%"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Requirements"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[S.requested_quantity," lots"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Period: ",S.lifting_period]}),S.line_specs&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Specs: ",S.line_specs.variety||"Any","  ",S.line_specs.fibre_length||"Any"]}),S.priority_branch&&e.jsxs("p",{className:"text-xs text-blue-600",children:["Priority: ",S.priority_branch]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("span",{className:`status-badge ${S.status==="pending"?"status-pending":S.status==="processing"?"status-active":"status-completed"}`,children:S.status})}),e.jsx("button",{onClick:()=>Ee(S),className:"btn-primary text-sm",children:"Process Order"})]})]})},S.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Tr,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No pending orders"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"All sales orders have been processed."})]})]})})]});if(x==="processing")return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(oe,{size:"lg"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Processing sales order..."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Calculating required lots and fetching inventory"})]})});if(x==="selection")return i.filter(S=>d.includes(S.id)),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-b border-gray-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lot Selection"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Select lots for ",(ue=n.customer_info)==null?void 0:ue.customer_name]})]}),e.jsx("button",{onClick:ce,className:"btn-secondary",children:"Back to Orders"})]})}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Customer:"}),e.jsx("p",{className:"text-gray-900",children:(Qe=n.customer_info)==null?void 0:Qe.customer_name}),e.jsx("p",{className:"text-xs text-gray-500",children:(Re=n.customer_info)==null?void 0:Re.state})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Requested Quantity:"}),e.jsxs("p",{className:"text-gray-900",children:[n.requested_quantity," lots"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Priority Branch:"}),e.jsx("p",{className:"text-gray-900",children:n.priority_branch||"Any"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Lifting Period:"}),e.jsx("p",{className:"text-gray-900",children:n.lifting_period})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:"Required Lots"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:y.requiredBales}),e.jsx("p",{className:"text-xs text-blue-600",children:"Required lots"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Selected Lots"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:y.selectedBales})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:"Total Value"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:["",y.totalValue.toLocaleString()]})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:"Net Amount"}),e.jsxs("p",{className:"text-2xl font-bold text-orange-900",children:["",y.netAmount.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-orange-600",children:["After ",(ze=n.broker_info)==null?void 0:ze.commission_rate,"% commission"]})]})]}),y.warningMessage&&e.jsx("div",{className:`p-4 rounded-lg ${y.insufficientLots?"bg-red-50 border border-red-200":"bg-yellow-50 border border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:`h-5 w-5 ${y.insufficientLots?"text-red-400":"text-yellow-400"}`}),e.jsx("p",{className:`ml-2 text-sm ${y.insufficientLots?"text-red-700":"text-yellow-700"}`,children:y.warningMessage})]})}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Available Lots (",i.length,")"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{u(o.map(S=>S.id)),Me(o,y.requiredBales,n)},className:"btn-secondary text-sm",children:"Reset to Auto-Selection"}),e.jsx("button",{onClick:()=>{u(i.map(S=>S.id)),Me(i,y.requiredBales,n)},className:"btn-secondary text-sm",children:"Select All"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Select"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Lot Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Specifications"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Location"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(S=>{var U;return e.jsxs("tr",{className:`hover:bg-gray-50 ${d.includes(S.id)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:d.includes(S.id),onChange:()=>B(S.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:S.lot_number}),e.jsx("div",{className:"text-sm text-gray-500",children:S.indent_number}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Added: ",new Date(S.created_at).toLocaleDateString()]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:S.variety}),e.jsx("div",{className:"text-sm text-gray-500",children:S.fibre_length}),e.jsx("div",{className:"text-xs text-gray-400",children:S.lifting_period})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:S.branch}),e.jsx("div",{className:"text-sm text-gray-500",children:S.centre_name}),S.branch_information&&e.jsx("div",{className:"text-xs text-gray-400",children:S.branch_information.zone})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["",(U=S.bid_price)==null?void 0:U.toLocaleString()]}),e.jsx("div",{className:"text-xs text-gray-500",children:"per bale"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${S.status==="AVAILABLE"?"bg-green-100 text-green-800":S.status==="BLOCKED"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:S.status})})]},S.id)})})]})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsxs("button",{onClick:G,disabled:y.insufficientLots,className:`btn-primary ${y.insufficientLots?"opacity-50 cursor-not-allowed":""}`,children:["Proceed to Confirmation (",y.selectedBales," selected)"]})})]})]});if(x==="confirm"){const S=i.filter(U=>d.includes(U.id));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Confirm Sales Order"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Review and confirm the sales order details"})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Order Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Customer & Broker"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Customer:"}),e.jsx("span",{className:"text-gray-900",children:(bt=n.customer_info)==null?void 0:bt.customer_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"State:"}),e.jsx("span",{className:"text-gray-900",children:(We=n.customer_info)==null?void 0:We.state})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Broker:"}),e.jsx("span",{className:"text-gray-900",children:(Ct=n.broker_info)==null?void 0:Ct.broker_name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Commission Rate:"}),e.jsxs("span",{className:"text-gray-900",children:[(Te=n.broker_info)==null?void 0:Te.commission_rate,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Lifting Period:"}),e.jsx("span",{className:"text-gray-900",children:n.lifting_period})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Financial Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Requested Quantity:"}),e.jsxs("span",{className:"text-gray-900",children:[n.requested_quantity," lots"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Required Lots:"}),e.jsxs("span",{className:"text-gray-900",children:[y.requiredBales," lots"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Selected Lots:"}),e.jsxs("span",{className:"text-gray-900",children:[y.selectedBales," lots"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Total Value:"}),e.jsxs("span",{className:"text-gray-900",children:["",y.totalValue.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Broker Commission:"}),e.jsxs("span",{className:"text-gray-900",children:["",y.brokerCommission.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between font-medium border-t pt-2",children:[e.jsx("span",{className:"text-gray-900",children:"Net Amount:"}),e.jsxs("span",{className:"text-gray-900",children:["",y.netAmount.toLocaleString()]})]})]})]})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Selected Lots (",S.length,")"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(U=>{var Q;return e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:U.lot_number}),e.jsx("div",{className:"text-gray-600",children:U.indent_number}),e.jsxs("div",{className:"text-gray-600",children:[U.variety,"  ",U.fibre_length]}),e.jsxs("div",{className:"text-gray-600",children:[U.branch,"  ",U.centre_name]}),e.jsxs("div",{className:"text-gray-900 font-medium",children:["",(Q=U.bid_price)==null?void 0:Q.toLocaleString()]})]},U.id)})})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:()=>f("selection"),className:"btn-secondary",children:"Back to Selection"}),e.jsxs("div",{className:"space-x-4",children:[e.jsx("button",{onClick:Y,disabled:m,className:"btn-secondary",children:m?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Saving..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Save as Draft"]})}),e.jsx("button",{onClick:Z,disabled:m,className:"btn-primary",children:m?e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Confirming..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Confirm Sale"]})})]})]})]})}return null},bf=()=>{const{user:r,isCustomer:t}=$e(),[s,n]=b.useState({active:[],expired:[],responded:[]}),[a,i]=b.useState({total_assigned:0,total_accepted:0,total_rejected:0,total_pending:0,total_expired:0}),[l,o]=b.useState(!0),[c,d]=b.useState({}),u=async()=>{try{o(!0);const x=await ee.get("/customer/lots");n(x.data.data.assignments),i(x.data.data.summary)}catch(x){console.error("Error fetching assignments:",x),L.error("Failed to fetch lot assignments")}finally{o(!1)}};b.useEffect(()=>{t()?u():o(!1)},[t]);const h=async x=>{var f,y;try{d(w=>({...w,[x]:"accepting"})),await ee.post("/customer/accept",{assignment_id:x}),L.success("Lot accepted successfully!"),await u()}catch(w){console.error("Error accepting lot:",w),L.error(((y=(f=w.response)==null?void 0:f.data)==null?void 0:y.message)||"Failed to accept lot")}finally{d(w=>({...w,[x]:null}))}},g=async x=>{var f,y;try{d(w=>({...w,[x]:"rejecting"})),await ee.post("/customer/reject",{assignment_id:x}),L.success("Lot rejected successfully!"),await u()}catch(w){console.error("Error rejecting lot:",w),L.error(((y=(f=w.response)==null?void 0:f.data)==null?void 0:y.message)||"Failed to reject lot")}finally{d(w=>({...w,[x]:null}))}},m=x=>{const f=new Date,w=new Date(x)-f;return Math.ceil(w/(1e3*60*60*24))},v=x=>{const f="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium";switch(x){case"PENDING":return`${f} bg-yellow-100 text-yellow-800`;case"ACCEPTED":return`${f} bg-green-100 text-green-800`;case"REJECTED":return`${f} bg-red-100 text-red-800`;case"EXPIRED":return`${f} bg-gray-100 text-gray-800`;default:return`${f} bg-gray-100 text-gray-800`}};return t()?l?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Lot Assignments"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Review and respond to your assigned cotton lots"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(nr,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Assigned"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:a.total_assigned})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pt,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pending"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:a.total_pending})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Accepted"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:a.total_accepted})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Js,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Rejected"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:a.total_rejected})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(cs,{className:"h-8 w-8 text-gray-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Expired"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:a.total_expired})]})]})})]}),a.total_pending>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"h-5 w-5 text-yellow-500 mr-2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-900",children:"Action Required"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["You have ",a.total_pending," pending lot assignment(s) that require your response."]})]})]})}),s.active.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(pt,{className:"h-6 w-6 text-yellow-500 mr-2"}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Pending Assignments (",s.active.length,")"]})]}),e.jsx("div",{className:"space-y-4",children:s.active.map(x=>{const f=m(x.window_end_date);return e.jsx("div",{className:"border border-yellow-200 rounded-lg p-4 bg-yellow-50",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Lot Details"}),e.jsx("p",{className:"text-sm text-gray-600",children:x.lot_number}),e.jsx("p",{className:"text-sm text-gray-600",children:x.indent_number}),x.inventory_table&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.jsxs("p",{children:[x.inventory_table.variety,"  ",x.inventory_table.fibre_length]}),e.jsxs("p",{children:["",x.inventory_table.bid_price]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Assignment Window"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Until: ",new Date(x.window_end_date).toLocaleDateString()]}),e.jsx("p",{className:`text-sm font-medium ${f<=1?"text-red-600":f<=3?"text-yellow-600":"text-green-600"}`,children:f>0?`${f} days remaining`:"Expires today"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Status"}),e.jsx("span",{className:v(x.lot_status),children:x.lot_status}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Assigned: ",new Date(x.assigned_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>g(x.id),disabled:c[x.id],className:"btn-secondary text-sm",children:c[x.id]==="rejecting"?e.jsx(oe,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"h-4 w-4 mr-1"}),"Reject"]})}),e.jsx("button",{onClick:()=>h(x.id),disabled:c[x.id],className:"btn-primary text-sm",children:c[x.id]==="accepting"?e.jsx(oe,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"Accept"]})})]})]})},x.id)})})]}),s.responded.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(xo,{className:"h-6 w-6 text-green-500 mr-2"}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Completed Assignments (",s.responded.length,")"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Lot Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Specifications"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Response"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date Responded"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.responded.map(x=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.lot_number}),e.jsx("div",{className:"text-sm text-gray-500",children:x.indent_number})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:x.inventory_table&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-900",children:x.inventory_table.variety}),e.jsx("div",{className:"text-sm text-gray-500",children:x.inventory_table.fibre_length})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:v(x.lot_status),children:x.lot_status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x.responded_at?new Date(x.responded_at).toLocaleDateString():"-"})]},x.id))})]})})]}),s.expired.length>0&&e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(cs,{className:"h-6 w-6 text-gray-500 mr-2"}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Expired Assignments (",s.expired.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:s.expired.map(x=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Lot:"}),e.jsx("p",{className:"text-gray-900",children:x.lot_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Indent:"}),e.jsx("p",{className:"text-gray-900",children:x.indent_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Expired:"}),e.jsx("p",{className:"text-gray-900",children:new Date(x.window_end_date).toLocaleDateString()})]}),e.jsx("div",{children:e.jsx("span",{className:v("EXPIRED"),children:"EXPIRED"})})]})},x.id))})]}),s.active.length===0&&s.responded.length===0&&s.expired.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(nr,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No lot assignments"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You don't have any lot assignments at the moment."})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Le,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900",children:"Important Guidelines"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-800 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Review lot specifications carefully before accepting or rejecting"}),e.jsx("li",{children:"Respond within the assignment window to avoid automatic expiration"}),e.jsx("li",{children:"Once accepted, the lot will be reserved for you and marked as sold"}),e.jsx("li",{children:"Rejected lots will be returned to available inventory"}),e.jsx("li",{children:"Contact support if you need assistance with your assignments"})]})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Le,{className:"mx-auto h-12 w-12 text-red-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This page is only accessible to customers."})]})},vf=()=>{const{user:r,isAdmin:t}=$e(),[s,n]=b.useState([]),[a,i]=b.useState(!0),[l,o]=b.useState({}),[c,d]=b.useState({status:"all",customer:"",date_from:"",date_to:""}),[u,h]=b.useState({}),[g,m]=b.useState([]),[v,x]=b.useState(!1),[f,y]=b.useState([]),[w,j]=b.useState(!1),k=async()=>{try{const T=await ee.get("/customer/assignments/stats");h(T.data.data.assignment_stats)}catch(T){console.error("Error fetching stats:",T)}},C=async()=>{try{i(!0);const T=await ee.get("/customer/lots"),q=[...T.data.data.assignments.active,...T.data.data.assignments.expired,...T.data.data.assignments.responded];n(q)}catch(T){console.error("Error fetching assignments:",T),L.error("Failed to fetch assignments")}finally{i(!1)}},A=async()=>{try{j(!0);const T=await ee.get("/logs",{params:{action:"REMINDER_SENT",table_name:"customer_assignment_table"}});y(T.data.data.logs||[])}catch(T){console.error("Error fetching reminder logs:",T),L.error("Failed to fetch reminder logs")}finally{j(!1)}};b.useEffect(()=>{if(t()){C(),k(),A();const T=it.channel("public:customer_assignment_table").on("postgres_changes",{event:"*",schema:"public",table:"customer_assignment_table"},q=>{C(),k(),A()}).subscribe();return()=>{it.removeChannel(T)}}else i(!1)},[t]);const R=async(T,q,E="")=>{var P,O;try{o(H=>({...H,[T]:!0})),await ee.post("/customer/admin/override",{assignment_id:T,action:q,notes:E}),L.success(`Assignment ${q}ed successfully by admin`),await C(),await k()}catch(H){console.error("Error overriding decision:",H),L.error(((O=(P=H.response)==null?void 0:P.data)==null?void 0:O.message)||"Failed to override decision")}finally{o(H=>({...H,[T]:!1}))}},se=T=>{const q="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium";switch(T){case"PENDING":return`${q} bg-yellow-100 text-yellow-800`;case"ACCEPTED":return`${q} bg-green-100 text-green-800`;case"REJECTED":return`${q} bg-red-100 text-red-800`;case"EXPIRED":return`${q} bg-gray-100 text-gray-800`;default:return`${q} bg-gray-100 text-gray-800`}},K=s.filter(T=>{var q;return!(c.status!=="all"&&T.lot_status!==c.status||c.customer&&!((q=T.customer_id)!=null&&q.includes(c.customer)))});return t()?a?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(oe,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Lot Assignment Administration"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Override customer lot assignment decisions and manage assignments"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(pt,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pending"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:u.PENDING||0})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Accepted"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:u.ACCEPTED||0})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Js,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Rejected"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:u.REJECTED||0})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(nr,{className:"h-8 w-8 text-gray-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Expired"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:u.EXPIRED||0})]})]})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Ps,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:c.status,onChange:T=>d(q=>({...q,status:T.target.value})),className:"input-field",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"ACCEPTED",children:"Accepted"}),e.jsx("option",{value:"REJECTED",children:"Rejected"}),e.jsx("option",{value:"EXPIRED",children:"Expired"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Search"}),e.jsx("input",{type:"text",value:c.customer,onChange:T=>d(q=>({...q,customer:T.target.value})),placeholder:"Search by customer...",className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:c.date_from,onChange:T=>d(q=>({...q,date_from:T.target.value})),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:c.date_to,onChange:T=>d(q=>({...q,date_to:T.target.value})),className:"input-field"})]})]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assignment Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Window Period"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Admin Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:K.map(T=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:T.lot_number}),e.jsx("div",{className:"text-sm text-gray-500",children:T.indent_number}),T.inventory_table&&e.jsxs("div",{className:"text-xs text-gray-500",children:[T.inventory_table.variety,"  ",T.inventory_table.fibre_length]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(jn,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsxs("div",{className:"text-sm text-gray-900",children:["Customer #",T.customer_id]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[new Date(T.window_start_date).toLocaleDateString()," - "," ",new Date(T.window_end_date).toLocaleDateString()]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Assigned: ",new Date(T.assigned_at).toLocaleDateString()]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:se(T.lot_status),children:T.lot_status}),T.responded_at&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Responded: ",new Date(T.responded_at).toLocaleDateString()]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:T.lot_status==="PENDING"?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>R(T.id,"reject","Admin override - rejected"),disabled:l[T.id],className:"inline-flex items-center btn-secondary text-xs",children:l[T.id]?e.jsx(oe,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"h-3 w-3 mr-1"}),"Override Reject"]})}),e.jsx("button",{onClick:()=>R(T.id,"accept","Admin override - accepted"),disabled:l[T.id],className:"inline-flex items-center btn-primary text-xs",children:l[T.id]?e.jsx(oe,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-3 w-3 mr-1"}),"Override Accept"]})})]}):T.lot_status==="REJECTED"?e.jsx("button",{onClick:()=>R(T.id,"accept","Admin override - changed to accepted"),disabled:l[T.id],className:"inline-flex items-center btn-primary text-xs",children:l[T.id]?e.jsx(oe,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-3 w-3 mr-1"}),"Change to Accept"]})}):T.lot_status==="ACCEPTED"?e.jsx("button",{onClick:()=>R(T.id,"reject","Admin override - changed to rejected"),disabled:l[T.id],className:"inline-flex items-center btn-secondary text-xs",children:l[T.id]?e.jsx(oe,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"h-3 w-3 mr-1"}),"Change to Reject"]})}):e.jsx("span",{className:"text-gray-400 text-xs",children:"No actions available"})})]},T.id))})]})}),K.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(nr,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No assignments found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No assignments match your current filters."})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(po,{className:"h-5 w-5 text-yellow-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-900",children:"Admin Override Guidelines"}),e.jsxs("ul",{className:"mt-2 text-sm text-yellow-800 list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Override decisions should be used sparingly and with proper justification"}),e.jsx("li",{children:"Consider customer requirements and inventory availability before overriding"}),e.jsx("li",{children:"All override actions are logged in the audit trail for compliance"}),e.jsx("li",{children:"Communicate with customers when their decisions are overridden"}),e.jsx("li",{children:"Monitor override usage to ensure fair and consistent treatment"})]})]})]})}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Bulk Actions"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Perform actions on multiple assignments"})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"btn-secondary text-sm",children:"Export Data"}),e.jsx("button",{className:"btn-primary text-sm",children:"Generate Report"})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Le,{className:"mx-auto h-12 w-12 text-red-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"You don't have permission to view this page."})]})},jf={indent_number:"",buyer_type:"",centre_name:"",variety:"",bale_quantity:"",crop_year:"",offer_price:"",bid_price:"",lifting_period:"",fibre_length:"",ccl_discount:""},wf=tn().shape({indent_number:ut().required("Indent Number is required"),buyer_type:ut().required("Buyer Type is required"),branch_name:ut().required("Branch is required"),zone:ut().required("Zone is required"),centre_name:ut().required("Center Name is required"),variety:ut().required("Variety is required"),bale_quantity:Ks().typeError("Bale Quantity must be a number").required("Bale Quantity is required").min(1),crop_year:ut().required("Crop Year is required"),offer_price:Ks().typeError("Offer Price must be a number").required("Offer Price is required").min(0),bid_price:Ks().typeError("Bid Price must be a number").required("Bid Price is required").min(0),lifting_period:ut().required("Lifting Period is required"),fibre_length:ut().required("Fibre Length is required"),ccl_discount:Ks().typeError("CCL Discount must be a number").nullable().transform((r,t)=>t===""?null:r)}),_f=()=>{const[r,t]=b.useState(!1),[s,n]=b.useState(""),[a,i]=b.useState(""),[l,o]=b.useState([]),[c,d]=b.useState([]),[u,h]=b.useState(["TRADER","MILL","EXPORTER","OTHER"]),[g,m]=b.useState(!0),[v,x]=b.useState(""),f=Jt(),{register:y,handleSubmit:w,formState:{errors:j},reset:k}=ea({resolver:ta(wf),defaultValues:jf});b.useEffect(()=>{(async()=>{m(!0),x("");try{const se=(await ee.get("/dashboard/branch-info")).data.data||[];o(se.map(K=>K.branch_name)),d([...new Set(se.map(K=>K.zone))])}catch{x("Failed to load branch/zone options")}finally{m(!1)}})()},[]);const C=async A=>{var R,se;t(!0),n(""),i("");try{const K={...A,bale_quantity:Number(A.bale_quantity),offer_price:Number(A.offer_price),bid_price:Number(A.bid_price),ccl_discount:A.ccl_discount?Number(A.ccl_discount):null},T=await ee.post("/allocations/manual",K);i("Allocation created successfully!"),setTimeout(()=>f("/allocations"),1200),k()}catch(K){n(((se=(R=K.response)==null?void 0:R.data)==null?void 0:se.message)||"Failed to create allocation. Please check your input.")}finally{t(!1)}};return e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Manual Allocation Entry"}),g?e.jsx("div",{className:"text-center py-8",children:"Loading options..."}):v?e.jsx("div",{className:"text-red-600 text-center py-8",children:v}):e.jsxs("form",{onSubmit:w(C),className:"space-y-4 bg-white p-6 rounded shadow",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Indent Number *"}),e.jsx("input",{...y("indent_number"),className:"input-field"}),j.indent_number&&e.jsx("div",{className:"error-message",children:j.indent_number.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Buyer Type *"}),e.jsxs("select",{...y("buyer_type"),className:"input-field",children:[e.jsx("option",{value:"",children:"Select Buyer Type"}),u.map(A=>e.jsx("option",{value:A,children:A},A))]}),j.buyer_type&&e.jsx("div",{className:"error-message",children:j.buyer_type.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Branch *"}),e.jsxs("select",{...y("branch_name"),className:"input-field",children:[e.jsx("option",{value:"",children:"Select Branch"}),l.map(A=>e.jsx("option",{value:A,children:A},A))]}),j.branch_name&&e.jsx("div",{className:"error-message",children:j.branch_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Zone *"}),e.jsxs("select",{...y("zone"),className:"input-field",children:[e.jsx("option",{value:"",children:"Select Zone"}),c.map(A=>e.jsx("option",{value:A,children:A},A))]}),j.zone&&e.jsx("div",{className:"error-message",children:j.zone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Center Name *"}),e.jsx("input",{...y("centre_name"),className:"input-field"}),j.centre_name&&e.jsx("div",{className:"error-message",children:j.centre_name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Variety *"}),e.jsx("input",{...y("variety"),className:"input-field"}),j.variety&&e.jsx("div",{className:"error-message",children:j.variety.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Bale Quantity *"}),e.jsx("input",{type:"number",...y("bale_quantity"),className:"input-field",min:"1"}),j.bale_quantity&&e.jsx("div",{className:"error-message",children:j.bale_quantity.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Crop Year *"}),e.jsx("input",{...y("crop_year"),className:"input-field"}),j.crop_year&&e.jsx("div",{className:"error-message",children:j.crop_year.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Offer Price *"}),e.jsx("input",{type:"number",...y("offer_price"),className:"input-field",min:"0"}),j.offer_price&&e.jsx("div",{className:"error-message",children:j.offer_price.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Bid Price *"}),e.jsx("input",{type:"number",...y("bid_price"),className:"input-field",min:"0"}),j.bid_price&&e.jsx("div",{className:"error-message",children:j.bid_price.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Lifting Period *"}),e.jsx("input",{...y("lifting_period"),className:"input-field"}),j.lifting_period&&e.jsx("div",{className:"error-message",children:j.lifting_period.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Fibre Length *"}),e.jsx("input",{...y("fibre_length"),className:"input-field"}),j.fibre_length&&e.jsx("div",{className:"error-message",children:j.fibre_length.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"CCL Discount"}),e.jsx("input",{type:"number",...y("ccl_discount"),className:"input-field"}),j.ccl_discount&&e.jsx("div",{className:"error-message",children:j.ccl_discount.message})]})]}),s&&e.jsx("div",{className:"text-red-600 text-sm",children:s}),a&&e.jsx("div",{className:"text-green-600 text-sm",children:a}),e.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[e.jsx("button",{type:"submit",className:"btn-primary",disabled:r,children:r?e.jsx(oe,{size:"sm"}):"Create Allocation"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>f("/allocations"),disabled:r,children:"Cancel"})]})]})]})},Nf=20,Sf=()=>{const[r,t]=b.useState([]),[s,n]=b.useState(!0),[a,i]=b.useState(""),[l,o]=b.useState({current_page:1,total_pages:1}),[c,d]=b.useState({table_name:"",action:"",search:""}),u=async(m=1)=>{n(!0),i("");try{const v={page:m,limit:Nf,...Object.fromEntries(Object.entries(c).filter(([f,y])=>y))},x=await ee.get("/dashboard/logs",{params:v});t(x.data.data.logs),o(x.data.data.pagination)}catch{i("Failed to fetch logs.")}finally{n(!1)}};b.useEffect(()=>{u(1)},[c]),b.useEffect(()=>{const m=it.channel("realtime:audit_log").on("postgres_changes",{event:"*",schema:"public",table:"audit_log"},()=>{u(l.current_page)}).subscribe();return()=>{it.removeChannel(m)}},[c,l.current_page]);const h=m=>{u(m)},g=m=>{const{name:v,value:x}=m.target;d(f=>({...f,[v]:x}))};return e.jsxs("div",{className:"max-w-6xl mx-auto py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Audit Logs"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4 flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Table"}),e.jsx("input",{name:"table_name",value:c.table_name,onChange:g,className:"input-field",placeholder:"e.g. allocation"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Action"}),e.jsx("input",{name:"action",value:c.action,onChange:g,className:"input-field",placeholder:"e.g. MANUAL_CREATE"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Search"}),e.jsx("input",{name:"search",value:c.search,onChange:g,className:"input-field",placeholder:"Search details..."})]}),e.jsx("button",{className:"btn-secondary",onClick:()=>u(1),disabled:s,children:"Refresh"})]}),s?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(oe,{size:"lg"})}):a?e.jsx("div",{className:"text-red-600 text-center py-8",children:a}):e.jsxs("div",{className:"overflow-x-auto bg-white rounded shadow",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Timestamp"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Table"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Action"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"User"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Details"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900",children:new Date(m.created_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:m.table_name}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:m.action}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:m.users?`${m.users.first_name} ${m.users.last_name}`:m.user_id||"-"}),e.jsx("td",{className:"px-4 py-2 whitespace-pre-wrap text-xs max-w-xs break-words",children:m.new_values?JSON.stringify(m.new_values,null,2):"-"})]},m.id))})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 border-t",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",l.current_page," of ",l.total_pages," (",l.total_records," records)"]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>h(l.current_page-1),disabled:l.current_page<=1||s,children:"Previous"}),e.jsx("button",{className:"btn-secondary",onClick:()=>h(l.current_page+1),disabled:l.current_page>=l.total_pages||s,children:"Next"})]})]})]})]})},Ei=()=>({emd_paid_date:"",do_payment_dates:[{date:"",amount:""}],moisture_percentage:"",actual_weight:"",carrying_days:[0],unlifted_lots:[0],delivery_dates:[{date:"",lots:"",additional_carrying_days:0}]}),kf=["South Zone","Other Zone"];function Ef(){const[r,t]=b.useState([Ei()]),[s,n]=b.useState(1),[a,i]=b.useState(1e3),[l,o]=b.useState(5e3),[c,d]=b.useState(100),[u,h]=b.useState(.18),[g,m]=b.useState("South Zone"),[v,x]=b.useState(""),[f,y]=b.useState(null),[w,j]=b.useState(!1),[k,C]=b.useState(""),[A,R]=b.useState([]),[se,K]=b.useState(!0),[T,q]=b.useState("");b.useEffect(()=>{(async()=>{K(!0),q("");try{const G=await ee.get("/customer-info");R(G.data.data.customers||[])}catch{q("Failed to load customers")}finally{K(!1)}})()},[]);const E=()=>{t([...r,Ei()]),n(r.length+1)},P=()=>{r.length>1&&(t(r.slice(0,-1)),n(r.length-1))},O=(B,G,Y)=>{const Z=[...r];Z[B][G]=Y,t(Z)},H=(B,G,Y,Z)=>{const ce=[...r];ce[B].do_payment_dates[G][Y]=Z,t(ce)},J=B=>{const G=[...r];G[B].do_payment_dates.push({date:"",amount:""}),t(G)},I=B=>{const G=[...r];G[B].do_payment_dates.length>1&&(G[B].do_payment_dates.pop(),t(G))},V=(B,G,Y,Z)=>{const ce=[...r];ce[B].delivery_dates[G][Y]=Z,t(ce)},ie=B=>{const G=[...r];G[B].delivery_dates.push({date:"",lots:"",additional_carrying_days:0}),t(G)},ye=B=>{const G=[...r];G[B].delivery_dates.length>1&&(G[B].delivery_dates.pop(),t(G))},me=B=>{const G=[...r];G[B].carrying_days.push(0),G[B].unlifted_lots.push(0),t(G)},Ee=B=>{const G=[...r];G[B].carrying_days.length>1&&(G[B].carrying_days.pop(),G[B].unlifted_lots.pop(),t(G))},Me=async()=>{C(""),j(!0);try{if(!v)throw new Error("Customer is required");for(let Y=0;Y<r.length;Y++){const Z=r[Y];if(!Z.emd_paid_date||!Z.moisture_percentage||!Z.actual_weight)throw new Error(`All required fields must be filled for lot ${Y+1}`);for(let ce=0;ce<Z.delivery_dates.length;ce++){const ue=Z.delivery_dates[ce];if(!ue.date||!ue.lots||Number(ue.lots)<1)throw new Error(`Each delivery entry for lot ${Y+1} must have a valid date and lots >= 1`)}}const B={customer_id:v,total_lots:r.length,bid_price:Number(a),emd_amount:Number(l),cotton_value:Number(c),gst_rate:Number(u),zone:g,lots:r.map(Y=>({...Y,moisture_percentage:Number(Y.moisture_percentage),actual_weight:Number(Y.actual_weight),carrying_days:Y.carrying_days.map(Number),unlifted_lots:Y.unlifted_lots.map(Number),do_payment_dates:Y.do_payment_dates.map(Z=>({...Z,amount:Number(Z.amount)})),delivery_dates:Y.delivery_dates.filter(Z=>Z.date&&Z.lots&&Number(Z.lots)>=1).map(Z=>({...Z,lots:Number(Z.lots),additional_carrying_days:Number(Z.additional_carrying_days)}))}))},G=await ee.post("/do-specifications",B);y(G.data.data.calculation_results)}catch(B){C(B.message||"Submission failed")}finally{j(!1)}};return e.jsxs("div",{className:"max-w-6xl mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"DO Specifications"}),e.jsxs("div",{className:"mb-4 flex flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Customer"}),se?e.jsx("div",{className:"text-gray-500",children:"Loading..."}):T?e.jsx("div",{className:"text-red-500",children:T}):e.jsxs("select",{className:"border rounded p-2",value:v,onChange:B=>x(B.target.value),children:[e.jsx("option",{value:"",children:"Select Customer"}),A.map(B=>e.jsx("option",{value:B.id,children:B.customer_name},B.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Bid Price"}),e.jsx("input",{type:"number",className:"border rounded p-2",value:a,onChange:B=>i(B.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"EMD Amount"}),e.jsx("input",{type:"number",className:"border rounded p-2",value:l,onChange:B=>o(B.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Cotton Value"}),e.jsx("input",{type:"number",className:"border rounded p-2",value:c,onChange:B=>d(B.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"GST Rate"}),e.jsx("input",{type:"number",step:"0.01",className:"border rounded p-2",value:u,onChange:B=>h(B.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Zone"}),e.jsx("select",{className:"border rounded p-2",value:g,onChange:B=>m(B.target.value),children:kf.map(B=>e.jsx("option",{value:B,children:B},B))})]})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{className:"bg-blue-500 text-white px-3 py-1 rounded",onClick:E,children:"+ Add Lot"}),e.jsx("button",{className:"bg-red-500 text-white px-3 py-1 rounded",onClick:P,disabled:r.length===1,children:"- Remove Lot"})]}),r.map((B,G)=>e.jsxs("div",{className:"border rounded p-4 mb-4 bg-gray-50",children:[e.jsxs("h2",{className:"font-semibold mb-2",children:["Lot ",G+1]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"EMD Paid Date *"}),e.jsx("input",{type:"date",className:"border rounded p-2 w-full",value:B.emd_paid_date,onChange:Y=>O(G,"emd_paid_date",Y.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Moisture % *"}),e.jsx("input",{type:"number",className:"border rounded p-2 w-full",value:B.moisture_percentage,onChange:Y=>O(G,"moisture_percentage",Y.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block",children:"Actual Weight (kg) *"}),e.jsx("input",{type:"number",className:"border rounded p-2 w-full",value:B.actual_weight,onChange:Y=>O(G,"actual_weight",Y.target.value)})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-medium",children:"DO Payment Dates (partial allowed)"}),B.do_payment_dates.map((Y,Z)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"date",className:"border rounded p-2",value:Y.date,onChange:ce=>H(G,Z,"date",ce.target.value)}),e.jsx("input",{type:"number",className:"border rounded p-2",placeholder:"Amount",value:Y.amount,onChange:ce=>H(G,Z,"amount",ce.target.value)}),B.do_payment_dates.length>1&&e.jsx("button",{className:"text-red-500",onClick:()=>I(G),children:"-"}),Z===B.do_payment_dates.length-1&&e.jsx("button",{className:"text-green-500",onClick:()=>J(G),children:"+"})]},Z))]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-medium",children:"Additional Carrying Days & Unlifted Lots"}),B.carrying_days.map((Y,Z)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"number",className:"border rounded p-2",placeholder:"Carrying Days",value:B.carrying_days[Z],onChange:ce=>{const ue=[...B.carrying_days];ue[Z]=ce.target.value,O(G,"carrying_days",ue)}}),e.jsx("input",{type:"number",className:"border rounded p-2",placeholder:"Unlifted Lots",value:B.unlifted_lots[Z],onChange:ce=>{const ue=[...B.unlifted_lots];ue[Z]=ce.target.value,O(G,"unlifted_lots",ue)}}),B.carrying_days.length>1&&e.jsx("button",{className:"text-red-500",onClick:()=>Ee(G),children:"-"}),Z===B.carrying_days.length-1&&e.jsx("button",{className:"text-green-500",onClick:()=>me(G),children:"+"})]},Z))]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-medium",children:"Delivery Dates (partial allowed)"}),B.delivery_dates.map((Y,Z)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"date",className:"border rounded p-2",value:Y.date,onChange:ce=>V(G,Z,"date",ce.target.value)}),e.jsx("input",{type:"number",className:"border rounded p-2",placeholder:"Lots",value:Y.lots,onChange:ce=>V(G,Z,"lots",ce.target.value)}),e.jsx("input",{type:"number",className:"border rounded p-2",placeholder:"Additional Carrying Days",value:Y.additional_carrying_days,onChange:ce=>V(G,Z,"additional_carrying_days",ce.target.value)}),B.delivery_dates.length>1&&e.jsx("button",{className:"text-red-500",onClick:()=>ye(G),children:"-"}),Z===B.delivery_dates.length-1&&e.jsx("button",{className:"text-green-500",onClick:()=>ie(G),children:"+"})]},Z))]})]},G)),k&&e.jsx("div",{className:"text-red-600 mb-2",children:k}),e.jsx("button",{className:"bg-green-600 text-white px-6 py-2 rounded",onClick:Me,disabled:w,children:w?"Calculating...":"Submit & Calculate"}),f&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Results"}),f.lots.map((B,G)=>e.jsxs("div",{className:"border rounded p-4 mb-4 bg-white",children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Lot ",B.lot_index]}),e.jsxs("div",{children:["Weight Difference: ",e.jsx("span",{className:"font-mono",children:B.weight_difference})," (",B.weight_message,")"]}),e.jsxs("div",{children:["Interest Amount: ",e.jsx("span",{className:"font-mono",children:B.interest})]}),e.jsxs("div",{children:["Late Lifting Charges: ",e.jsx("span",{className:"font-mono",children:B.late_lifting_charges})]}),B.late_lifting_breakdown.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-medium",children:"Late Lifting Breakdown:"}),e.jsx("ul",{className:"list-disc ml-6",children:B.late_lifting_breakdown.map((Y,Z)=>e.jsxs("li",{children:[Y.lots," lots on ",Y.delivery_date,": ",Y.rate_label,", Charge: ",Y.total_charge.toFixed(3)," (GST: ",Y.gst.toFixed(3),")"]},Z))})]})]},G)),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"font-bold",children:"Summary"}),e.jsxs("div",{children:["Total Weight Difference: ",e.jsx("span",{className:"font-mono",children:f.summary.total_weight_difference})]}),e.jsxs("div",{children:["Total Interest: ",e.jsx("span",{className:"font-mono",children:f.summary.total_interest})]}),e.jsxs("div",{children:["Total Late Lifting Charges: ",e.jsx("span",{className:"font-mono",children:f.summary.total_late_lifting_charges})]})]})]})]})}const Cf=10;function Af(){const[r,t]=b.useState([]),[s,n]=b.useState({current_page:1,total_pages:1,total_records:0}),[a,i]=b.useState(!0),[l,o]=b.useState(""),c=Jt(),d=async(h=1)=>{i(!0),o("");try{const g=await ee.get("/do-specifications",{params:{page:h,limit:Cf}});t(g.data.data.records),n(g.data.data.pagination)}catch{o("Failed to fetch records.")}finally{i(!1)}};b.useEffect(()=>{d(1)},[]);const u=h=>{d(h)};return e.jsxs("div",{className:"max-w-6xl mx-auto py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"DO Specifications History"}),a?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(oe,{size:"lg"})}):l?e.jsx("div",{className:"text-red-600 text-center py-8",children:l}):e.jsxs("div",{className:"overflow-x-auto bg-white rounded shadow",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Created At"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Customer"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Lots"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Bid Price"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Zone"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900",children:new Date(h.created_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.customer_id}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.total_lots}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.bid_price}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:h.zone}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.jsx("button",{className:"text-blue-600 hover:underline",onClick:()=>c(`/do-specifications/${h.id}`),children:"View Details"})})]},h.id))})]}),s.total_pages>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing page ",s.current_page," of ",s.total_pages," (",s.total_records," total records)"]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>u(s.current_page-1),disabled:!s.has_previous,className:"px-3 py-1 border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>u(s.current_page+1),disabled:!s.has_next,className:"px-3 py-1 border rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]})}function Tf(){const{user:r,loading:t}=$e();return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(oe,{size:"lg"})}):r?e.jsx(xc,{children:e.jsxs(Kl,{children:[e.jsx(we,{path:"/",element:e.jsx(Sa,{})}),e.jsx(we,{path:"/dashboard",element:e.jsx(Sa,{})}),e.jsx(we,{path:"/allocations",element:e.jsx($u,{})}),e.jsx(we,{path:"/allocation/:id",element:e.jsx(Du,{})}),e.jsx(we,{path:"/payment/:id",element:e.jsx(Lu,{})}),e.jsx(we,{path:"/utr/:id",element:e.jsx(Ru,{})}),e.jsx(we,{path:"/utr/pending",element:e.jsx(Fu,{})}),e.jsx(we,{path:"/payments/verified",element:e.jsx(Iu,{})}),e.jsx(we,{path:"/allocations/manual-entry",element:e.jsx(_f,{})}),e.jsx(we,{path:"/contract/search",element:e.jsx(df,{})}),e.jsx(we,{path:"/contract/upload",element:e.jsx(mf,{})}),e.jsx(we,{path:"/admin/contracts",element:e.jsx(xf,{})}),e.jsx(we,{path:"/contract/logs",element:e.jsx(pf,{})}),e.jsx(we,{path:"/sampling-entry",element:e.jsx(gf,{})}),e.jsx(we,{path:"/sales-processing",element:e.jsx(yf,{})}),e.jsx(we,{path:"/customer/my-lots",element:e.jsx(bf,{})}),e.jsx(we,{path:"/admin/lot-override",element:e.jsx(vf,{})}),e.jsx(we,{path:"/do-specifications",element:e.jsx(Ef,{})}),e.jsx(we,{path:"/do-specifications/history",element:e.jsx(Af,{})}),e.jsx(we,{path:"/logs",element:e.jsx(Sf,{})}),e.jsx(we,{path:"*",element:e.jsx(Jl,{to:"/",replace:!0})})]})}):e.jsx(pc,{})}const Of=new Yl({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1,staleTime:5*60*1e3}}});wn.createRoot(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(Xl,{client:Of,children:e.jsx(Zl,{children:e.jsxs(fc,{children:[e.jsx(Tf,{}),e.jsx(hc,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,theme:{primary:"#4aed88"}}}})]})})})}));
//# sourceMappingURL=index-DZ-AGsNM.js.map
